<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SpringBoot | 薛定谔see猫</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css">
    <meta name="description" content="">
    <meta charset="UTF-8" version="1">
    <meta name="baidu-site-verification" content="code-E5pfjV93p5">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="Keywords" content="个人博客, 薛定谔see猫,程序员,java">
    
    <link rel="preload" href="/assets/css/0.styles.aea1a24b.css" as="style"><link rel="preload" href="/assets/js/app.24a5dc33.js" as="script"><link rel="preload" href="/assets/js/3.ef08ee50.js" as="script"><link rel="preload" href="/assets/js/1.86f97011.js" as="script"><link rel="preload" href="/assets/js/22.faa1ab48.js" as="script"><link rel="prefetch" href="/assets/js/10.d0c114d7.js"><link rel="prefetch" href="/assets/js/11.5e3901af.js"><link rel="prefetch" href="/assets/js/12.36be0bea.js"><link rel="prefetch" href="/assets/js/13.f58033c4.js"><link rel="prefetch" href="/assets/js/14.6fd1b950.js"><link rel="prefetch" href="/assets/js/15.4ee4adef.js"><link rel="prefetch" href="/assets/js/16.719e3da8.js"><link rel="prefetch" href="/assets/js/17.00e74f83.js"><link rel="prefetch" href="/assets/js/18.cb6202f2.js"><link rel="prefetch" href="/assets/js/19.90105738.js"><link rel="prefetch" href="/assets/js/20.2f6476c4.js"><link rel="prefetch" href="/assets/js/21.2e5dfc50.js"><link rel="prefetch" href="/assets/js/23.34ecd0b8.js"><link rel="prefetch" href="/assets/js/24.232807af.js"><link rel="prefetch" href="/assets/js/25.719df42e.js"><link rel="prefetch" href="/assets/js/26.696891cc.js"><link rel="prefetch" href="/assets/js/27.16f0d38a.js"><link rel="prefetch" href="/assets/js/28.3112ed9b.js"><link rel="prefetch" href="/assets/js/29.1ddf6f5a.js"><link rel="prefetch" href="/assets/js/30.063d916a.js"><link rel="prefetch" href="/assets/js/4.e4abacbc.js"><link rel="prefetch" href="/assets/js/5.248a317b.js"><link rel="prefetch" href="/assets/js/6.ab70a287.js"><link rel="prefetch" href="/assets/js/7.5d305417.js"><link rel="prefetch" href="/assets/js/8.ca59b4e9.js"><link rel="prefetch" href="/assets/js/9.aa723625.js">
    <link rel="stylesheet" href="/assets/css/0.styles.aea1a24b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-1156296a><div data-v-1156296a><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1156296a data-v-1156296a><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4e82dffc data-v-1156296a data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>薛定谔see猫</h3> <p class="description" data-v-4e82dffc data-v-4e82dffc></p> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>薛定谔see猫</span>
            
          <!---->
          2021
        </a></span></div></div> <div class="hide" data-v-1156296a><header class="navbar" data-v-1156296a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/logo.jpg" alt="薛定谔see猫" class="logo"> <span class="site-name">薛定谔see猫</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1156296a></div> <aside class="sidebar" data-v-1156296a><div class="personal-info-wrapper" data-v-828910c6 data-v-1156296a><img src="/assets/img/logo.jpg" alt="author-avatar" class="personal-img" data-v-828910c6> <h3 class="name" data-v-828910c6>
    薛定谔see猫
  </h3> <div class="num" data-v-828910c6><div data-v-828910c6><h3 data-v-828910c6>19</h3> <h6 data-v-828910c6>Articles</h6></div> <div data-v-828910c6><h3 data-v-828910c6>22</h3> <h6 data-v-828910c6>Tags</h6></div></div> <ul class="social-links" data-v-828910c6><li class="social-item" data-v-828910c6><i class="iconfont reco-github" style="color:#849b87;" data-v-828910c6></i></li><li class="social-item" data-v-828910c6><i class="iconfont reco-bilibili" style="color:#f26d6d;" data-v-828910c6></i></li></ul> <hr data-v-828910c6></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4e82dffc data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>SpringBoot</h3> <!----> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>薛定谔see猫</span>
            
          <!---->
          2021
        </a></span></div></div> <div data-v-1156296a><main class="page"><section><div class="page-title"><h1 class="title">SpringBoot</h1> <div data-v-1ff7123e><i class="iconfont reco-account" data-v-1ff7123e><span data-v-1ff7123e>薛定谔see猫</span></i> <i class="iconfont reco-date" data-v-1ff7123e><span data-v-1ff7123e>2021/4/3</span></i> <!----> <i class="tags iconfont reco-tag" data-v-1ff7123e><span class="tag-item" data-v-1ff7123e>java</span><span class="tag-item" data-v-1ff7123e>SSM</span><span class="tag-item" data-v-1ff7123e>springboot</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="_1-基础入门"><a href="#_1-基础入门" class="header-anchor">#</a> 1. 基础入门</h2> <h3 id="_1-1-spring与springboot"><a href="#_1-1-spring与springboot" class="header-anchor">#</a> 1.1 Spring与SpringBoot</h3> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><p><code>SpringBoot</code>就是整合<code>Spring</code>各种框架的一个脚手架</p> <h4 id="_1-1-1-优点"><a href="#_1-1-1-优点" class="header-anchor">#</a> 1.1.1 优点</h4> <ol><li>创建独立<code>Spring</code>应用</li> <li>内嵌<code>web</code>服务器</li> <li>自动<code>starter</code>依赖，简化构建配置</li> <li>自动配置<code>spring</code>以及第三方功能</li> <li>提供产品级别的监控、健康检查即外部配置</li> <li>无代码生成、无需编写<code>XML</code></li></ol> <h4 id="_1-1-2-缺点"><a href="#_1-1-2-缺点" class="header-anchor">#</a> 1.1.2 缺点</h4> <ol><li>版本迭代太快，需要时刻关注变化</li> <li>封装太深，内部原理复杂，不容易精通</li></ol> <h3 id="_1-2-时代背景"><a href="#_1-2-时代背景" class="header-anchor">#</a> 1.2 时代背景</h3> <h4 id="_1-2-1-微服务"><a href="#_1-2-1-微服务" class="header-anchor">#</a> 1.2.1 微服务</h4> <ul><li>微服务是一种架构风格</li> <li>一个应用拆分为一组小型服务</li> <li>每个服务运行在自己的进程内，也就是可独立部署和升级</li> <li>服务之间使用轻量级<code>HTTP</code>交互</li> <li>服务围绕业务功能拆分</li> <li>可以有自动部署机制独立部署</li> <li>去中心化，服务自治。服务可以使用不同的语言、不同的存储技术</li></ul> <h4 id="_1-2-2-分布式"><a href="#_1-2-2-分布式" class="header-anchor">#</a> 1.2.2 分布式</h4> <p>分布式的困难</p> <ul><li>远程调用</li> <li>服务发现</li> <li>负载均衡</li> <li>服务容错</li> <li>配置管理</li> <li>服务监控</li> <li>链路追踪</li> <li>日志管理</li> <li>任务调度</li> <li>......</li></ul> <p>解决方案，<code>SpringBoot</code>+<code>SpringCloud</code></p> <h4 id="_1-2-3-云原生"><a href="#_1-2-3-云原生" class="header-anchor">#</a> 1.2.3 云原生</h4> <p>原生应用如何上云。<code>Cloud Native</code></p> <p>上云的困难</p> <ul><li>服务自愈</li> <li>弹性伸缩</li> <li>服务隔离</li> <li>自动化部署</li> <li>灰度发布</li> <li>流量治理</li> <li>.......</li></ul> <h3 id="_1-3-helloworld"><a href="#_1-3-helloworld" class="header-anchor">#</a> 1.3 HelloWorld</h3> <ol><li><p>创建一个<code>Maven</code>项目</p></li> <li><p><code>pom.xml</code>新增</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.4.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>添加<code>web</code>依赖的启动器</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>新建一个入口程序，并添加注解<code>@SpringBootApplication</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainApplication</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">MainApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>编写<code>controller</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Hello Spring Boot!&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>运行主类测试</p></li> <li><p>在<code>resource</code>文件夹下新建<code>application.properties</code>可用于修改<code>SpringBoot</code>的默认配置</p></li> <li><p>导入<code>SpringBoot</code>提供的插件，可以将应用打包为<code>Jar</code>的形式</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>输入命令</p> <div class="language- extra-class"><pre class="language-text"><code>mvn package
</code></pre></div></li></ol> <h2 id="_2-自动配置原理"><a href="#_2-自动配置原理" class="header-anchor">#</a> 2. 自动配置原理</h2> <h3 id="_2-1-springboot特点"><a href="#_2-1-springboot特点" class="header-anchor">#</a> 2.1 SpringBoot特点</h3> <h4 id="_2-1-1-依赖管理"><a href="#_2-1-1-依赖管理" class="header-anchor">#</a> 2.1.1 依赖管理</h4> <ul><li><p>父项目做依赖管理</p></li> <li><p>开发导入<code>starter</code>场景启动器，一个<code>starter</code>就包含了一个开发场景所需要的依赖，官方的<code>starter</code>以<code>spring-boot-starter-</code>开头，第三方的以<code>-spring-boot-starter</code>结尾</p> <p>所有<code>starter</code>的根<code>starter</code></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.4.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>无需关注版本号，自动版本仲裁。<code>starter</code>里声明了很多依赖的版本号，依赖引入时，不用关注版本号</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>如果是<code>springboot</code>中没有声明的依赖，需要加入版本号</p></li> <li><p>可以修改版本号<code>pom.xml</code>，以修改<code>mysql</code>版本号为例</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- 需要在spring-boot-dependencies找到对应的版本标识 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mysql.version</span><span class="token punctuation">&gt;</span></span>5.1.43<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mysql.version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ul> <h4 id="_2-1-2-自动配置"><a href="#_2-1-2-自动配置" class="header-anchor">#</a> 2.1.2 自动配置</h4> <ul><li><p>自动配置好<code>Tomcat</code></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-tomcat<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.4.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>自动配置好<code>SpringMVC</code></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.3.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>compile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-webmvc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.3.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>compile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>自动配置好<code>web</code>常见功能，如：字符编码问题</p></li> <li><p>默认的包结构</p> <p>主程序所在的包及其下面的所有子包里面的组件都会被默认扫描进来</p> <p>可以修改默认扫描的包</p> <div class="language- extra-class"><pre class="language-text"><code>@SpringBootApplication(scanBasePackages = &quot;com.valid&quot;)
</code></pre></div></li> <li><p>各种配置拥有默认值</p> <p>默认的配置最终都是映射到<code>MultipartProperties</code></p> <p>配置文件的值最终会绑定在每个类上，这个类会在容器中创建对象</p></li> <li><p>按需加载所有自动配置项</p> <p>所有的自动配置功能都在<code>spring-boot-autoconfigure</code>包里面</p></li> <li><p>......</p></li></ul> <h3 id="_2-2-容器功能"><a href="#_2-2-容器功能" class="header-anchor">#</a> 2.2 容器功能</h3> <h4 id="_2-2-1-组件添加"><a href="#_2-2-1-组件添加" class="header-anchor">#</a> 2.2.1 组件添加</h4> <ol><li><p><code>@Configuration</code></p> <p><code>Spring</code>中注册一个组件需要编写<code>bean.xml</code>，<code>SpringBoot</code>中则不需要，而是通过注解来注册组件</p> <p>假设有以下<code>bean</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>
    <span class="token comment">// geter seter 有参构造 无参构造</span>
<span class="token punctuation">}</span>
</code></pre></div><p>新建一个<code>MyConfig.java</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// 告诉SpringBoot这是一个配置类</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>  <span class="token comment">//在容器中添加组件，以方法名作为组件的id。返回类型就是组件类型。返回的值就是组件在容器中的实例</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>配置类本身也是组件</p> <p><code>proxyBeanMethods</code>: 代理<code>bean</code>的方法，如果为<code>true</code>，则获得<code>MyConfig</code>的实例之后调用本身的方法，返回的对象永远都是相同的。如果为<code>false</code>则不同，默认为<code>true</code></p> <p><code>proxyBeanMethods=true</code>称为<code>Full</code>模式：对于一个组件的调用，<code>SpringBoot</code>都会去检查容器中是否存在</p> <p><code>proxyBeanMethods=false</code>称为<code>Lite</code>模式：对于一个组件的调用，<code>SpringBoot</code>不会去检查容器中是否存在</p> <p><code>@Bean</code>可传入一个字符串作为组件的<code>id</code></p> <p><strong>使用场景</strong></p> <p>如果一个组件中没有依赖其他组件推荐使用<code>Lite</code>模式，如果使用了组件则推荐使用<code>Full</code></p></li> <li><p><code>Spring</code>中其他添加组件的注解</p> <p><code>@Component</code>、<code>@Controller</code>、<code>@Service</code>、<code>@Repository</code></p> <p>组件的<code>id</code>是类名称，首字母小写</p></li> <li><p><code>@Import()</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><p>参数为一个数组，会在容器中自动创建出这连个类型的组件，默认组件的名字为类的全类名</p></li> <li><p><code>@Conditional</code></p> <p>条件装配：满足<code>Conditional</code>指定的条件，才进行注入。它是一个根注解，其下有许多的子注解。</p></li> <li><p><code>@ImportResource()</code>原生配置文件导入组件</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ImportResource</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:beans.xml&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p><code>@ImportResource</code>加载任意类上，可以导入从配置文件中定义的组件</p></li></ol> <h4 id="_2-2-2-配置绑定"><a href="#_2-2-2-配置绑定" class="header-anchor">#</a> 2.2.2 配置绑定</h4> <p><strong>第一种方式</strong></p> <ol><li><p>新建一个实体类</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/*
* 只有在容器中的组件，才会拥有SpringBoot提供的功能
* */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;mycar&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> brand<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> price<span class="token punctuation">;</span>
	<span class="token comment">// geter seter 有参构造 无参构造</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>@ConfigurationProperties</code>指定声明的属性在配置文件中的前缀</p></li> <li><p>在<code>application.properties</code>中添加</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">mycar.brand</span><span class="token punctuation">=</span><span class="token attr-value">BYD</span>
<span class="token attr-name">mycar.price</span><span class="token punctuation">=</span><span class="token attr-value">100000</span>
</code></pre></div></li> <li><p>声明的配置就会被注入到<code>Car</code>组件内</p></li></ol> <p><strong>第二种方式</strong></p> <p>在配置类上添加以下注解</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token class-name">Car</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
</code></pre></div><p>在实体类上就不用添加注册组件的注解了，一般用于第三方包的配置绑定</p> <h3 id="_2-3-自动配置原理入门"><a href="#_2-3-自动配置原理入门" class="header-anchor">#</a> 2.3 自动配置原理入门</h3> <h4 id="_2-3-1-引导加载自动配置类"><a href="#_2-3-1-引导加载自动配置类" class="header-anchor">#</a> 2.3.1 引导加载自动配置类</h4> <p><code>@SpringBootApplication</code>相当于以下三个注解</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootConfiguration</span>
<span class="token annotation punctuation">@EnableAutoConfiguration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>excludeFilters <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span>CUSTOM<span class="token punctuation">,</span> classes <span class="token operator">=</span> <span class="token class-name">TypeExcludeFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span>CUSTOM<span class="token punctuation">,</span> classes <span class="token operator">=</span> <span class="token class-name">AutoConfigurationExcludeFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">SpringBootApplication</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><ol><li><p><code>@SpringBootConfiguration</code></p> <p>相当于<code>@Configuration</code>是一个配置类</p></li> <li><p><code>@ComponentScan</code></p> <p>指定要扫描的包</p></li> <li><p><code>@EnableAutoConfiguration</code>是以下两个注解的合成</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@AutoConfigurationPackage</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurationImportSelector</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">EnableAutoConfiguration</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><ul><li><p><code>@AutoConfigurationPackage</code>自动配置包内部实现是一个<code>@Import</code></p> <div class="language- extra-class"><pre class="language-text"><code>@Import(AutoConfigurationPackages.Registrar.class)
public @interface AutoConfigurationPackage {}
</code></pre></div><p>利用<code>Registrar</code>给容器中导入一系列组件</p> <p>将指定的一个包下的所有组件导入进来，即将<code>MainApplication</code>所在的包</p></li> <li><p><code>@Import(AutoConfigurationImportSelector.class)</code></p> <p>利用<code>public String[] selectImports(AnnotationMetadata annotationMetadata)</code>给容器中批量导入一系列组件</p> <p>调用以下方法获取所有需要导入到容器的配置类</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> configurations <span class="token operator">=</span> <span class="token function">getCandidateConfigurations</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">,</span> attributes<span class="token punctuation">)</span>
</code></pre></div><p>利用工厂加载<code>Map&lt;String, List&lt;String&gt;&gt; loadSpringFactories(@Nullable ClassLoader classLoader)</code>得到所有的组件，这个方法是从从<code>META-INF/spring.factories</code>位置来加载一个文件。默认扫描我们当前系统里面所有<code>META-INF/spring.factories</code>位置的文件</p> <p><code>spring-boot-autoconfigure-2.3.4.RELEASE.jar</code>包里面也有<code>META-INF/spring.factories</code>，其下有<code>127</code>个加载类</p></li></ul></li></ol> <h4 id="_2-3-2-按需开启自动配置项"><a href="#_2-3-2-按需开启自动配置项" class="header-anchor">#</a> 2.3.2 按需开启自动配置项</h4> <p>虽然我们<code>127</code>个场景的所有自动配置启动的时候默认全部加载，但最终会按需配置</p> <p>总结：</p> <ul><li><p><code>SpringBoot</code>先加载所有的自动配置类</p></li> <li><p>每个自动配置类按照条件进行生效，如果生效则会默认启动属性绑定的功能</p></li> <li><p>生效的配置类就会给容器中装配很多组件</p></li> <li><p>只要容器中有这些组件，相当于功能就有了</p></li> <li><p>定制化配置的两种方法</p> <p>用户直接使用<code>@Bean</code>自己注入一个组件，<code>SpringBoot</code>就不会自动配置对应的组件</p> <p>在配置文件<code>application.properties</code>中进行配置</p></li></ul> <h4 id="_2-3-3-最佳实践"><a href="#_2-3-3-最佳实践" class="header-anchor">#</a> 2.3.3 最佳实践</h4> <ol><li><p>引入场景依赖即<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using-spring-boot.html#using-boot-starter" target="_blank" rel="noopener noreferrer">starter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>查看自动配置了哪些(选做)</p> <ul><li>自己分析，引入场景对应的自动配置一般都生效了</li> <li><code>application.properties</code>中<code>debug=true</code>开启自动配置报告，<code>Negative</code>（不生效）<code>Positive</code>（生效）</li></ul></li> <li><p>是否需要修改</p> <ul><li><p>参照<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/appendix-application-properties.html#common-application-properties" target="_blank" rel="noopener noreferrer">文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>自己分析。<code>xxxProperties</code>绑定了哪些配置</p></li> <li><p>自定义加入或者替换组件</p> <p><code>@Bean</code>、<code>@Component</code>。。。</p></li> <li><p>自定义器<code>xxxCustomizer</code></p></li></ul></li> <li><p><code>dev-tools</code>热更新<kbd>Ctrl</kbd>+<kbd>F9</kbd></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-devtools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ol> <h2 id="_3-配置文件"><a href="#_3-配置文件" class="header-anchor">#</a> 3. 配置文件</h2> <p><code>properties</code>文件作为配置文件的书写十分不方便，因此<code>SpringBoot</code>的配置文件一般采用<code>YAML</code>格式</p> <p><code>yaml</code>文件提示依赖</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-configuration-processor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token comment">&lt;!--将yaml提示依赖在打包时移除--&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>excludes</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-configuration-processor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>excludes</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_3-1-基本语法"><a href="#_3-1-基本语法" class="header-anchor">#</a> 3.1 基本语法</h3> <ul><li><code>key: value</code>，<code>kv</code>之间有空格</li> <li>大小写敏感</li> <li>使用缩进表示层级关系</li> <li>缩进不允许使用<kbd>Tab</kbd>，只允许<kbd>空格</kbd></li> <li>缩进的空格树不重要，只要相同层级的元素左对齐即可</li> <li><code>#</code>表示注释</li> <li>字符串不需要加<code>&quot;&quot;</code></li></ul> <h3 id="_3-2-数据类型"><a href="#_3-2-数据类型" class="header-anchor">#</a> 3.2 数据类型</h3> <ul><li>字面量：单个的、不可再分的值。<code>date</code>、<code>boolean</code>、<code>string</code>、<code>number</code>、<code>null</code></li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">Key</span><span class="token punctuation">:</span> value
</code></pre></div><ul><li><p>对象：键值对的集合。<code>map</code>、<code>hash</code>、<code>set</code>、<code>object</code></p> <p>行内写法</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">key</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">k1</span><span class="token punctuation">:</span> v1<span class="token punctuation">,</span> <span class="token key atrule">k2</span><span class="token punctuation">:</span> v2<span class="token punctuation">,</span> <span class="token key atrule">k3</span><span class="token punctuation">:</span> v3<span class="token punctuation">}</span>
</code></pre></div><p>分行写法</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">key</span><span class="token punctuation">:</span>
	<span class="token key atrule">k1</span><span class="token punctuation">:</span> v1
	<span class="token key atrule">k2</span><span class="token punctuation">:</span> v2
	<span class="token key atrule">k3</span><span class="token punctuation">:</span> v3
</code></pre></div></li> <li><p>数组：一行按次序排列的值。<code>array</code>、<code>list</code>、<code>queue</code></p> <p>行内写法</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">key</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>v1<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> v3<span class="token punctuation">]</span>
</code></pre></div><p>分行写法</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">key</span><span class="token punctuation">:</span>
	<span class="token punctuation">-</span> v1
	<span class="token punctuation">-</span> v2
	<span class="token punctuation">-</span> v3
</code></pre></div></li></ul> <h3 id="_3-3-具体实现"><a href="#_3-3-具体实现" class="header-anchor">#</a> 3.3 具体实现</h3> <ol><li><p>新建<code>Car.java</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> brand<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> price<span class="token punctuation">;</span>
    <span class="token comment">// geter seter 有参构造 无参构造 toString</span>
<span class="token punctuation">}</span>    
</code></pre></div></li> <li><p>新建<code>Person.java</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> userName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> boos<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> birth<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Car</span> car<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> interests<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> animal<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> score<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Double</span><span class="token punctuation">&gt;</span></span> salaries<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Car</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> allCars<span class="token punctuation">;</span>
    <span class="token comment">// geter seter 有参构造 无参构造 toString</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p><code>resource</code>目录下新建<code>application.yaml</code></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">person</span><span class="token punctuation">:</span>
    <span class="token key atrule">userName</span><span class="token punctuation">:</span> 张三
    <span class="token key atrule">boos</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">birth</span><span class="token punctuation">:</span> 1999/11/11
    <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">22</span>
    <span class="token key atrule">car</span><span class="token punctuation">:</span>
        <span class="token key atrule">brand</span><span class="token punctuation">:</span> 奔驰
        <span class="token key atrule">price</span><span class="token punctuation">:</span> <span class="token number">1000000000</span>
    <span class="token key atrule">intersts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> 吃饭
        <span class="token punctuation">-</span> 睡觉
        <span class="token punctuation">-</span> 写代码
    <span class="token key atrule">animal</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>大黄<span class="token punctuation">,</span> 小黑<span class="token punctuation">]</span>
    <span class="token key atrule">score</span><span class="token punctuation">:</span>
        <span class="token key atrule">java程序设计</span><span class="token punctuation">:</span> <span class="token number">100</span>
        <span class="token key atrule">数据结构</span><span class="token punctuation">:</span> <span class="token number">62</span>
        <span class="token key atrule">操作系统</span><span class="token punctuation">:</span> <span class="token number">90</span>
    <span class="token key atrule">salaries</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token number">1000000</span>
        <span class="token punctuation">-</span> <span class="token number">300000</span>
    <span class="token key atrule">allCars</span><span class="token punctuation">:</span>
        <span class="token key atrule">helth</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">brand</span><span class="token punctuation">:</span> 奔驰<span class="token punctuation">,</span> <span class="token key atrule">price</span><span class="token punctuation">:</span> <span class="token number">1800000</span><span class="token punctuation">}</span>
            <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">brand</span><span class="token punctuation">:</span> 玛莎拉蒂<span class="token punctuation">,</span> <span class="token key atrule">price</span><span class="token punctuation">:</span> <span class="token number">3000000</span><span class="token punctuation">}</span>
        <span class="token key atrule">sick</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">brand</span><span class="token punctuation">:</span> 迈巴赫<span class="token punctuation">,</span> <span class="token key atrule">price</span><span class="token punctuation">:</span> <span class="token number">4000000</span><span class="token punctuation">}</span>
            <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">brand</span><span class="token punctuation">:</span> 兰博基尼<span class="token punctuation">,</span> <span class="token key atrule">price</span><span class="token punctuation">:</span> <span class="token number">6000000</span><span class="token punctuation">}</span>
</code></pre></div></li> <li><p>编写<code>controller</code>启动测试</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">Person</span> person<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/person&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> person<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>运行结果</p> <div class="language- extra-class"><pre class="language-text"><code>Person(userName=张三, boos=true, birth=Thu Nov 11 00:00:00 CST 1999, age=22, car=Car{brand='奔驰', price=1000000000}, interests=null, animal=[大黄, 小黑], score={java=100}, salaries=[1000000.0, 300000.0], allCars={helth=[Car{brand='奔驰', price=1800000}, Car{brand='玛莎拉蒂', price=3000000}], sick=[Car{brand='迈巴赫', price=4000000}, Car{brand='兰博基尼', price=6000000}]})
</code></pre></div></li></ol> <p>对于特殊的转义字符<code>&quot;&quot;</code>会正常输出转义字符的含义，<code>''</code>则会转义特殊字符</p> <h2 id="_4-web开发"><a href="#_4-web开发" class="header-anchor">#</a> 4. Web开发</h2> <h3 id="_4-1-springmvc自动配置预览"><a href="#_4-1-springmvc自动配置预览" class="header-anchor">#</a> 4.1  SpringMVC自动配置预览</h3> <ol><li><code>ContentNegotiatingViewResolver</code>和<code>BeanNameViewResolver</code></li> <li>静态资源</li> <li>自动注册<code>Converter, GenericConverters, Formatter</code></li> <li>支持<code>HttpMessageConverters</code></li> <li>自动注册<code>MessageCodesResolver</code></li> <li>静态<code>index.html</code>支持</li> <li>自定义<code>Favicon</code></li> <li>自动使用<code>ConfigurableWebBindingInitializer</code>（<code>DataBinder</code>将请求数据绑定到<code>JavaBean</code>上）</li></ol> <h3 id="_4-2-简单功能分析"><a href="#_4-2-简单功能分析" class="header-anchor">#</a> 4.2 简单功能分析</h3> <h4 id="_4-2-1-静态资源访问"><a href="#_4-2-1-静态资源访问" class="header-anchor">#</a> 4.2.1 静态资源访问</h4> <ol><li><p>静态资源目录</p> <p><code>/static</code>or<code>/public</code>or<code>/resources</code>or<code>/META-INF/resources</code></p> <p>访问：当前项目根路径/+静态资源名</p> <p>原理：静态资源映射<code>/**</code></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># 修改默认的资源路径</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">web</span><span class="token punctuation">:</span>
        <span class="token key atrule">resources</span><span class="token punctuation">:</span>
            <span class="token key atrule">static-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>/test/
</code></pre></div><p>请求进来，先去找<code>Controller</code>看看能不能处理。不能处理的所有请求都交给静态资源处理器。静态资源也找不到就出现<code>404</code></p></li> <li><p>静态资源访问前缀</p> <p>默认无前缀</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">mvc</span><span class="token punctuation">:</span>
        <span class="token key atrule">static-path-pattern</span><span class="token punctuation">:</span> /res/<span class="token important">**</span>
</code></pre></div><p>此时访问静态资源需要 当前项目 + <code>static-path-pattern</code> + 静态资源名</p></li> <li><p>[webjars](<a href="https://www.webjars.org/" target="_blank" rel="noopener noreferrer">WebJars - Web Libraries in Jars<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)</p> <p>将一些前端<code>js</code>库映射为<code>jar</code>包形式</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.webjars<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jquery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.5.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>访问路径</p> <div class="language- extra-class"><pre class="language-text"><code>http://127.0.0.1:8080/webjars/jquery/3.5.1/jquery.js
</code></pre></div></li></ol> <h4 id="_4-2-2-欢迎页支持-首页"><a href="#_4-2-2-欢迎页支持-首页" class="header-anchor">#</a> 4.2.2 欢迎页支持(首页)</h4> <ol><li>静态资源路径下<code>index.html</code>，网站图标同理
<ul><li>可以配置静态资源路径</li> <li>不能够配置静态资源的访问前缀。否则导致<code>index.html</code>和图标不能被默认访问</li></ul></li> <li><code>controller</code>能处理<code>/index</code>请求的</li></ol> <h4 id="_4-2-3-静态资源配置原理"><a href="#_4-2-3-静态资源配置原理" class="header-anchor">#</a> 4.2.3 静态资源配置原理</h4> <ul><li><p><code>SpringBoot</code>启动默认加载<code>xxxAutoConfiguration</code>类(自动配置类)</p></li> <li><p><code>SpringMVC</code>功能的自动配置类<code>WebMvcAutoConfiguration</code>生效</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnWebApplication</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>SERVLET<span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">Servlet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">DispatcherServlet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">WebMvcConfigurer</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span><span class="token class-name">WebMvcConfigurationSupport</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@AutoConfigureOrder</span><span class="token punctuation">(</span><span class="token class-name">Ordered</span><span class="token punctuation">.</span>HIGHEST_PRECEDENCE <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@AutoConfigureAfter</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">DispatcherServletAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">TaskExecutionAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token class-name">ValidationAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebMvcAutoConfiguration</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

</code></pre></div></li> <li><p>给容器中配置的东西</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">EnableWebMvcConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">WebMvcProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">ResourceProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">WebMvcAutoConfigurationAdapter</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>配置文件的相关属性和xxx进行了绑定。WebMvcProperties==<strong>spring.mvc</strong>、ResourceProperties==<strong>spring.resources</strong></p></li> <li><p>如果一个自动配置类只有一个有参构造器，那么有参构造器所有参数的值都会从容器中确定</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//有参构造器所有参数的值都会从容器中确定</span>
<span class="token comment">//ResourceProperties resourceProperties；获取和spring.resources绑定的所有的值的对象</span>
<span class="token comment">//WebMvcProperties mvcProperties 获取和spring.mvc绑定的所有的值的对象</span>
<span class="token comment">//ListableBeanFactory beanFactory Spring的beanFactory</span>
<span class="token comment">//HttpMessageConverters 找到所有的HttpMessageConverters</span>
<span class="token comment">//ResourceHandlerRegistrationCustomizer 找到 资源处理器的自定义器。=========</span>
<span class="token comment">//DispatcherServletPath  </span>
<span class="token comment">//ServletRegistrationBean   给应用注册Servlet、Filter....</span>
<span class="token keyword">public</span> <span class="token class-name">WebMvcAutoConfigurationAdapter</span><span class="token punctuation">(</span><span class="token class-name">ResourceProperties</span> resourceProperties<span class="token punctuation">,</span> <span class="token class-name">WebMvcProperties</span> mvcProperties<span class="token punctuation">,</span>
        <span class="token class-name">ListableBeanFactory</span> beanFactory<span class="token punctuation">,</span> <span class="token class-name">ObjectProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HttpMessageConverters</span><span class="token punctuation">&gt;</span></span> messageConvertersProvider<span class="token punctuation">,</span>
        <span class="token class-name">ObjectProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ResourceHandlerRegistrationCustomizer</span><span class="token punctuation">&gt;</span></span> resourceHandlerRegistrationCustomizerProvider<span class="token punctuation">,</span>
        <span class="token class-name">ObjectProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DispatcherServletPath</span><span class="token punctuation">&gt;</span></span> dispatcherServletPath<span class="token punctuation">,</span>
        <span class="token class-name">ObjectProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServletRegistrationBean</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> servletRegistrations<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>resourceProperties <span class="token operator">=</span> resourceProperties<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mvcProperties <span class="token operator">=</span> mvcProperties<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>beanFactory <span class="token operator">=</span> beanFactory<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>messageConvertersProvider <span class="token operator">=</span> messageConvertersProvider<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>resourceHandlerRegistrationCustomizer <span class="token operator">=</span> resourceHandlerRegistrationCustomizerProvider<span class="token punctuation">.</span><span class="token function">getIfAvailable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dispatcherServletPath <span class="token operator">=</span> dispatcherServletPath<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>servletRegistrations <span class="token operator">=</span> servletRegistrations<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="_4-3-请求参数处理"><a href="#_4-3-请求参数处理" class="header-anchor">#</a> 4.3 请求参数处理</h3> <h4 id="_4-3-1-请求映射"><a href="#_4-3-1-请求映射" class="header-anchor">#</a> 4.3.1 请求映射</h4> <p><code>@xxxMapping</code>restful请求</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/user&quot;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>GET<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;GET-user&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/user&quot;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>POST<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">saveUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;POST-user&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/user&quot;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>PUT<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">putUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;PUT-user&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/user&quot;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>DELETE<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;DELETE-user&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>表单使用<code>RESTFUL</code>风格的<code>PUT</code>请求和<code>DELETE</code>请求需要手动开启</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">mvc</span><span class="token punctuation">:</span>
        <span class="token key atrule">hiddenmethod</span><span class="token punctuation">:</span>
            <span class="token key atrule">filter</span><span class="token punctuation">:</span>
                <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><p>而且表单需要加一个隐藏标签（针对<code>PUT</code>和<code>DELETE</code>），表单的请求方法依然使用<code>POST</code></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/user<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_method<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>PUT<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>REST-PUT<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="_4-3-2-普通参数与基本注解"><a href="#_4-3-2-普通参数与基本注解" class="header-anchor">#</a> 4.3.2 普通参数与基本注解</h4> <p>测试所使用的<code>Controller</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ParameterTestController</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>注解</strong></p> <ol><li><p>获取路径变量</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/car/{id}/owner/{username}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCar</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">,</span> <span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> map<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>访问测试</p> <div class="language- extra-class"><pre class="language-text"><code>访问：http://127.0.0.1:8080/car/1/owner/张三

返回
{
    &quot;id&quot;: 1,
    &quot;username&quot;: &quot;张三&quot;
}
</code></pre></div><p>也可以传递一个<code>Map&lt;String, String&gt; map</code>将参数自动映射到map中</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/car/{id}/owner/{username}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCar</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> map<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>获取请求头</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/header&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;User-Agent&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> userAgent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> userAgent<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>访问测试</p> <div class="language- extra-class"><pre class="language-text"><code>http://127.0.0.1:8080/header

Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4324.96 Safari/537.36 Edg/87.0.705.50
</code></pre></div><p>也可以获取全部的请求头</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/header&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span>  <span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestHeader</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> userAgent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> userAgent<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>访问测试</p> <div class="language-json extra-class"><pre class="language-json"><code>http<span class="token operator">:</span><span class="token comment">//127.0.0.1:8080/header</span>

<span class="token punctuation">{</span><span class="token property">&quot;host&quot;</span><span class="token operator">:</span><span class="token string">&quot;127.0.0.1:8080&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;connection&quot;</span><span class="token operator">:</span><span class="token string">&quot;keep-alive&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;cache-control&quot;</span><span class="token operator">:</span><span class="token string">&quot;max-age=0&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;upgrade-insecure-requests&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;user-agent&quot;</span><span class="token operator">:</span><span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4324.96 Safari/537.36 Edg/87.0.705.50&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;accept&quot;</span><span class="token operator">:</span><span class="token string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;sec-fetch-site&quot;</span><span class="token operator">:</span><span class="token string">&quot;none&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;sec-fetch-mode&quot;</span><span class="token operator">:</span><span class="token string">&quot;navigate&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;sec-fetch-user&quot;</span><span class="token operator">:</span><span class="token string">&quot;?1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;sec-fetch-dest&quot;</span><span class="token operator">:</span><span class="token string">&quot;document&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;accept-encoding&quot;</span><span class="token operator">:</span><span class="token string">&quot;gzip, deflate, br&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;accept-language&quot;</span><span class="token operator">:</span><span class="token string">&quot;zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6,zh-TW;q=0.5&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;cookie&quot;</span><span class="token operator">:</span><span class="token string">&quot;username-127-0-0-1-8888=\&quot;2|1:0|10:1610972519|23:username-127-0-0-1-8888|44:NGMwNzhhZDA5YjQ5NGFmMmJkYWI0YzdjNmY1YTFkOWI=|11f885b4841a2571dbe4df5bb6daa332b092df0b572f891f6941269e3af40230\&quot;&quot;</span><span class="token punctuation">}</span>
</code></pre></div></li> <li><p>获取请求参数</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/param&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getParam</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> age<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>访问测试</p> <div class="language- extra-class"><pre class="language-text"><code>http://127.0.0.1:8080/param?age=10

10
</code></pre></div><p>获取全部请求参数</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/param&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getParam</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> map<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>访问测试</p> <div class="language-json extra-class"><pre class="language-json"><code>http<span class="token operator">:</span><span class="token comment">//127.0.0.1:8080/param?age=10&amp;inters=%E7%AF%AE%E7%90%83&amp;inters=%E7%BC%96%E7%A8%8B</span>

<span class="token punctuation">{</span>
    <span class="token property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token string">&quot;10&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;inters&quot;</span><span class="token operator">:</span> <span class="token string">&quot;篮球&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>请求获取<code>cookie</code>的值</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/cookie&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getCookie</span><span class="token punctuation">(</span><span class="token annotation punctuation">@CookieValue</span><span class="token punctuation">(</span><span class="token string">&quot;ga&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> cookie<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> cookie<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>获取<code>cookie</code>的所有信息</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/cookie&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Cookie</span> <span class="token function">getCookie</span><span class="token punctuation">(</span><span class="token annotation punctuation">@CookieValue</span><span class="token punctuation">(</span><span class="token string">&quot;ga&quot;</span><span class="token punctuation">)</span><span class="token class-name">Cookie</span> cookie<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> cookie<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>获取请求体的值</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/body&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getBody</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> content<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>获取请求属性</p> <p>新建一个类</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RequestController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/goto&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">goToPage</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;成功了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token string">&quot;forward:/success&quot;</span><span class="token punctuation">;</span> <span class="token comment">//转发到 /success请求</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/success&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> msg<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 两种方式取出attribute</span>
        <span class="token comment">// 1. @RequestAttribute</span>
        <span class="token comment">// 2. 原生Servlet</span>

        <span class="token class-name">Object</span> servlet <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;servlet&quot;</span><span class="token punctuation">,</span> servlet<span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;@RequestAttribute&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> map<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>请求测试</p> <div class="language-json extra-class"><pre class="language-json"><code>http<span class="token operator">:</span><span class="token comment">//127.0.0.1:8080/goto</span>

<span class="token punctuation">{</span>
    <span class="token property">&quot;@RequestAttribute&quot;</span><span class="token operator">:</span> <span class="token string">&quot;成功了&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;servlet&quot;</span><span class="token operator">:</span> <span class="token string">&quot;成功了&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>矩阵变量</p> <p>形如以下的请求地址</p> <div class="language- extra-class"><pre class="language-text"><code>http://127.0.0.1:8080/cars/sell;low=34;brand=byd,audi,yd

或者

http://127.0.0.1:8080/cars/sell;low=34;brand=byd;brand=audi;brand=yd
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/cars/{path}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">carsSell</span><span class="token punctuation">(</span><span class="token annotation punctuation">@MatrixVariable</span><span class="token punctuation">(</span><span class="token string">&quot;low&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> low<span class="token punctuation">,</span> <span class="token annotation punctuation">@MatrixVariable</span><span class="token punctuation">(</span><span class="token string">&quot;brand&quot;</span><span class="token punctuation">)</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> brand<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;low&quot;</span><span class="token punctuation">,</span> low<span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;brand&quot;</span><span class="token punctuation">,</span> brand<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> map<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>SpringBoot</code>默认禁用了矩阵变量的功能，需要手动开启</p> <p>第一种方法，在容器中添加一个<code>WebMvcConfigurer</code>组件</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token function">webMvcConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WebMvcConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configurePathMatch</span><span class="token punctuation">(</span><span class="token class-name">PathMatchConfigurer</span> configurer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">UrlPathHelper</span> urlPathHelper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UrlPathHelper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// 设置不移除分号后的内容</span>
                urlPathHelper<span class="token punctuation">.</span><span class="token function">setRemoveSemicolonContent</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                configurer<span class="token punctuation">.</span><span class="token function">setUrlPathHelper</span><span class="token punctuation">(</span>urlPathHelper<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>第二种方法，配置类实现<code>WebMvcConfigurer</code>接口，重写<code>configurePathMatch</code>方法</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configurePathMatch</span><span class="token punctuation">(</span><span class="token class-name">PathMatchConfigurer</span> configurer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">UrlPathHelper</span> urlPathHelper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UrlPathHelper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 设置不移除分号后的内容</span>
        urlPathHelper<span class="token punctuation">.</span><span class="token function">setRemoveSemicolonContent</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        configurer<span class="token punctuation">.</span><span class="token function">setUrlPathHelper</span><span class="token punctuation">(</span>urlPathHelper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h4 id="_4-3-3-自定义的参数绑定"><a href="#_4-3-3-自定义的参数绑定" class="header-anchor">#</a> 4.3.3 自定义的参数绑定</h4> <p><strong>默认绑定</strong></p> <ol><li><p>定义实体类<code>Pet.java</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Pet</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>定义实体类<code>Person.java</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> userName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> birth<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Pet</span> pet<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>表单数据</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/saveuser<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    姓名：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>zhangsan<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span>
    年龄：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>age<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>18<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span>
    生日：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>birth<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2003/12/01<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span>
    宠物姓名：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pet.name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>大黄<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span>
    宠物年龄：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pet.age<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>5<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>保存<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>编写<code>Controller</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/saveuser&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">saveUser</span><span class="token punctuation">(</span><span class="token class-name">Person</span> person<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> person<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>启动测试</p> <div class="language- extra-class"><pre class="language-text"><code>Person(userName=zhangsan, age=18, birth=Mon Dec 01 00:00:00 CST 2003, pet=Pet(name=大黄, age=5))
</code></pre></div></li></ol> <p>数据绑定：页面提交的请求数据<code>GET</code>、<code>POST</code>都可以和对象属性进行绑定</p> <p><strong>自定义绑定</strong></p> <ol><li><p>表单数据</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/saveuser<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    姓名：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>zhangsan<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span>
    年龄：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>age<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>18<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span>
    生日：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>birth<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2003/12/01<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span>
    宠物：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>大黄,10<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>保存<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>自定义转换器</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addFormatters</span><span class="token punctuation">(</span><span class="token class-name">FormatterRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registry<span class="token punctuation">.</span><span class="token function">addConverter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Pet</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Pet</span> <span class="token function">convert</span><span class="token punctuation">(</span><span class="token class-name">String</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 转换源数据</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Pet</span> pet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Pet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> split <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    pet<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    pet<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> pet<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p><code>Controller</code>不做变化</p></li></ol> <h3 id="_4-4-数据响应与内容协商"><a href="#_4-4-数据响应与内容协商" class="header-anchor">#</a> 4.4 数据响应与内容协商</h3> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><h4 id="_4-4-1-响应json"><a href="#_4-4-1-响应json" class="header-anchor">#</a> 4.4.1 响应JSON</h4> <p><code>spring-boot-starter-web</code>中已经自动引入了<code>json</code>场景，它会给请求对象默认返回<code>JSON</code>值</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ResponseBody</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/test/person&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Person</span> <span class="token function">getPerson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Person</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Pet</span><span class="token punctuation">(</span><span class="token string">&quot;大黄&quot;</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> person<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>支持的返回值类型</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ModelAndView</span>
<span class="token class-name">Model</span>
<span class="token class-name">View</span>
<span class="token class-name">ResponseEntity</span>
<span class="token class-name">ResponseBodyEmitter</span>
<span class="token class-name">StreamingResponseBody</span>
<span class="token class-name">HttpEntity</span>
<span class="token class-name">HttpHeaders</span>
<span class="token class-name">Callable</span>
<span class="token class-name">DeferedResult</span>
<span class="token class-name">CompletionStage</span>
<span class="token class-name">WebAsyncTask</span>
有 <span class="token annotation punctuation">@ModelAttribute</span>、<span class="token annotation punctuation">@ResponseBody</span>注解的
</code></pre></div><h4 id="_4-4-2-内容协商"><a href="#_4-4-2-内容协商" class="header-anchor">#</a> 4.4.2 内容协商</h4> <p>根据客户端接受能力的不同，返回不同媒体类型的数据</p> <p>假设返回<code>json</code>和<code>xml</code></p> <ol><li><p>引入<code>xml</code>依赖（<code>json</code>依赖已经包含在<code>web starter</code>内）</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.fasterxml.jackson.dataformat<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jackson-dataformat-xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>再次请求<code>http://127.0.0.1:8080/test/person</code></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Person</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>userName</span><span class="token punctuation">&gt;</span></span>张三<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>userName</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>age</span><span class="token punctuation">&gt;</span></span>18<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>age</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>birth</span><span class="token punctuation">&gt;</span></span>2021-01-28T06:06:51.760+00:00<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>birth</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pet</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>大黄<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>age</span><span class="token punctuation">&gt;</span></span>180<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>age</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pet</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Person</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p><code>SpringBoot</code>根据请求头中的<code>Accept</code>字段，来返回不同的数据。浏览器默认<code>xml</code>优先</p></li> <li><p>开启参数方式的内容协商<code>application.yaml</code></p> <p>为了方便能够根据不同的场景返回不同类型的数据，需要开启参数内容协商</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">mvc</span><span class="token punctuation">:</span>
        <span class="token key atrule">contentnegotiation</span><span class="token punctuation">:</span>
            <span class="token key atrule">favor-parameter</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><p>开启过后只需要请求地址加上一个<code>format</code>参数就能返回不同的数据类型</p> <div class="language- extra-class"><pre class="language-text"><code>// 返回json
http://127.0.0.1:8080/test/person?format=json

// 返回xml
http://127.0.0.1:8080/test/person?format=xml
</code></pre></div></li></ol> <p><strong>自定义内容协商</strong></p> <ul><li><p>浏览器发送请求直接返回<code>xml</code></p></li> <li><p><code>ajax</code>发送请求 返回<code>json</code></p></li> <li><p><code>app</code>发送请求 返回自定义的数据格式</p></li></ul> <ol><li><p>在<code>WebCofing.java</code>（该类以实现<code>WebMvcConfigurer</code>接口）中添加一个方法</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">extendMessageConverters</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HttpMessageConverter</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> converters<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    converters<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AppMessageConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>新建一个<code>AppMessageConverter</code>类</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppMessageConverter</span> <span class="token keyword">implements</span> <span class="token class-name">HttpMessageConverter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">canRead</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">,</span> <span class="token class-name">MediaType</span> mediaType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 能不能够自动映射到标注了@RequestBody的参数上</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">canWrite</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">,</span> <span class="token class-name">MediaType</span> mediaType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果是Person类型就能够正常写入,并返回给服务器</span>

        <span class="token keyword">return</span> clazz<span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MediaType</span><span class="token punctuation">&gt;</span></span> <span class="token function">getSupportedMediaTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取所有支持的类型</span>
        <span class="token comment">// 假设app要返回的数据类型是 application/x-valid</span>

        <span class="token keyword">return</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token function">parseMediaTypes</span><span class="token punctuation">(</span><span class="token string">&quot;application/x-valid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Person</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">,</span> <span class="token class-name">HttpInputMessage</span> inputMessage<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">HttpMessageNotReadableException</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">Person</span> person<span class="token punctuation">,</span> <span class="token class-name">MediaType</span> contentType<span class="token punctuation">,</span> <span class="token class-name">HttpOutputMessage</span> outputMessage<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">HttpMessageNotWritableException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 自定义类型数据的写出</span>
        <span class="token class-name">String</span> data <span class="token operator">=</span> person<span class="token punctuation">.</span><span class="token function">getUserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;;&quot;</span> <span class="token operator">+</span> person<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;;&quot;</span> <span class="token operator">+</span> person<span class="token punctuation">.</span><span class="token function">getBirth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;;&quot;</span> <span class="token operator">+</span> person<span class="token punctuation">.</span><span class="token function">getPet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 写出</span>
        <span class="token class-name">OutputStream</span> body <span class="token operator">=</span> outputMessage<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        body<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        body<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p><code>WebConfig.java</code>添加参数指定访问的方法</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configureContentNegotiation</span><span class="token punctuation">(</span><span class="token class-name">ContentNegotiationConfigurer</span> configurer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">MediaType</span><span class="token punctuation">&gt;</span></span> mediaType <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 指定支持解析哪些参数对应的哪些媒体类型</span>
    mediaType<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mediaType<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;xml&quot;</span><span class="token punctuation">,</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_XML<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mediaType<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;valid&quot;</span><span class="token punctuation">,</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token function">parseMediaType</span><span class="token punctuation">(</span><span class="token string">&quot;application/x-valid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 基于请求参数的适配策略</span>
    <span class="token class-name">ParameterContentNegotiationStrategy</span> parameterStrategy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ParameterContentNegotiationStrategy</span><span class="token punctuation">(</span>mediaType<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 基于请求头的适配策略</span>
    <span class="token class-name">HeaderContentNegotiationStrategy</span> headerStrategy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HeaderContentNegotiationStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    configurer<span class="token punctuation">.</span><span class="token function">strategies</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>parameterStrategy<span class="token punctuation">,</span> headerStrategy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// http://127.0.0.1:8080/test/person?format=valid</span>
</code></pre></div></li></ol> <h3 id="_4-5-视图解析与模板引擎"><a href="#_4-5-视图解析与模板引擎" class="header-anchor">#</a> 4.5 视图解析与模板引擎</h3> <p>视图解析：<code>SpringBoot</code>默认不支持<code>JSP</code>，需要引入第三方末班引擎技术实现页面渲染</p> <h4 id="_4-5-1-视图解析"><a href="#_4-5-1-视图解析" class="header-anchor">#</a> 4.5.1 视图解析</h4> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><h4 id="_4-5-2-模板引擎thymeleaf"><a href="#_4-5-2-模板引擎thymeleaf" class="header-anchor">#</a> 4.5.2 模板引擎Thymeleaf</h4> <p>引入依赖</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>基本语法</strong></p> <ol><li><p>表达式</p> <table><thead><tr><th>表达式名字</th> <th>语法</th> <th>用途</th></tr></thead> <tbody><tr><td>变量取值</td> <td>${}</td> <td>获取请求域、session域、对象等</td></tr> <tr><td>选择变量</td> <td>*{}</td> <td>获取上下文对象</td></tr> <tr><td>消息</td> <td>#{}</td> <td>获取国际化等值</td></tr> <tr><td>链接</td> <td>@{}</td> <td>生成链接</td></tr> <tr><td>片段表达式</td> <td>~{}</td> <td>jsp:include作用，引入公共页面</td></tr></tbody></table></li> <li><p>条件运算</p> <p>if-then：<code>(if) ? (then)</code></p> <p>if-then-else：<code>(if) ? (then) : (else)</code></p> <p>Default：<code>(value) ? : (defaultvalue)</code></p></li> <li><p>配置的规则</p> <p>模板都放在<code>classpath:/templates/</code></p> <p>后缀都是<code>.html</code></p> <p><code>xxx.html</code>文件都引入名称空间</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.thymeleaf.org<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ol> <p><strong>快速入门</strong></p> <ol><li><p>新建<code>thymeleaf.html</code></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.thymeleaf.org<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Hello World<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${test}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>哈哈<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.qq.com<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${link}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>去百度<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>编写<code>controller</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ViewTestController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/thymeleaf&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token class-name">Thymeleaf</span><span class="token punctuation">(</span><span class="token class-name">Model</span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// Model 中的放入的数据会自动放入到请求域中‘</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;我是thymeleaf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://www.baidu.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;thymeleaf&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h3 id="_4-6-拦截器"><a href="#_4-6-拦截器" class="header-anchor">#</a> 4.6 拦截器</h3> <ol><li><p>新建<code>LoginInterceptor.java</code>并实现<code>HandlerInterceptor</code>接口</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerInterceptor</span> <span class="token punctuation">{</span>

    <span class="token comment">// 目标方法执行之前</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 目标方法执行之后</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">ModelAndView</span> modelAndView<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token comment">// 页面渲染之后</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterCompletion</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>编写登录检查的逻辑</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">// 登录检查</span>
    <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Object</span> loginUser <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;loginUser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>loginUser <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 登录放行</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 拦截住。未登录。跳转至登录页</span>
    request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;请登录后重试&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    request<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>新建<code>WebConfig.java</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addInterceptors</span><span class="token punctuation">(</span><span class="token class-name">InterceptorRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registry<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoginInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            	<span class="token comment">// 拦截哪些请求，/**所有请求，静态资源也会被拦截</span>
                <span class="token punctuation">.</span><span class="token function">addPathPatterns</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">)</span>
            	<span class="token comment">// 不拦截哪些请求，静态资源也需要放行</span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/css/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/fonts/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/images/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/js/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
</code></pre></div></li></ol> <p>}</p> <div class="language- extra-class"><pre class="language-text"><code>

### 4.7 文件上传

1. 表单

```html
&lt;form role=&quot;form&quot; th:action=&quot;@{/upload}&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;
    &lt;div class=&quot;form-group&quot;&gt;
        &lt;label for=&quot;exampleInputEmail1&quot;&gt;邮箱&lt;/label&gt;
        &lt;input name=&quot;email&quot; type=&quot;email&quot; class=&quot;form-control&quot; id=&quot;exampleInputEmail1&quot; placeholder=&quot;Enter email&quot;&gt;
    &lt;/div&gt;
    &lt;div class=&quot;form-group&quot;&gt;
        &lt;label for=&quot;exampleInputPassword1&quot;&gt;名字&lt;/label&gt;
        &lt;input name=&quot;username&quot; type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;exampleInputPassword1&quot; placeholder=&quot;Password&quot;&gt;
    &lt;/div&gt;
    &lt;div class=&quot;form-group&quot;&gt;
        &lt;label for=&quot;exampleInputFile&quot;&gt;单文件上传&lt;/label&gt;
        &lt;input name=&quot;file&quot; type=&quot;file&quot; id=&quot;exampleInputFile&quot;&gt;
    &lt;/div&gt;
    &lt;div class=&quot;form-group&quot;&gt;
        &lt;label for=&quot;exampleInputFile&quot;&gt;多文件上传&lt;/label&gt;
        &lt;input name=&quot;files&quot; type=&quot;file&quot; multiple&gt;
    &lt;/div&gt;
    &lt;div class=&quot;checkbox&quot;&gt;
        &lt;label&gt;
        &lt;input type=&quot;checkbox&quot;&gt; Check me out
        &lt;/label&gt;
    &lt;/div&gt;
    &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;提交&lt;/button&gt;
&lt;/form&gt;
</code></pre></div><ol start="2"><li><p>编写<code>controller</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/upload&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> email<span class="token punctuation">,</span>
                     <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> userName<span class="token punctuation">,</span>
                     <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;file&quot;</span><span class="token punctuation">)</span> <span class="token class-name">MultipartFile</span> singleFile<span class="token punctuation">,</span>
                     <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;files&quot;</span><span class="token punctuation">)</span> <span class="token class-name">MultipartFile</span><span class="token punctuation">[</span><span class="token punctuation">]</span> manyFile<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>

    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>userName<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>singleFile<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 保存到文件服务器</span>
        singleFile<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\code\\java\\SpringBoot2\\03_admin\\&quot;</span> <span class="token operator">+</span> singleFile<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>manyFile<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file <span class="token operator">:</span> manyFile<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>file<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                singleFile<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\code\\java\\SpringBoot2\\03_admin\\&quot;</span> <span class="token operator">+</span> file<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 上传成功返回main页面</span>
    <span class="token keyword">return</span> <span class="token string">&quot;main&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>配置文件的上传规则</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
        <span class="token key atrule">multipart</span><span class="token punctuation">:</span>
            <span class="token key atrule">max-file-size</span><span class="token punctuation">:</span> 10MB
            <span class="token key atrule">max-request-size</span><span class="token punctuation">:</span> 100MB
</code></pre></div></li></ol> <h3 id="_4-8-异常处理"><a href="#_4-8-异常处理" class="header-anchor">#</a> 4.8 异常处理</h3> <ul><li><p>默认情况下，<code>Spring Boot</code>提供<code>/error</code>处理所有错误的映射</p></li> <li><p>对于机器客户端，它将生成<code>JSON</code>响应，其中包含错误，<code>HTTP</code>状态和异常消息的详细信息。对于浏览器客户端，响应一个<code>whitelabel</code>错误视图，以<code>HTML</code>格式呈现相同的数据</p></li> <li><p>要对其进行自定义，添加<code>View</code>解析为<code>error</code></p></li> <li><p>要完全替换默认行为，可以实现<code>ErrorController</code>并注册该类型的<code>Bean</code>定义，或添加<code>ErrorAttributes</code>类型的组件以使用现有机制但替换其内容</p></li> <li><p><code>templates/error</code>和<code>public/error</code>下的<code>404.html</code>和<code>5xx.html</code>会被当做错误页面响应，可以修改默认的响应路径</p> <div class="language- extra-class"><pre class="language-text"><code>server:
    error:
        path: 
</code></pre></div></li></ul> <p><strong>自定义异常处理</strong></p> <ol><li><p><code>@ControllerAdvice</code>+<code>@ExceptionHandler</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ControllerAdvice</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GlobalExceptionHandler</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ArithmeticException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//处理异常的类型</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">handlerMathException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;异常是: &quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;login&quot;</span><span class="token punctuation">;</span> <span class="token comment">//视图地址</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p><code>@ResponseStatus</code>方式</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ResponseStatus</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span>FORBIDDEN<span class="token punctuation">,</span> reason <span class="token operator">=</span> <span class="token string">&quot;第二种异常处理方式&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecondException</span> <span class="token keyword">extends</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">{</span>
    
    <span class="token keyword">public</span> <span class="token class-name">SecondException</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">SecondException</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这种异常处理方式，需要用户手动抛出</p> <div class="language- extra-class"><pre class="language-text"><code>throw new SecondException();
</code></pre></div></li> <li><p>自定义异常解析器</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">Ordered</span><span class="token punctuation">.</span>HIGHEST_PRECEDENCE<span class="token punctuation">)</span> <span class="token comment">//优先级，数字越小优先级越高</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomerHandlerException</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerExceptionResolver</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">resolveException</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span>
                                         <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span>
                                         <span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            response<span class="token punctuation">.</span><span class="token function">sendError</span><span class="token punctuation">(</span><span class="token number">511</span><span class="token punctuation">,</span> <span class="token string">&quot;自定义的错误解析器&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>自定义的错误解析器同样会使用<code>4xx.html</code>和<code>5xx.html</code>视图</p></li></ol> <h3 id="_4-9-原生web组件注入"><a href="#_4-9-原生web组件注入" class="header-anchor">#</a> 4.9 原生web组件注入</h3> <h4 id="_4-8-1-使用servlet-api"><a href="#_4-8-1-使用servlet-api" class="header-anchor">#</a> 4.8.1 使用Servlet API</h4> <p><strong>servlet</strong></p> <ol><li><p>编写<code>Servlet</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span>urlPatterns <span class="token operator">=</span> <span class="token string">&quot;/servlet&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;servlet原生组件注入&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>启动类上添加注解</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ServletComponentScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span><span class="token string">&quot;com.valid.admin&quot;</span> <span class="token punctuation">)</span>
</code></pre></div></li></ol> <p>原生的<code>servlet</code>组件不会经过<code>SpringBoot</code>的拦截器</p> <p><strong>Filter</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@WebFilter</span><span class="token punctuation">(</span>urlPatterns <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;/css/*&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/images/*&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> filterConfig<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;初始化&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;拦截&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;销毁&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>Listener</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@WebListener</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyListener</span> <span class="token keyword">implements</span> <span class="token class-name">ServletContextListener</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contextInitialized</span><span class="token punctuation">(</span><span class="token class-name">ServletContextEvent</span> sce<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;监听项目初始化&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contextDestroyed</span><span class="token punctuation">(</span><span class="token class-name">ServletContextEvent</span> sce<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;监听项目销毁&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_4-8-2-registerbean"><a href="#_4-8-2-registerbean" class="header-anchor">#</a> 4.8.2 RegisterBean</h4> <p>不使用<code>@Webxxx</code>注解的方式注入组件</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRegisterConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ServletRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyServlet</span><span class="token punctuation">&gt;</span></span> <span class="token function">myServlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ServletRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyServlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;/my&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">FilterRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyFilter</span><span class="token punctuation">&gt;</span></span> <span class="token function">myFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 第二个参数为要拦截的servlet</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FilterRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">myServlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ServletListenerRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyListener</span><span class="token punctuation">&gt;</span></span> <span class="token function">myListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ServletListenerRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_5-数据访问"><a href="#_5-数据访问" class="header-anchor">#</a> 5. 数据访问</h2> <h3 id="_5-1-sql"><a href="#_5-1-sql" class="header-anchor">#</a> 5.1 SQL</h3> <h4 id="_5-1-1-数据源的自动配置"><a href="#_5-1-1-数据源的自动配置" class="header-anchor">#</a> 5.1.1 数据源的自动配置</h4> <ol><li><p>导入<code>JDBC</code>依赖</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>分析自动配置</p> <p>自动导入了事务处理、spring-jdbc、数据源</p></li> <li><p>导入<code>Mysql</code>驱动</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>7.0.23<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p><code>application.yaml</code>配置数据源</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
        <span class="token key atrule">url</span><span class="token punctuation">:</span> 
        <span class="token key atrule">username</span><span class="token punctuation">:</span> 
        <span class="token key atrule">password</span><span class="token punctuation">:</span> 
</code></pre></div><p><code>SpringBoot</code>默认已经配置了一个<code>JdbcTemplate</code>对象用于操纵数据库并且可以通过<code>spring.jdbc</code>来修改其属性</p></li> <li><p>测试</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationTests</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> count <span class="token operator">=</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">queryForObject</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT COUNT(*) FROM user&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h4 id="_5-1-2-使用durid数据源"><a href="#_5-1-2-使用durid数据源" class="header-anchor">#</a> 5.1.2 使用Durid数据源</h4> <p><strong>自定义方式</strong></p> <ol><li><p>导入依赖</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>创建一个配置类<code>MyDataSourceConfig.java</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyDataSourceConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;spring.datasource&quot;</span><span class="token punctuation">)</span> <span class="token comment">//绑定配置文件</span>
    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token class-name">DruidDataSource</span> dataSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DruidDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// stat开启页面统计 wall防火墙</span>
<span class="token comment">//        dataSource.setFilters(&quot;stat,wall&quot;);</span>
        <span class="token keyword">return</span> dataSource<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 配置druid的监控页功能</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ServletRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">StatViewServlet</span><span class="token punctuation">&gt;</span></span> <span class="token function">statViewServlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">StatViewServlet</span> statViewServlet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StatViewServlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ServletRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">StatViewServlet</span><span class="token punctuation">&gt;</span></span> registrationBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServletRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>statViewServlet<span class="token punctuation">,</span> <span class="token string">&quot;/druid/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registrationBean<span class="token punctuation">.</span><span class="token function">addInitParameter</span><span class="token punctuation">(</span><span class="token string">&quot;loginUsername&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registrationBean<span class="token punctuation">.</span><span class="token function">addInitParameter</span><span class="token punctuation">(</span><span class="token string">&quot;loginPassword&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> registrationBean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/*
    * WebStatFilter用于采集web-jdbc关联监控的数据
    * */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">FilterRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WebStatFilter</span><span class="token punctuation">&gt;</span></span> <span class="token function">webStatFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">WebStatFilter</span> webStatFilter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebStatFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FilterRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WebStatFilter</span><span class="token punctuation">&gt;</span></span> registrationBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilterRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>webStatFilter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registrationBean<span class="token punctuation">.</span><span class="token function">setUrlPatterns</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registrationBean<span class="token punctuation">.</span><span class="token function">addInitParameter</span><span class="token punctuation">(</span><span class="token string">&quot;exclusions&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> registrationBean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <p><strong>使用starter的方式</strong></p> <p><a href="https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ol><li><p>导入依赖</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>配置项</p> <p>扩展配置项<code>spring.datasource.druid</code></p> <p>监控<code>SpringBean</code>的配置<code>spring.datasource.druid.aop-patterns</code></p> <p>监控页的配置<code>spring.datasource.druid.stat-view-servlet</code>默认监控页是开启的</p> <p><code>web</code>监控配置<code>spring.datasource.druid.web-stat-filter</code>默认开启</p></li> <li><p>具体配置</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> org.mariadb.jdbc.Driver
        <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3308/test<span class="token punctuation">?</span>useSSL=true<span class="token important">&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> root
        <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>

        <span class="token key atrule">druid</span><span class="token punctuation">:</span>
            <span class="token key atrule">aop-patterns</span><span class="token punctuation">:</span> com.valid.admin.* <span class="token comment"># 监控Springbean</span>

            <span class="token key atrule">stat-view-servlet</span><span class="token punctuation">:</span>
                <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
                <span class="token key atrule">login-username</span><span class="token punctuation">:</span> admin
                <span class="token key atrule">login-password</span><span class="token punctuation">:</span> admin
                <span class="token key atrule">reset-enable</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
            <span class="token key atrule">web-stat-filter</span><span class="token punctuation">:</span>
                <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
                <span class="token key atrule">url-pattern</span><span class="token punctuation">:</span> /*
                <span class="token key atrule">exclusions</span><span class="token punctuation">:</span> <span class="token string">'*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*'</span>
                
            <span class="token key atrule">filters</span><span class="token punctuation">:</span> stat<span class="token punctuation">,</span>wall<span class="token punctuation">,</span>slf4j
            <span class="token key atrule">filter</span><span class="token punctuation">:</span>
                <span class="token key atrule">stat</span><span class="token punctuation">:</span>
                    <span class="token key atrule">log-slow-sql</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
                    <span class="token key atrule">slow-sql-millis</span><span class="token punctuation">:</span> <span class="token number">1000</span>
                <span class="token key atrule">wall</span><span class="token punctuation">:</span>
                    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div></li></ol> <h4 id="_5-1-3-整合mybatis"><a href="#_5-1-3-整合mybatis" class="header-anchor">#</a> 5.1.3 整合MyBatis</h4> <p><strong>配置模式</strong></p> <ol><li><p>引入<code>stater</code></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>所有的配置都在<code>mybatis</code>中<code>application.yaml</code>中配置</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
    <span class="token comment"># config-location: classpath:mybatis/mybatis-config.xml # 全局配置文件位置</span>
    <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mybatis/mapper/<span class="token important">*.xml</span> <span class="token comment"># sql映射文件位置</span>
    <span class="token key atrule">configuration</span><span class="token punctuation">:</span>
        <span class="token key atrule">map-underscore-to-camel-case</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 开启驼峰命名映射</span>
<span class="token comment"># 可以不写配置文件，所有的配置都写在configuration     </span>
</code></pre></div></li> <li><p>新建实体类<code>Account.java</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Account</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>新建<code>Mapper</code>接口</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AccountMapper</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Account</span> <span class="token function">getAccountById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>在资源文件夹<code>resource</code>下新建文件夹目录</p> <div class="language- extra-class"><pre class="language-text"><code>mybatis
	- mapper
		- AccountMapper.xml
	- mybatis-config.xml
</code></pre></div><p><code>mybatis-config.xml</code>内容</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">configuration</span>
        <span class="token name">PUBLIC</span> <span class="token string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span>
        <span class="token string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--开启驼峰命名映射--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mapUnderscoreToCamelCase<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><code>AccountMapper.xml</code></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span>
        <span class="token name">PUBLIC</span> <span class="token string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
        <span class="token string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.valid.admin.mapper.AccountMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getAccountById<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.valid.admin.bean.Account<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        select * from account where id = #{id}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>新建<code>service</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">AccountMapper</span> accountMapper<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Account</span> <span class="token function">getAccountById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> accountMapper<span class="token punctuation">.</span><span class="token function">getAccount</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>新建<code>Controller</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IndexController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AccountService</span> accountService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/account&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Account</span> <span class="token function">getAccountById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> accountService<span class="token punctuation">.</span><span class="token function">getAccountById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>访问测试</p> <div class="language-json extra-class"><pre class="language-json"><code>http<span class="token operator">:</span><span class="token comment">//127.0.0.1:8080/account?id=1</span>

<span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token number">18</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <p>对于简单的查询也可以使用<code>sql</code>注解的方式</p> <h4 id="_5-1-4-整合mybatis-plus"><a href="#_5-1-4-整合mybatis-plus" class="header-anchor">#</a> 5.1.4 整合MyBatis-plus</h4> <ol><li><p>导入依赖</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.4.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>分析自动配置</p> <p><strong>mybatis-plus: xxx</strong></p> <p><code>SqlSessionFactory</code>：默认为容器中的数据源</p> <p><code>mapperLocations</code>：<code>classpath*:/mapper/**/*.xml</code>任意包的类路径下的所有<code>mapper</code>文件夹下的<code>xml</code>文件</p> <p>容器中也自动配置了<code>SqlSessionTemplate</code></p> <p><code>@Mapper</code>的接口会被扫描</p></li> <li><p>编写实体类</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token comment">// MybatisPlus中要求所有的字段在数据库中都必须存在，对于不存在的字段应该标注@TableField</span>
    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>exist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> userName<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>exist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>
    
    <span class="token comment">// 以下是数据库字段</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>编写<code>mapper</code>接口</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
<span class="token comment">// 只要继承BaseMapper就会有简单的CRUD功能</span>
</code></pre></div></li> <li><p>启动测试</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token class-name">User</span> user <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;用户信息：{}&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h3 id="_5-2-nosql"><a href="#_5-2-nosql" class="header-anchor">#</a> 5.2 NoSQL</h3> <p>以<code>redis</code>为代表</p> <ol><li><p>导入依赖</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>自动配置</p> <p>配置前缀：<code>spring.redis</code></p> <p>连接工厂：<code>LettuceConnectionConfiguration</code>、<code>JedisConnectionConfiguration</code></p> <p>自动注入了：<code>RedisTemplate&lt;Object, Object&gt;</code>、<code>StringRedisTemplate&lt;String, String&gt;</code></p></li> <li><p>配置文件</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">redis</span><span class="token punctuation">:</span>
        <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.1.103
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
        <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
        <span class="token key atrule">client-type</span><span class="token punctuation">:</span> LETTUCE <span class="token comment"># 操作redis的工具</span>
</code></pre></div></li> <li><p>启动测试</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">StringRedisTemplate</span> redisTemplate<span class="token punctuation">;</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ValueOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> operations <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    operations<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>operations<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h2 id="_6-单元测试"><a href="#_6-单元测试" class="header-anchor">#</a> 6. 单元测试</h2> <p><code>SpringBoot 2.2.0</code>开始引入JUnit5作为单元测试默认库</p> <h3 id="_6-1-junit5的变化"><a href="#_6-1-junit5的变化" class="header-anchor">#</a> 6.1 JUnit5的变化</h3> <p>作为最新版的<code>JUnit</code>框架，<code>JUnit5</code>与之前的版本的<code>Junit</code>框架有很大的不同。由三个不同子项目的几个不同模块组成。</p> <div class="language- extra-class"><pre class="language-text"><code>JUnit=JUnit Platform + JUnit Jupiter + JUnit Vintage
</code></pre></div><p><code>JUnit Platform</code>：是在<code>JVM</code>上启动测试框架的基础，不仅支持<code>JUnit</code>自制的测试引擎，其他测试引擎也都可以接入。</p> <p><code>JUnit Jupiter</code>：提供了<code>JUnit5</code>的新的编程模型，是<code>JUnit5</code>新特性的核心。内部包含了一个测试引擎，用于在<code>Junit Platform</code>上运行</p> <p><code>JUnit Vintage</code>：兼容<code>JUnit4.x</code>，<code>JUnit3.x</code>的测试引擎</p> <p><code>SpringBoot2.4</code>及以上的版本默认移除<code>Vintage</code>的支持，如需使用自行引入</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.junit.vintage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit-vintage-engine<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.hamcrest<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hamcrest-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><code>SpringBoot</code>整合<code>JUnit</code>以后</p> <ul><li>编写测试方法：<code>@Test</code>注解</li> <li><code>JUnit</code>具有<code>Spring</code>的功能，<code>@Autowired</code>、<code>@Transactional</code>(测试完成后自动回滚)</li></ul> <h3 id="_6-2-junit5常用注解"><a href="#_6-2-junit5常用注解" class="header-anchor">#</a> 6.2 JUnit5常用注解</h3> <p><code>JUnit5</code>的注解与<code>JUnit4</code>的注解有所变化</p> <ul><li><code>@Test</code>：表示方法是测试方法。但是与<code>JUnit4</code>的<code>@Test</code>不同，他的职责非常单一不能声明任何属性，拓展的测试将会由<code>Jupiter</code>提供额外测试</li> <li><code>@ParameterizedTest</code>：表示方法是参数化测试</li> <li><code>@RepeatedTest</code>：表明方法可重复执行</li> <li><code>@DisplayName</code>：为测试类或测试方法展示名称</li> <li><code>@BeforeEach</code>：表示在每个单元测试之前执行</li> <li><code>@AfterEach</code>：表示在每个单元测试之后执行</li> <li><code>@BeforeAll</code>：表示在所有单元测试之前执行</li> <li><code>@AfterAll</code>：表示在所有单元测试之后执行</li> <li><code>@Tag</code>：表示单元测试类别，类似于<code>JUnit4</code>中的<code>@Categories</code></li> <li><code>@Disabled</code>：表示测试类或测试方法不执行，类似于<code>JUnit4</code>中的<code>@Ignore</code></li> <li><code>@Timeout</code>：表示测试方法如果超过了指定时间将会返回错误</li> <li><code>@ExtendWith</code>：为测试类或测试方法提供扩展类引用</li></ul> <h3 id="_6-3-断言"><a href="#_6-3-断言" class="header-anchor">#</a> 6.3 断言</h3> <p>断言<code>assertions</code>是测试方法中的核心部分，用来对测试需要满足的条件进行验证。这些断言方法都是<code>org.junit.jupiter.api.Assertions</code>的静态方法。<code>JUnit5</code>内置的断言可以分成如下几个类别：检查业务逻辑返回的数据是否正确</p> <h4 id="_6-3-1-简单断言"><a href="#_6-3-1-简单断言" class="header-anchor">#</a> 6.3.1 简单断言</h4> <p>用来对单个值进行简单的验证</p> <table><thead><tr><th>方法</th> <th>说明</th></tr></thead> <tbody><tr><td>assertEquals</td> <td>判断两个对象或两个原始类型是否相等</td></tr> <tr><td>assertNotEquals</td> <td>判断两个对象或两个原始类型是否不相等</td></tr> <tr><td>assertSame</td> <td>判断两个对象引用是否能指向不同的对象</td></tr> <tr><td>assertNotSame</td> <td>判断两个对象引用是否指向不同的对象</td></tr> <tr><td>assertTrue</td> <td>判断给定的布尔值是否为true</td></tr> <tr><td>assertFalse</td> <td>判断给定的布尔值是否为false</td></tr> <tr><td>assertNull</td> <td>判断给定的对象引用是否为null</td></tr> <tr><td>assertNotNull</td> <td>判断给定的对象引用是否不为null</td></tr></tbody></table> <p><strong>测试示例</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@DisplayName</span><span class="token punctuation">(</span><span class="token string">&quot;测试简单断言&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSimple</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> cal <span class="token operator">=</span> <span class="token function">cal</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> cal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 也可以定义错误信息</span>
    <span class="token comment">// Assertions.assertEquals(4, cal, &quot;计算失败&quot;);</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">cal</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> i <span class="token operator">+</span> j<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果断言执行失败，那么错误往后的代码都不会执行</p> <h4 id="_6-3-2-数组断言"><a href="#_6-3-2-数组断言" class="header-anchor">#</a> 6.3.2 数组断言</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@DisplayName</span><span class="token punctuation">(</span><span class="token string">&quot;测试数组断言&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertArrayEquals</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;数组不相等&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_6-3-3-组合断言"><a href="#_6-3-3-组合断言" class="header-anchor">#</a> 6.3.3 组合断言</h4> <p><code>assertAll</code>方法接受多个<code>org.junit.jupiter.api.Executable</code>函数式接口的实例作为要验证的断言，可以通过<code>lambda</code>表达式横容易的提供这些断言</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@DisplayName</span><span class="token punctuation">(</span><span class="token string">&quot;组合断言&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testAssertAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertAll</span><span class="token punctuation">(</span><span class="token string">&quot;组合断言测试&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span> <span class="token number">1</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_6-3-4-异常断言"><a href="#_6-3-4-异常断言" class="header-anchor">#</a> 6.3.4 异常断言</h4> <p>对于一定会出现异常的情况使用</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@DisplayName</span><span class="token punctuation">(</span><span class="token string">&quot;异常断言&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testAssertThrows</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 扔出断言异常</span>
    <span class="token class-name">ArithmeticException</span> exception <span class="token operator">=</span> <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertThrows</span><span class="token punctuation">(</span>
        <span class="token comment">// 扔出异常</span>
        <span class="token class-name">ArithmeticException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">&quot;没有出现异常&quot;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_6-3-5-超时断言"><a href="#_6-3-5-超时断言" class="header-anchor">#</a> 6.3.5 超时断言</h4> <p>为测试方法设置超时时间</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@DisplayName</span><span class="token punctuation">(</span><span class="token string">&quot;超时断言&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testAssertTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertTimeout</span><span class="token punctuation">(</span>
        <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMillis</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">&quot;方法执行超时&quot;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_6-3-6-快速失败"><a href="#_6-3-6-快速失败" class="header-anchor">#</a> 6.3.6 快速失败</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@DisplayName</span><span class="token punctuation">(</span><span class="token string">&quot;快速测试&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">&quot;通过此方法可以直接使测试失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_6-4-前置条件"><a href="#_6-4-前置条件" class="header-anchor">#</a> 6.4 前置条件</h3> <p><code>JUnit5</code>中的前置条件<code>assumptions</code>类似于断言，不同之处在于不满足的断言会使得测试方法失败，而不满足的前置条件只会使得测试方法的执行终止。前置条件可以看成是测试方法执行的前提，当前提不满足时，就没有继续执行的必要</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@DisplayName</span><span class="token punctuation">(</span><span class="token string">&quot;测试假设&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testAssumptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token string">&quot;结果不是true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;假设成立&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_6-5-嵌套测试"><a href="#_6-5-嵌套测试" class="header-anchor">#</a> 6.5 嵌套测试</h3> <p><code>JUnit5</code>可以通过<code>java</code>中的内部类和<code>@Nested</code>注解实现嵌套测试，从而可以更好的把相关的测试方法组织在一起。在内部类中可以使用<code>@BeforeEach</code>和<code>@AfterEach</code>注解，而且嵌套的层次没有限制</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@DisplayName</span><span class="token punctuation">(</span><span class="token string">&quot;嵌套测试&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Testing</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Nested</span>
    <span class="token annotation punctuation">@DisplayName</span><span class="token punctuation">(</span><span class="token string">&quot;第二层测试&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">class</span> <span class="token class-name">WhenNew</span> <span class="token punctuation">{</span>
    
    	<span class="token annotation punctuation">@Nested</span>
        <span class="token annotation punctuation">@DisplayName</span><span class="token punctuation">(</span><span class="token string">&quot;第三层测试&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">class</span> <span class="token class-name">AfterPushing</span> <span class="token punctuation">{</span>
     
     	<span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>   
</code></pre></div><h3 id="_6-6-参数化测试"><a href="#_6-6-参数化测试" class="header-anchor">#</a> 6.6 参数化测试</h3> <p>参数化测试是<code>JUnit5</code>很重要的一个新特性，它使得用不同的参数多次运行测试称为了可能，也为我们的单元测试带来许多便利</p> <p>利用<code>@ValueSource</code>等注解，指定入参，我们可以使用不同的参数进行多次单元测试，也不需要每新增一个参数就新增一个单元测试，省去了许多冗余的代码</p> <p><strong>常用注解</strong></p> <p><code>@ValueSource</code>：为参数化测试指定入参来源，支持八大基础类以及<code>String</code>类型，<code>Class</code>类型</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ParameterizedTest</span>
<span class="token annotation punctuation">@DisplayName</span><span class="token punctuation">(</span><span class="token string">&quot;参数化测试&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ValueSource</span><span class="token punctuation">(</span>ints <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testParameterized</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>@NullSource</code>：表示为参数化测试提供一个枚举入参</p> <p><code>@CsvFileSource</code>：表示读取指定<code>CSV</code>文件内容作为参数化测试入参</p> <p><code>@MethodSource</code>：表示读取指定方法的返回值作为参数测试入参(注意方法返回需要是一个流)</p> <h2 id="_7-指标监控"><a href="#_7-指标监控" class="header-anchor">#</a> 7. 指标监控</h2> <h3 id="_7-1-springboot-actuator"><a href="#_7-1-springboot-actuator" class="header-anchor">#</a> 7.1 SpringBoot Actuator</h3> <h4 id="_7-1-1-简介"><a href="#_7-1-1-简介" class="header-anchor">#</a> 7.1.1 简介</h4> <p>未来每一个微服务在云上部署后，我们都需要对其进行监控、追踪、审计、控制等。<code>SpringBoot</code>就提取了<code>Actuator</code>场景，使得我们每个微服务快速引用即可获得生产级别的应用监控、审计等功能</p> <p><strong>依赖</strong></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="_7-1-2-如何使用"><a href="#_7-1-2-如何使用" class="header-anchor">#</a> 7.1.2 如何使用</h4> <ul><li><p>导入依赖</p></li> <li><p>访问<code>http://localhost:8080/actuator/**</code></p></li> <li><p>默认以<code>JMX</code>暴露所有的<code>Endpoint</code></p></li> <li><p>配置<code>web</code>的方式暴露</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">management</span><span class="token punctuation">:</span>
    <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
        <span class="token key atrule">web</span><span class="token punctuation">:</span>
            <span class="token key atrule">exposure</span><span class="token punctuation">:</span>
                <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">'*'</span> <span class="token comment"># 以web方式暴露所有端点</span>
</code></pre></div></li></ul> <h3 id="_7-2-actuator-endpoint"><a href="#_7-2-actuator-endpoint" class="header-anchor">#</a> 7.2 Actuator Endpoint</h3> <h4 id="_7-2-1-常用端点"><a href="#_7-2-1-常用端点" class="header-anchor">#</a> 7.2.1 常用端点</h4> <table><thead><tr><th>ID</th> <th>描述</th></tr></thead> <tbody><tr><td>auditevents</td> <td>暴露当前应用程序的审核事件信息。需要一个AuditEventRepository组件</td></tr> <tr><td>beans</td> <td>显示应用中所有的Spring Bean的完整列表</td></tr> <tr><td>caches</td> <td>暴露可用的缓存</td></tr> <tr><td>conditions</td> <td>显示自动配置的所有条件信息，包括匹配或不匹配的原因</td></tr> <tr><td>configprops</td> <td>显示所有@ConfigurationProperties</td></tr> <tr><td>env</td> <td>暴露Spring的属性ConfigurableEnvironment</td></tr> <tr><td>flyway</td> <td>显示已应用的所有Flyway数据库迁移。需要一个或多个Flyway组件</td></tr> <tr><td>health</td> <td>显示应用程序运行状况信息</td></tr> <tr><td>info</td> <td>显示应用程序信息</td></tr> <tr><td>integrationgraph</td> <td>显示Spring integrationgraph，需要依赖spring-integration-core</td></tr> <tr><td>httptrace</td> <td>显示HTTP跟踪信息（默认情况下，最近100个HTTP请求-响应）。需要一个HTTPTraceRepository组件</td></tr> <tr><td>loggers</td> <td>显示和修改应用程序中日志的配置</td></tr> <tr><td>liquibase</td> <td>显示已应用的所有Liquibase数据库迁移。需要一个或多个Liquibase组件</td></tr> <tr><td>metrics</td> <td>显示当前应用程序的指标信息</td></tr> <tr><td>mappings</td> <td>显示所有@RequestMapping路径列表</td></tr> <tr><td>scheduledtasks</td> <td>显示应用程序中的计划任务</td></tr> <tr><td>sessions</td> <td>允许Spring Session支持的会话存储中检索和删除用户会话。需要使用Spring Session的基于Servlet的Web应用程序</td></tr> <tr><td>threaddump</td> <td>执行线程转储</td></tr></tbody></table> <p>常用的<code>Endpoint</code></p> <p><code>health</code>健康状况、<code>metrics</code>运行时指标、<code>loggers</code>日志记录</p> <h4 id="_7-2-2-health"><a href="#_7-2-2-health" class="header-anchor">#</a> 7.2.2 health</h4> <p>配置<code>health</code>的详细信息</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">management</span><span class="token punctuation">:</span>
    <span class="token key atrule">endpoint</span><span class="token punctuation">:</span>
        <span class="token key atrule">health</span><span class="token punctuation">:</span>
            <span class="token key atrule">show-details</span><span class="token punctuation">:</span> always
</code></pre></div><p>配置过之后访问<code>http://127.0.0.1:8080/actuator/health</code>返回的是一个汇总报告</p> <p>只有所有的组件都是<code>up</code>应用才为<code>up</code></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;UP&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;components&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;db&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;UP&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;details&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;database&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MariaDB&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;validationQuery&quot;</span><span class="token operator">:</span> <span class="token string">&quot;isValid()&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;diskSpace&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;UP&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;details&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;total&quot;</span><span class="token operator">:</span> <span class="token number">1000203087872</span><span class="token punctuation">,</span>
                <span class="token property">&quot;free&quot;</span><span class="token operator">:</span> <span class="token number">918287458304</span><span class="token punctuation">,</span>
                <span class="token property">&quot;threshold&quot;</span><span class="token operator">:</span> <span class="token number">10485760</span><span class="token punctuation">,</span>
                <span class="token property">&quot;exists&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;ping&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;UP&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;redis&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;UP&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;details&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;6.0.10&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_7-2-3-mertics-endpoint"><a href="#_7-2-3-mertics-endpoint" class="header-anchor">#</a> 7.2.3 Mertics Endpoint</h4> <p>提供详细的、层级的、控件指标信息，这些信息可以被<code>pull</code>（主动推送）或者<code>push</code>（被动获取）方式得到</p> <ul><li>通过<code>mertics</code>对接多种监控系统</li> <li>简化核心<code>metrics</code>开发</li> <li>添加自定义的<code>metrics</code>或者扩展已有的<code>metrics</code></li></ul> <h3 id="_7-3-定制endpoint"><a href="#_7-3-定制endpoint" class="header-anchor">#</a> 7.3 定制Endpoint</h3> <h4 id="_7-3-1-定制health信息"><a href="#_7-3-1-定制health信息" class="header-anchor">#</a> 7.3.1 定制Health信息</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/*
 * 名字一定是HealthIndicator结尾
 * */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyComHealthIndicator</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractHealthIndicator</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doHealthCheck</span><span class="token punctuation">(</span><span class="token class-name">Health<span class="token punctuation">.</span>Builder</span> builder<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取连接进行测试</span>
        <span class="token comment">// 携带数据</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//            builder.up(); // 健康</span>
            builder<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token class-name">Status</span><span class="token punctuation">.</span>UP<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 连接成功返回的信息</span>
            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;ms&quot;</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            builder<span class="token punctuation">.</span><span class="token function">down</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 不健康</span>
            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;连接超时&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        builder<span class="token punctuation">.</span><span class="token function">withDetails</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>再次访问<code>health</code>端点就会有<code>myCom</code>这个组件的健康状态</p> <h4 id="_7-3-2-定制info信息"><a href="#_7-3-2-定制info信息" class="header-anchor">#</a> 7.3.2 定制info信息</h4> <p><strong>配置文件中配置</strong></p> <p>只需要在配置文件中添加想要访问的信息</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">info</span><span class="token punctuation">:</span>
    <span class="token key atrule">appName</span><span class="token punctuation">:</span> SpringBoot
    <span class="token key atrule">version</span><span class="token punctuation">:</span> 1.0.0
</code></pre></div><p><strong>实现接口方式</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppInfoInfoContributor</span> <span class="token keyword">implements</span> <span class="token class-name">InfoContributor</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contribute</span><span class="token punctuation">(</span><span class="token class-name">Info<span class="token punctuation">.</span>Builder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        builder<span class="token punctuation">.</span><span class="token function">withDetail</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;测试&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withDetail</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_7-3-3-定制metrics"><a href="#_7-3-3-定制metrics" class="header-anchor">#</a> 7.3.3 定制Metrics</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">Counter</span> counter<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token class-name">CityServiceImpl</span><span class="token punctuation">(</span><span class="token class-name">MeterRegistry</span> meterRegistry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 注册指标</span>
	counter <span class="token operator">=</span> meterRegistry<span class="token punctuation">.</span><span class="token function">counter</span><span class="token punctuation">(</span><span class="token string">&quot;cityService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 在需要监控方法内调用counter.increment()</span>
</code></pre></div><h4 id="_7-3-4-定制endpoint"><a href="#_7-3-4-定制endpoint" class="header-anchor">#</a> 7.3.4 定制Endpoint</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Endpoint</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token string">&quot;docker&quot;</span><span class="token punctuation">)</span> <span class="token comment">// endpoint的名字</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyEndpoint</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@ReadOperation</span>
    <span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getDockerInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 端点的读操作，默认的返回值</span>
        <span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonMap</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;up&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@WriteOperation</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stopDocker</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;docker stopped&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 可以使用jconsole调用</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_7-4-整合可视化微服务管理面板"><a href="#_7-4-整合可视化微服务管理面板" class="header-anchor">#</a> 7.4 整合可视化微服务管理面板</h3> <p><strong>管理项目配置</strong></p> <p>新建<code>SpringBoot</code>的管理项目并引入如下依赖</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--可视化面板--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>de.codecentric<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-admin-starter-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.3.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>并在启动类上添加<code>@EnableAdminServer</code></p> <p><strong>需要管理的项目的配置</strong></p> <p>在想要管理的<code>SpringBoot</code>项目中引入如下依赖</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>de.codecentric<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-admin-starter-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.3.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>配置文件</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">boot</span><span class="token punctuation">:</span>
        <span class="token key atrule">admin</span><span class="token punctuation">:</span>
            <span class="token key atrule">client</span><span class="token punctuation">:</span>
                <span class="token key atrule">url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">8081</span> <span class="token comment"># 管理项目服务器地址</span>
                <span class="token key atrule">instance</span><span class="token punctuation">:</span>
                    <span class="token key atrule">prefer-ip</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 使用ip注册</span>
    <span class="token key atrule">application</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> 03_admin  <span class="token comment"># 应用名称</span>
</code></pre></div><h2 id="_8-原理解析"><a href="#_8-原理解析" class="header-anchor">#</a> 8. 原理解析</h2> <h3 id="_8-1-profile功能"><a href="#_8-1-profile功能" class="header-anchor">#</a> 8.1 Profile功能</h3> <h4 id="_8-1-1-配置文件加载"><a href="#_8-1-1-配置文件加载" class="header-anchor">#</a> 8.1.1 配置文件加载</h4> <p>为了方便多环境适配，<code>springboot</code>简化了<code>profile</code>功能</p> <ol><li><p>新建一个<code>controller</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${name:默认值}&quot;</span><span class="token punctuation">)</span> <span class="token comment">//从配置文件中注入值</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>新建<code>application.yaml</code>不填写任何属性</p></li> <li><p>新建<code>application-prod.yaml</code>填写</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">name</span><span class="token punctuation">:</span> prod
</code></pre></div></li> <li><p>新建<code>application-test.yaml</code>填写</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">name</span><span class="token punctuation">:</span> test
</code></pre></div></li></ol> <p>默认<code>StringBoot</code>启动项目是从<code>application.yaml</code>中加载，在<code>application.yaml</code>中通过属性可以指定启动文件（<code>application.yaml</code>默认也会加载）</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
        <span class="token key atrule">active</span><span class="token punctuation">:</span> prod <span class="token comment"># 指定applicaiton-prod.yaml为启动文件</span>
</code></pre></div><p>如果默认配置文件和指定的配置文件中有同名配置，则以指定的配置文件属性为主</p> <p>对于打包后的<code>jar</code>包也可以指定配置文件执行或者指定属性</p> <div class="language- extra-class"><pre class="language-text"><code>java -jar xxx.jar --spring.profiles.active=test --xxx=xxx
</code></pre></div><h4 id="_8-1-2-注解加载"><a href="#_8-1-2-注解加载" class="header-anchor">#</a> 8.1.2 注解加载</h4> <p>指定在不同的环境下注入不同的对象</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><p>在某一个类中需要</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">Person</span> person<span class="token punctuation">;</span>
</code></pre></div><p>可以在是实现类上添加注解</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token string">&quot;prod&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;person&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Boss</span> <span class="token keyword">implements</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
    <span class="token comment">// ......</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;person&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Worker</span> <span class="token keyword">implements</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
    <span class="token comment">// ......</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以实现在不同的环境下加载不同的对象</p> <p><code>@Bean</code>也可以标注在方法上，表明在<code>prod</code>的环境下添加这个组件</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token string">&quot;prod&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">myInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_8-2-外部化配置"><a href="#_8-2-外部化配置" class="header-anchor">#</a> 8.2 外部化配置</h3> <h4 id="_8-2-1-外部配置源"><a href="#_8-2-1-外部配置源" class="header-anchor">#</a> 8.2.1 外部配置源</h4> <p>常用：<code>java</code>属性文件、<code>YAML</code>文件、环境变量、命令行参数</p> <p><code>@Value</code>也可以直接从环境变量中取值</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${MAVEN_HOME}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> msg<span class="token punctuation">;</span>
</code></pre></div><h4 id="_8-2-2-配置文件查找位置"><a href="#_8-2-2-配置文件查找位置" class="header-anchor">#</a> 8.2.2 配置文件查找位置</h4> <ol><li><code>classpath</code>根路径</li> <li><code>classpath</code>根路径下<code>config</code>目录</li> <li><code>jar</code>包当前目录</li> <li><code>jar</code>包当前目录的<code>config</code>目录</li> <li><code>/config</code>子目录的直接子目录</li></ol> <h3 id="_8-3-自定义的starter"><a href="#_8-3-自定义的starter" class="header-anchor">#</a> 8.3 自定义的starter</h3> <ul><li><p><code>starter-pom</code>引入<code>autoconfigurer</code>包</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div></li> <li><p><code>autoconfigure</code>包中配置使用<code>META-INF/spring.factories</code>中<code>EnableAutoConfiguration</code>的值，使得项目启动加载指定的自动配置类</p></li> <li><p>编写自动配置类<code>xxxAutoConfiguration</code> -&gt; <code>xxxProperties</code></p> <ul><li><code>@Configuration</code></li> <li><code>@Conditional</code></li> <li><code>@EnableConfigurationProperties</code></li> <li><code>@Bean</code></li> <li>....</li></ul></li></ul> <p>总结：引入<code>starter</code> -&gt; <code>xxxAutoConfiguration</code> --&gt; 容器中放入组件 --&gt; 绑定<code>xxxProperties</code> --&gt; 配置项</p></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后修改时间: </span> <span class="time">1 分钟前</span></div></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-70334359><li class="level-2" data-v-70334359><a href="/java/SpringBoot.html#_1-基础入门" class="sidebar-link reco-side-_1-基础入门" data-v-70334359>1. 基础入门</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_1-1-spring与springboot" class="sidebar-link reco-side-_1-1-spring与springboot" data-v-70334359>1.1 Spring与SpringBoot</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_1-2-时代背景" class="sidebar-link reco-side-_1-2-时代背景" data-v-70334359>1.2 时代背景</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_1-3-helloworld" class="sidebar-link reco-side-_1-3-helloworld" data-v-70334359>1.3 HelloWorld</a></li><li class="level-2" data-v-70334359><a href="/java/SpringBoot.html#_2-自动配置原理" class="sidebar-link reco-side-_2-自动配置原理" data-v-70334359>2. 自动配置原理</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_2-1-springboot特点" class="sidebar-link reco-side-_2-1-springboot特点" data-v-70334359>2.1 SpringBoot特点</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_2-2-容器功能" class="sidebar-link reco-side-_2-2-容器功能" data-v-70334359>2.2 容器功能</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_2-3-自动配置原理入门" class="sidebar-link reco-side-_2-3-自动配置原理入门" data-v-70334359>2.3 自动配置原理入门</a></li><li class="level-2" data-v-70334359><a href="/java/SpringBoot.html#_3-配置文件" class="sidebar-link reco-side-_3-配置文件" data-v-70334359>3. 配置文件</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_3-1-基本语法" class="sidebar-link reco-side-_3-1-基本语法" data-v-70334359>3.1 基本语法</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_3-2-数据类型" class="sidebar-link reco-side-_3-2-数据类型" data-v-70334359>3.2 数据类型</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_3-3-具体实现" class="sidebar-link reco-side-_3-3-具体实现" data-v-70334359>3.3 具体实现</a></li><li class="level-2" data-v-70334359><a href="/java/SpringBoot.html#_4-web开发" class="sidebar-link reco-side-_4-web开发" data-v-70334359>4. Web开发</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_4-1-springmvc自动配置预览" class="sidebar-link reco-side-_4-1-springmvc自动配置预览" data-v-70334359>4.1  SpringMVC自动配置预览</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_4-2-简单功能分析" class="sidebar-link reco-side-_4-2-简单功能分析" data-v-70334359>4.2 简单功能分析</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_4-3-请求参数处理" class="sidebar-link reco-side-_4-3-请求参数处理" data-v-70334359>4.3 请求参数处理</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_4-4-数据响应与内容协商" class="sidebar-link reco-side-_4-4-数据响应与内容协商" data-v-70334359>4.4 数据响应与内容协商</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_4-5-视图解析与模板引擎" class="sidebar-link reco-side-_4-5-视图解析与模板引擎" data-v-70334359>4.5 视图解析与模板引擎</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_4-6-拦截器" class="sidebar-link reco-side-_4-6-拦截器" data-v-70334359>4.6 拦截器</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_4-8-异常处理" class="sidebar-link reco-side-_4-8-异常处理" data-v-70334359>4.8 异常处理</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_4-9-原生web组件注入" class="sidebar-link reco-side-_4-9-原生web组件注入" data-v-70334359>4.9 原生web组件注入</a></li><li class="level-2" data-v-70334359><a href="/java/SpringBoot.html#_5-数据访问" class="sidebar-link reco-side-_5-数据访问" data-v-70334359>5. 数据访问</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_5-1-sql" class="sidebar-link reco-side-_5-1-sql" data-v-70334359>5.1 SQL</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_5-2-nosql" class="sidebar-link reco-side-_5-2-nosql" data-v-70334359>5.2 NoSQL</a></li><li class="level-2" data-v-70334359><a href="/java/SpringBoot.html#_6-单元测试" class="sidebar-link reco-side-_6-单元测试" data-v-70334359>6. 单元测试</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_6-1-junit5的变化" class="sidebar-link reco-side-_6-1-junit5的变化" data-v-70334359>6.1 JUnit5的变化</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_6-2-junit5常用注解" class="sidebar-link reco-side-_6-2-junit5常用注解" data-v-70334359>6.2 JUnit5常用注解</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_6-3-断言" class="sidebar-link reco-side-_6-3-断言" data-v-70334359>6.3 断言</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_6-4-前置条件" class="sidebar-link reco-side-_6-4-前置条件" data-v-70334359>6.4 前置条件</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_6-5-嵌套测试" class="sidebar-link reco-side-_6-5-嵌套测试" data-v-70334359>6.5 嵌套测试</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_6-6-参数化测试" class="sidebar-link reco-side-_6-6-参数化测试" data-v-70334359>6.6 参数化测试</a></li><li class="level-2" data-v-70334359><a href="/java/SpringBoot.html#_7-指标监控" class="sidebar-link reco-side-_7-指标监控" data-v-70334359>7. 指标监控</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_7-1-springboot-actuator" class="sidebar-link reco-side-_7-1-springboot-actuator" data-v-70334359>7.1 SpringBoot Actuator</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_7-2-actuator-endpoint" class="sidebar-link reco-side-_7-2-actuator-endpoint" data-v-70334359>7.2 Actuator Endpoint</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_7-3-定制endpoint" class="sidebar-link reco-side-_7-3-定制endpoint" data-v-70334359>7.3 定制Endpoint</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_7-4-整合可视化微服务管理面板" class="sidebar-link reco-side-_7-4-整合可视化微服务管理面板" data-v-70334359>7.4 整合可视化微服务管理面板</a></li><li class="level-2" data-v-70334359><a href="/java/SpringBoot.html#_8-原理解析" class="sidebar-link reco-side-_8-原理解析" data-v-70334359>8. 原理解析</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_8-1-profile功能" class="sidebar-link reco-side-_8-1-profile功能" data-v-70334359>8.1 Profile功能</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_8-2-外部化配置" class="sidebar-link reco-side-_8-2-外部化配置" data-v-70334359>8.2 外部化配置</a></li><li class="level-3" data-v-70334359><a href="/java/SpringBoot.html#_8-3-自定义的starter" class="sidebar-link reco-side-_8-3-自定义的starter" data-v-70334359>8.3 自定义的starter</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;left:50px;bottom:0px;width:135px;height:300px;z-index:99999;opacity:0.8;pointer-events:none;"><canvas id="live2d_canvas" width="135" height="300" class="live2d_canvas" style="position:absolute;left:0px;top:0px;width:135px;height:300px;"></canvas></div></div></div>
    <script src="/assets/js/app.24a5dc33.js" defer></script><script src="/assets/js/3.ef08ee50.js" defer></script><script src="/assets/js/1.86f97011.js" defer></script><script src="/assets/js/22.faa1ab48.js" defer></script>
  </body>
</html>
