<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>计算机网络 | 薛定谔see猫</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.059983fa.css" as="style"><link rel="preload" href="/assets/js/app.7bcd2792.js" as="script"><link rel="preload" href="/assets/js/3.9c7a5d8e.js" as="script"><link rel="preload" href="/assets/js/1.db4280a4.js" as="script"><link rel="preload" href="/assets/js/12.0c24c9c3.js" as="script"><link rel="prefetch" href="/assets/js/10.3fec0422.js"><link rel="prefetch" href="/assets/js/11.431261b4.js"><link rel="prefetch" href="/assets/js/13.5d04625c.js"><link rel="prefetch" href="/assets/js/4.8836a7d4.js"><link rel="prefetch" href="/assets/js/5.cc95466a.js"><link rel="prefetch" href="/assets/js/6.72f5cb6b.js"><link rel="prefetch" href="/assets/js/7.6b9f3aba.js"><link rel="prefetch" href="/assets/js/8.f8751260.js"><link rel="prefetch" href="/assets/js/9.9a50b320.js">
    <link rel="stylesheet" href="/assets/css/0.styles.059983fa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-1156296a><div data-v-1156296a><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1156296a data-v-1156296a><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4e82dffc data-v-1156296a data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>薛定谔see猫</h3> <p class="description" data-v-4e82dffc data-v-4e82dffc></p> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>薛定谔see猫</span>
            
          <!---->
          2021
        </a></span></div></div> <div class="hide" data-v-1156296a><header class="navbar" data-v-1156296a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/logo.jpg" alt="薛定谔see猫" class="logo"> <span class="site-name">薛定谔see猫</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1156296a></div> <aside class="sidebar" data-v-1156296a><div class="personal-info-wrapper" data-v-828910c6 data-v-1156296a><img src="/assets/img/logo.jpg" alt="author-avatar" class="personal-img" data-v-828910c6> <h3 class="name" data-v-828910c6>
    薛定谔see猫
  </h3> <div class="num" data-v-828910c6><div data-v-828910c6><h3 data-v-828910c6>2</h3> <h6 data-v-828910c6>Articles</h6></div> <div data-v-828910c6><h3 data-v-828910c6>2</h3> <h6 data-v-828910c6>Tags</h6></div></div> <ul class="social-links" data-v-828910c6><li class="social-item" data-v-828910c6><i class="iconfont reco-github" style="color:#fb9b5f;" data-v-828910c6></i></li><li class="social-item" data-v-828910c6><i class="iconfont reco-bilibili" style="color:#849b87;" data-v-828910c6></i></li></ul> <hr data-v-828910c6></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4e82dffc data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>计算机网络</h3> <!----> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>薛定谔see猫</span>
            
          <!---->
          2021
        </a></span></div></div> <div data-v-1156296a><main class="page"><section><div class="page-title"><h1 class="title">计算机网络</h1> <div data-v-1ff7123e><i class="iconfont reco-account" data-v-1ff7123e><span data-v-1ff7123e>薛定谔see猫</span></i> <i class="iconfont reco-date" data-v-1ff7123e><span data-v-1ff7123e>4/3/2021</span></i> <!----> <i class="tags iconfont reco-tag" data-v-1ff7123e><span class="tag-item" data-v-1ff7123e>网络</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="_1-基本概念"><a href="#_1-基本概念" class="header-anchor">#</a> 1. 基本概念</h2> <h3 id="_1-1-网络互联模型"><a href="#_1-1-网络互联模型" class="header-anchor">#</a> 1.1 网络互联模型</h3> <p><code>OSI</code>参考模型</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><p><code>TCP/IP</code>协议</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><p>学习研究</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><h3 id="_1-2-通信基础"><a href="#_1-2-通信基础" class="header-anchor">#</a> 1.2 通信基础</h3> <h4 id="_1-2-1-通信过程"><a href="#_1-2-1-通信过程" class="header-anchor">#</a> 1.2.1 通信过程</h4> <ol><li>获取对方的<code>IP</code>地址和对应的<code>MAC</code>地址</li> <li>如果此时发送方不知道目的地址的<code>MAC</code>，会使用<code>ARP</code>协议在同一个网段进行广播，获取目的地址的<code>MAC</code>地址</li> <li>根据<code>MAC</code>地址(网卡地址)，输送数据到网卡，被网卡接受</li> <li>如果对方发现<code>MAC</code>地址不是自己的则会丢弃</li></ol> <h4 id="_1-2-2-计算机的连接方式"><a href="#_1-2-2-计算机的连接方式" class="header-anchor">#</a> 1.2.2 计算机的连接方式</h4> <ol><li><p>同轴电缆</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403130219.png" alt="image-20210210124220690">这种方式为<strong>半双工通信</strong>同一时间只允许一个用户进行发送，容易冲突</p> <p>因为数据会从发送方发给每一个用户，所以不安全</p></li> <li><p>集线器</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403130438.png" alt="image-20210210131607414"></p> <p>半双工通信，容易冲突</p> <p>一个集线器能够连接的设备是有上限的，可以采用集线器连接集线器的方式进行连接</p> <p>数据也会从发送方发给每一个用户，所以也不安全</p></li> <li><p>网桥</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403130507.png" alt="image-20210210133537667"></p> <p>通过自学习得知每个接口的<code>MAC</code>地址，从而起到隔绝冲突域的作用</p> <p>如上图在每一次的<code>ARP</code>数据传送中，网桥就可以记录下<code>ip</code>对应的<code>MAC</code>地址，在数据经过网桥时可以比对<code>MAC</code>地址，从而实现隔绝的效果</p></li> <li><p>交换机</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403130555.png" alt="image-20210210140623590"></p> <p>相当于接口更多的网桥，能够实现<strong>全双工通信</strong></p> <p>第一次发送数据时<code>ARP</code>依旧会采用广播的方式，但是此时的交换机会记录下每个接口对应的<code>MAC</code>地址</p></li> <li><p>路由器</p> <p>以上的四种方式，所有的设备必须处在同一个网段，即处在同一个广播域</p> <p>路由器则可以在不同网段之间转发数据，路由器连接的设备一定要处于<strong>不同</strong>的网段</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403130617.png" alt="image-20210210195940917"></p> <p><strong>发送数据的步骤</strong></p> <p>在主机发送数据之前，首先会判断目标主机的<code>IP</code>地址跟它是否在同一个网段</p> <p>判断是否在同一个网段的方法是拿自己的子网掩码和对方的<code>IP</code>地址进行<code>&amp;</code>运算</p> <p>在同一个网段发送<code>ARP</code>广播，通过交换机\集线器传递数据，不在同一个网段通过路由器转发数据</p> <p>通过路由器转发数据就需要网关（Gateway），网关一般设置为每一个网段的第一个<code>ip</code>地址，不在同一个网段互相传数据，会将数据传送给自己的网关（一个路由器起内包含连接在路由器上的所有网关），经由对方的网关传送给对方</p></li></ol> <h2 id="_2-mac和ip"><a href="#_2-mac和ip" class="header-anchor">#</a> 2. MAC和IP</h2> <h3 id="_2-1-mac地址"><a href="#_2-1-mac地址" class="header-anchor">#</a> 2.1 MAC地址</h3> <p>每一个网卡都有一个6字节的<code>MAC</code>地址（Media Access Control Address）</p> <p><code>MAC</code>地址全球唯一，固化在了网卡的<code>ROW</code>中，由<code>IEEE802</code>标准规定</p> <p>前三个字节<code>OUI</code>（Organizationally Unique Identifier）是网卡厂家，后三个字节由厂商自行分配</p> <table><thead><tr><th>组织唯一标识</th> <th>网络接口标识</th></tr></thead> <tbody><tr><td>40-55-82</td> <td>0A-8C-6D</td></tr></tbody></table> <p>当<code>MAC</code>地址为<code>FF-FF-FF-FF-FF-FF</code>时代表广播地址</p> <p><strong>arp</strong></p> <p>当发送方不知道对方主机的<code>MAC</code>地址时，可以通过发送<code>ARP</code>广播获取对方的<code>MAC</code>地址，获取成功后，发送方会缓存<code>IP</code>地址、<code>MAC</code>地址的映射信息，俗称<code>ARP</code>缓存</p> <p>通过<code>arp</code>广播获取的<code>MAC</code>地址，属于动态<code>dynamic</code>缓存，存储时间比较短（默认是2分钟），过期了自动删除</p> <p>查看缓存</p> <div class="language-shell extra-class"><pre class="language-shell"><code>arp -a
</code></pre></div><h3 id="_2-2-ip地址"><a href="#_2-2-ip地址" class="header-anchor">#</a> 2.2 IP地址</h3> <h4 id="_2-2-1-简介"><a href="#_2-2-1-简介" class="header-anchor">#</a> 2.2.1 简介</h4> <p><code>IP</code>地址（Internet Protocol Address）：互联网上的每一个主机都有一个<code>IP</code>地址，最初为<code>IPV4</code>版本，<code>32bit</code>（4字节），2019年11月25日，全球的<code>Ip</code>地址已经耗尽，目前正在推广<code>IPv6</code></p> <table><thead><tr><th>第一部分</th> <th>第二部分</th> <th>第三部分</th> <th>第四部分</th></tr></thead> <tbody><tr><td>1100 0000</td> <td>1010 1000</td> <td>0000 0001</td> <td>0000 1010</td></tr> <tr><td>192</td> <td>168</td> <td>1</td> <td>10</td></tr></tbody></table> <p><strong>功能</strong></p> <p>假设</p> <div class="language- extra-class"><pre class="language-text"><code>IP地址：192.168.1.10
子网掩码：255.255.255.0
</code></pre></div><table><thead><tr><th>网络ID</th> <th>主机ID</th></tr></thead> <tbody><tr><td>1100 0000 1010 1000 0000 0001</td> <td>0000 1010</td></tr> <tr><td>192.168.1</td> <td>10</td></tr></tbody></table> <p><code>IP</code>地址由2部分组成：网络标识（网络ID）、主机标识（主机ID），同一个网段的计算机，网络ID相同</p> <p>通过子网掩码（<code>subnet mask</code>）可以计算出网络ID：<strong>子网掩码&amp;IP地址</strong></p> <p>如果主机ID位为全<code>0</code>代表网段地址，如上的网段地址为</p> <div class="language- extra-class"><pre class="language-text"><code>192.168.1.0
</code></pre></div><p>如果主机ID位为全<code>1</code>代表给这个网段的所有主机发送消息，即广播地址，如上的广播地址为</p> <div class="language- extra-class"><pre class="language-text"><code>192.168.1.255
</code></pre></div><h4 id="_2-2-2-ip地址的分类"><a href="#_2-2-2-ip地址的分类" class="header-anchor">#</a> 2.2.2 IP地址的分类</h4> <ul><li><p><code>A</code>类地址：默认子网掩码是<code>255.0.0.0</code></p> <table><thead><tr><th>8bit</th> <th>24bit</th></tr></thead> <tbody><tr><td>网络ID 0开头</td> <td>主机ID</td></tr></tbody></table> <p>网络ID的取值范围为<code>0~127</code>，<code>0</code>不能用，<code>127</code>作为保留网段，其中<code>127.0.0.1</code>是本地环回地址<code>Loopback</code>，代表本机地址，所以<code>A</code>类地址网络ID的实际取值范围为<code>1~126</code></p> <p>每个<code>A</code>类网络能容纳的最大主机数是：<code>256 * 256 * 256 - 2 = 1677 7214</code></p></li> <li><p><code>B</code>类地址：默认子网掩码是<code>255.255.0.0</code></p> <table><thead><tr><th>16bit</th> <th>16bit</th></tr></thead> <tbody><tr><td>网络ID 10开头</td> <td>主机标识</td></tr></tbody></table> <p>第一个字节的取值范围为<code>128~191</code>，每个<code>B</code>类网络能够容纳的最大主机数是：<code>256 * 256 - 2 = 6 5534</code></p></li> <li><p><code>C</code>类地址：默认子网掩码是<code>255.255.255.0</code></p> <table><thead><tr><th>24bit</th> <th>8bit</th></tr></thead> <tbody><tr><td>网络ID 110开头</td> <td>主机ID</td></tr></tbody></table> <p>第一个字节的取值为<code>192~223</code>，每个<code>C</code>类网络能够容纳的最大主机数是：<code>256 - 2 = 254</code></p></li> <li><p><code>D</code>类地址：以<code>1110</code>开头，没有子网掩码，用于多播地址</p> <p>第一个字节的取值范围：<code>224~239</code></p></li> <li><p><code>E</code>类地址：以<code>1111</code>开头，保留为今后使用</p> <p>第一个字节的取值范围：<code>240~255</code></p></li></ul> <p>只有<code>A</code>、<code>B</code>、<code>C</code>类地址才能分配给主机</p> <h4 id="_2-2-3-公网ip、私网ip"><a href="#_2-2-3-公网ip、私网ip" class="header-anchor">#</a> 2.2.3 公网IP、私网IP</h4> <p><code>IP</code>地址分为：公网<code>IP</code>和私网<code>IP</code></p> <p><strong>公网IP</strong></p> <p><code>Internet</code>上的路由器中只有到达公网的路由表，没有到达私网的路由表</p> <p>公网<code>IP</code>由因特网信息中心<code>Internet Network Information Center, Inter NIC</code>统一分配和管理</p> <p><code>ISP</code>需要想<code>Inter NIC</code>申请公网<code>IP</code></p> <p><strong>私网IP</strong></p> <p>主要用于局域网。下面是保留的私网网段</p> <table><thead><tr><th>类型</th> <th>范围</th> <th>网段数量</th></tr></thead> <tbody><tr><td>A类</td> <td>10.0.0.0/8</td> <td>1</td></tr> <tr><td>B类</td> <td>172.16.0.0/16~172.31.0.0/16</td> <td>16</td></tr> <tr><td>C类</td> <td>192.168.0.0/24~192.168.255.0/24</td> <td>256</td></tr></tbody></table> <h3 id="_2-3-子网掩码"><a href="#_2-3-子网掩码" class="header-anchor">#</a> 2.3 子网掩码</h3> <h4 id="_2-3-1-子网掩码的表示方法"><a href="#_2-3-1-子网掩码的表示方法" class="header-anchor">#</a> 2.3.1 子网掩码的表示方法</h4> <p><code>CIDR</code>（Classless Inter-Domain Routing）：无类别域间路由表示法</p> <p><code>192.168.1.100/24</code>，代表子网掩码有24个1，也就是<code>255.255.255.0</code></p> <p><code>123.210.100.200/16</code>，代表子网掩码有16个1，也就是<code>255.255.0.0</code></p> <h4 id="_2-3-2-子网划分"><a href="#_2-3-2-子网划分" class="header-anchor">#</a> 2.3.2 子网划分</h4> <p><strong>为什么要进行子网划分？</strong></p> <p>如果让<strong>200</strong>台主机在同一个网段内，就可以分配一个<code>C</code>类网段，比如<code>192.168.1.0/24</code>，总共<code>254</code>个可用的<code>IP</code>地址：<code>192.168.1.1</code>~<code>192.168.1.254</code>，多出<code>54</code>个空闲<code>ip</code>地址，这种情况并不算浪费资源。</p> <p>如果让<strong>500</strong>台主机在同一个网段内，那就分配一个<code>B</code>类网段，比如<code>191.100.0.0/16</code>，总共<code>65534</code>个可用<code>IP</code>地址：<code>191.100.0.1</code>~<code>191.100.255.254</code>，多出<code>65034</code>个空闲的<code>IP</code>地址，这种情况属于极大的浪费资源。</p> <p>为了解决资源浪费的问题，提出了子网划分的概念。</p> <p><strong>子网划分</strong></p> <p>假设对一个<code>C</code>类网段进行子网划分</p> <div class="language- extra-class"><pre class="language-text"><code>192.168.0.0/24
</code></pre></div><p>借用主机位作子网位，划分出多个子网</p> <p>划分方式:</p> <ol><li><p>等长子网划分：将一个网段等分为多个子网，每个子网的可用<code>IP</code>地址数量是一样的</p> <table><thead><tr><th>A子网</th> <th>1100 0000</th> <th>1010 1000</th> <th>0000 0000</th> <th>0</th> <th>000 0000</th></tr></thead> <tbody><tr><td>B子网</td> <td>1100 0000</td> <td>1010 1000</td> <td>0000 0000</td> <td>1</td> <td>000 0000</td></tr> <tr><td>子网掩码</td> <td>255</td> <td>255</td> <td>255</td> <td>128</td> <td></td></tr></tbody></table> <p>将主机的一位拿出来当做子网掩码的一部分，就会变成两个不同的网段</p> <div class="language- extra-class"><pre class="language-text"><code>A子网：192.168.0.0/25
B子网：192.168.0.128/25
两个网段的子网掩码都是：255.255.255.128
</code></pre></div><p>对于A子网的取值范围应该是：<code>192.168.0.1</code>~<code>192.168.0.126</code></p> <p>对于B子网的取值范围应该是：<code>192.168.0.129</code>~<code>192.168.0.254</code></p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403130639.png" alt="image-20210211113554545"></p></li> <li><p>变长子网划分：每个子网的可用<code>IP</code>地址数量可以是不一样的</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403130655.png" alt="image-20210211115326654"></p> <p>如果一个子网地址块的长度是原网段的<code>(1/2)^n</code>，那么子网的子网掩码，就是在原网段的子网掩码的基础上增加n个1，不等长的子网他们的子网掩码也不同。</p> <p><strong>各个网段的划分情况</strong></p> <table><thead><tr><th>网段</th> <th>子网掩码</th> <th>网络取值范围</th></tr></thead> <tbody><tr><td>A</td> <td>255.255.255.224/27</td> <td>192.168.0.33~192.168.0.62</td></tr> <tr><td>B</td> <td>255.255.255.192/26</td> <td>192.168.0.65~192.168.0.126</td></tr> <tr><td>C</td> <td>255.255.255.128/25</td> <td>192.168.0.129~192.168.0.254</td></tr> <tr><td>D</td> <td>255.255.255.252/30</td> <td>192.168.0.1~192.168.0.2</td></tr> <tr><td>E</td> <td>255.255.255.252/30</td> <td>192.168.0.5~192.168.0.6</td></tr></tbody></table></li></ol> <h4 id="_2-3-3-超网"><a href="#_2-3-3-超网" class="header-anchor">#</a> 2.3.3 超网</h4> <p>跟子网反过来，它是将多个<strong>连续</strong>的网段合并成一个更大的网段</p> <p>需求：原本有<strong>200</strong>台计算机使用<code>192.168.0.0/24</code>网段，现在希望增加<strong>200</strong>台设备到同一个网段</p> <p>解决方法：200台在<code>192.168.0.0/24</code>网段，200台在<code>192.168.1.0/24</code>网段，并将两个网段合并为同一个网段：<code>192.168.0.0/23</code></p> <table><thead><tr><th>192.168.0.0</th> <th>1100 0000</th> <th>1010 1000</th> <th>0000 0000</th> <th>0000 0000</th></tr></thead> <tbody><tr><td>192.168.1.0</td> <td>1100 0000</td> <td>1010 1000</td> <td>0000 0001</td> <td>0000 0000</td></tr> <tr><td>子网掩码</td> <td>1111 1111</td> <td>1111 1111</td> <td>1111 1110</td> <td>0000 0000</td></tr> <tr><td>子网掩码</td> <td>255</td> <td>255</td> <td>254</td> <td>0</td></tr></tbody></table> <p>它们的网段为<code>192.168.0.0/23</code>广播地址为<code>192.168.1.255</code></p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403130709.png" alt="image-20210211134232655"></p> <p><strong>合并规律</strong></p> <p>假设n是2的K（k&gt;=1）次幂，如果第一个网段的网络号能被n整除，那么由它开始连续的n个网段，能够通过左移k为子网掩码进行合并</p> <p>比如：</p> <ul><li>第一个网段的网络号以二进制0结尾，那么由它开始连续的2个网段，能够通过左移1位子网掩码进行合并</li> <li>第一个网段的网络号以二进制00结尾，那么由它开始连续的4个网段，能够通过左移2位子网掩码进行合并</li> <li>第一个网段的网络号以二进制000结尾，那么由它开始连续的8个网段，能够通过左移2位子网掩码进行合并</li></ul> <h3 id="_2-4-ipv6"><a href="#_2-4-ipv6" class="header-anchor">#</a> 2.4 IPv6</h3> <p><code>IPv6(Internet Protocol version 6)</code>，网际协议第六版，用它来取代<code>IPv4</code>主要是为了解决<code>IPv4</code>地址枯竭的问题，同时它也在其他方面对于<code>IPv4</code>有许多改进</p> <p>然而长期以来在互联网流量中仍然占主要地位，<code>IPv6</code>的使用增长缓慢</p> <p><code>IPv6</code>采用128位的地址，每16bit一组，共8组</p> <p>每组以冒号&quot;:&quot;隔开，每组以4位是十六进制方式表示</p> <div class="language- extra-class"><pre class="language-text"><code>2001:0db8:3c4d:0015:0000:0000:1a2f:1a2b
</code></pre></div><p><code>::1</code>本地环回地址</p> <h2 id="_3-路由"><a href="#_3-路由" class="header-anchor">#</a> 3. 路由</h2> <h3 id="_3-1-路由寻址"><a href="#_3-1-路由寻址" class="header-anchor">#</a> 3.1 路由寻址</h3> <p>在不同网段之间转发数据，需要有路由器的支持。默认情况下，路由器只知道跟它直连的网段，非直连的网段都需要通过静态路由、动态路由告诉它</p> <p>静态路由：管理员手动添加路由信息，适用于小规模网络</p> <p>动态路由：路由器通过路由选择协议（比如<code>RIP</code>、<code>OSPF</code>）自动获取路由信息，使用于大规模网络</p> <p><strong>以下为静态路由</strong></p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403130733.png" alt="image-20210211152330909"></p> <p>每一个路由器内都有一张路由表，记录不同路由器之间不同网段的通信路径</p> <p>假设<code>192.168.1.10/24</code>和<code>193.169.2.10/24</code>要通信，两个路由器需要使用同一个网段的<code>IP</code>进行通信</p> <p><strong>路由器0</strong></p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403130750.png" alt="image-20210211152559644"></p> <p><strong>路由器1</strong></p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403130813.png" alt="image-20210211152743450"></p> <p>设置更高层次的模糊匹配</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403130828.png" alt="image-20210211155412587"></p> <p>也可以设置默认匹配</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403130926.png" alt="image-20210211155847143"></p> <h3 id="_3-2-数据包的传输过程"><a href="#_3-2-数据包的传输过程" class="header-anchor">#</a> 3.2 数据包的传输过程</h3> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131005.png" alt="image-20210211172036400"></p> <p>主机<code>192.168.1.10/24</code>要发送消息给<code>192.168.3.10/24</code>，第一步，并不是获取对方的<code>MAC</code>地址，而是获取网关的<code>MAC</code>地址，在传送过程中，<code>IP</code>地址不会改变，而<code>MAC</code>地址会不断变更</p> <h3 id="_3-3-网络、互联网、因特网"><a href="#_3-3-网络、互联网、因特网" class="header-anchor">#</a> 3.3 网络、互联网、因特网</h3> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131018.png" alt="image-20210211172349063"></p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131027.png" alt="image-20210211172415233"></p> <p>世界上最大的互联网就是<strong>因特网</strong><code>Internet</code>，将全世界的互联网连接一起</p> <p><code>ISP</code>（Internet Service Provider）<code>Internet</code>服务提供商，比如移动、电信、网通、铁通等</p> <h3 id="_3-4-网络分类"><a href="#_3-4-网络分类" class="header-anchor">#</a> 3.4 网络分类</h3> <p>按照网络的范围进行分类，可以分为：局域网、城域网、广域网等</p> <p><strong>局域网</strong></p> <ol><li><p><code>Local Area Network</code>，LAN，一般为几百米到十几公里内的计算机所构成的计算机网络，常用于公司、家庭、学校、医院、机关、一栋大楼等</p></li> <li><p>局域网中使用最广泛的网络技术叫：以太网<code>Ethernet</code></p></li> <li><p>在电脑、手机上经常见到的一个英文<code>WLAN</code>（Wireless LAN），意思是无线局域网</p></li></ol> <p><strong>城域网</strong></p> <p><code>Metropolitan Area Network</code>，MAN，一般范围是数十公里到数百公里，可以覆盖一个城市</p> <p><strong>广域网</strong></p> <p><code>Wide Area Network</code>，WAN，一般范围是几百公里到几千公里，可以覆盖一个国家。通常都需要租用<code>ISP</code>的线路</p> <h3 id="_3-5-常见的几种接口"><a href="#_3-5-常见的几种接口" class="header-anchor">#</a> 3.5 常见的几种接口</h3> <ol><li><p><code>FastEthernet</code></p> <p>快速以太网接口（100M），一般用于局域网连接，比如电脑网线连接交换机</p></li> <li><p><code>GigabitEthernet</code></p> <p>千兆以太网接口（1000M）</p></li> <li><p><code>Serial</code></p> <p>串行接口，路由器和路由器之间使用串口连接，路由器和交换机之间连接使用快速以太网口</p></li></ol> <h3 id="_3-6-上网方式"><a href="#_3-6-上网方式" class="header-anchor">#</a> 3.6 上网方式</h3> <h4 id="_3-6-1-电话线入户"><a href="#_3-6-1-电话线入户" class="header-anchor">#</a> 3.6.1 电话线入户</h4> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131039.png" alt="image-20210211175235178"></p> <p><code>ADSL</code>电话拨号上网（<code>Asymmetric Digital Subscriber Line</code>），非对称数字用户线路，提供上、下不对称的传输带宽。</p> <p>猫<code>Modem</code>，调制解调器，进行数字信号和模拟信号的转换</p> <h4 id="_3-6-2-光纤入户"><a href="#_3-6-2-光纤入户" class="header-anchor">#</a> 3.6.2 光纤入户</h4> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131054.png" alt="image-20210211175616729"></p> <p>光猫<code>Optical Modem</code>，光调制解调器，进行数字信号和光信号的转换</p> <h4 id="_3-6-3-网线入户"><a href="#_3-6-3-网线入户" class="header-anchor">#</a> 3.6.3 网线入户</h4> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131107.png" alt="image-20210211180401473"></p> <h3 id="_3-7-nat"><a href="#_3-7-nat" class="header-anchor">#</a> 3.7 NAT</h3> <p>NAT：<code>Network Address Translation</code></p> <p>私网IP访问<code>Internet</code>需要进行<code>NAT</code>转换为公网<code>IP</code>，这一步由路由器完成</p> <p><code>NAT</code>的特点</p> <ul><li>可以节约公网<code>IP</code>资源</li> <li>会隐藏内部真时<code>IP</code></li></ul> <p><code>NAT</code>的分类</p> <ul><li><p>静态转换，手动配置<code>NAT</code>映射表，一对一转换，不能节约<code>IP</code>资源</p></li> <li><p>动态转换，定义外部地址池，动态随机转换，也是一对一转换</p></li> <li><p><code>PAT</code>(Port Address Translation)</p> <p>多对一转换，最大程度节约公网<code>IP</code>资源</p> <p>采用端口多路复用方式，通过端口号标识不同的数据流</p> <p>目前应用最广泛的<code>NAT</code>实现方式</p></li></ul> <h2 id="_4-网络分层"><a href="#_4-网络分层" class="header-anchor">#</a> 4. 网络分层</h2> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131117.png" alt="image-20210212090741050"></p> <p>OSI模型：国际标准模型</p> <p><code>TCP/IP</code>协议模型：实际应用的模型</p> <p><strong>数据的传送过程</strong></p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131126.png" alt="image-20210212091045582"></p> <p>数据在经过发送方的每一层都会进行一次封装，在接受方则会每一层都进行一次解封装</p> <p><strong>不同层的功能</strong></p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131135.png" alt="image-20210212091500465"></p> <h3 id="_4-1-物理层"><a href="#_4-1-物理层" class="header-anchor">#</a> 4.1 物理层</h3> <p>物理层定义了接口标准、线缆标准、传输速率、传输方式等。</p> <p><strong>数字信号、模拟信号</strong></p> <p>模拟信号<code>Analog Signal</code>：连续的信号，适合长距离传输。抗干扰能力差，收到干扰时波形变形很难纠正</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131145.png" alt="image-20210212092040983"></p> <p>数字信号<code>Digital Signal</code>：离散的信号，不适合长距离传输，抗干扰能力强，收到干扰时波形可以修复</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131154.png" alt="image-20210212092117282"></p> <p><strong>数据通信模型</strong></p> <ol><li><p>局域网通信模型</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131204.png" alt="image-20210212092357074"></p> <p>网线不能超过<strong>100</strong>米，因为信号会衰减</p></li> <li><p>广域网通信模型</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131213.png" alt="image-20210212092739804"></p></li></ol> <p><strong>信道Channel</strong></p> <p>信息传输的通道，一条传输介质上（比如网线）上可以有多条信道</p> <p>单工通信：信号只能往一个方向传输，任何时候都不能改变信号的传输方向。比如，无线电广播，有线电视话广播等</p> <p>半双工通信：信号可以双向传输，但必须是交替执行，同一时间只能往一个方向传输。比如，对讲机等</p> <p>全双工通信：信号可以同时双向传输。比如，手机等</p> <h3 id="_4-2-数据链路层"><a href="#_4-2-数据链路层" class="header-anchor">#</a> 4.2 数据链路层</h3> <p>数据链路层<code>Data Link</code></p> <p><strong>链路</strong>：从1个节点到相邻节点的一段物理线路（有线或无线），中间没有其他交换节点</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131222.png" alt="image-20210212093820980"></p> <p><strong>数据链路</strong>：在一条链路上传输数据时，需要有对应的通信协议来控制数据的传输，不同类型的数据链路，所用的通信协议可能是不同的</p> <ol><li>广播信道：<code>CSMA/CD</code>协议（比如同轴电缆、集线器等组成的网络）</li> <li>点对点信道：<code>PPP</code>协议（比如两个路由器之间的信道）</li></ol> <h4 id="_4-2-1-数据链路层的问题"><a href="#_4-2-1-数据链路层的问题" class="header-anchor">#</a> 4.2.1 数据链路层的问题</h4> <ol><li><p>封装成帧</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131236.png" alt="image-20210213084253529"></p> <p>帧<code>Frame</code>的数据部分：就是网络层传递下来的数据包（<code>IP</code>数据包，<code>Packet</code>）</p> <p><code>MTU</code>最大传输单元<code>Maximum Transfer Unit</code>：每一种数据链路层协议都规定了所能够传送的帧的数据长度上限，比如以太网的<code>MTU</code>为<code>1500</code>个字节</p></li> <li><p>透明传输</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131249.png" alt="image-20210213084944437"></p> <p>如果数据部分出现<code>SOH</code>、<code>EOT</code>，就需要进行转义</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131303.png" alt="image-20210213093611836"></p></li> <li><p>差错检验</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131313.png" alt="image-20210213094125389"></p> <p><code>FCS</code>是根据数据部分+首部计算得出，用于校验数据的完整性</p></li></ol> <h4 id="_4-2-2-csma-cd协议"><a href="#_4-2-2-csma-cd协议" class="header-anchor">#</a> 4.2.2 CSMA/CD协议</h4> <p><code>CSMA/CD</code>（<code>Carrier Sense Multiple Acess with Collision Detectio</code>）</p> <p>功能：载波侦听、多路访问、冲突检测，一般用于集线器所连接的网络使用</p> <p>使用了<code>CSMA/CD</code>的网络可以称为是以太网<code>Ethernet</code>，它传输的是以太网帧：以太网帧的格式有：<code>Ethernet V2</code>标准（使用最多）、<code>IEEE</code>的<code>802.3</code>标准</p> <p>为了能够检测正在发送的帧是否产生了冲突，以太网的帧至少要<code>64</code>字节</p> <p>用交换机组建的网络，已经支持全双工通信，不需要在使用<code>CSMA/CD</code>，但它传输的帧依旧是以太网帧，即使用交换机组建的网络，依然可以叫做以太网</p> <h4 id="_4-2-3-ethernet-v2"><a href="#_4-2-3-ethernet-v2" class="header-anchor">#</a> 4.2.3 Ethernet v2</h4> <p>是数据帧的一种标准传输格式</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131323.png" alt="image-20210213100701455"></p> <p><code>Ethernet v2</code>使用曼斯特编码，不需要帧开始符和帧结束符</p> <p>首部：目标<code>MAC</code>+源<code>MAC</code>+网络类型（IPv4&amp;IPv6）</p> <p>一个完整的以太网帧包括：首部+数据+<code>FCS</code></p> <p>数据长度至少是：64-6-6-2-4=46字节，最多1500个字节。如果小于46字节，数据链路层不在数据的后面加入一些字节填充</p> <h4 id="_4-2-4-ppp协议"><a href="#_4-2-4-ppp协议" class="header-anchor">#</a> 4.2.4 PPP协议</h4> <p><code>PPP</code>协议：<code>Point to Point Protocol</code></p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131332.png" alt="image-20210213101905661"></p> <ul><li><code>Address</code>字段：图中的值是<code>0xFF</code>，形同虚设，点到点信道不需要源<code>MAC</code>、目标<code>MAC</code>地址</li> <li><code>Control</code>字段：图中的值是<code>0x03</code>，目前没什么用</li> <li><code>Protocol</code>字段：内部用到的协议类型</li> <li>帧开始符、帧结束符：<code>0x7E</code></li></ul> <p><strong>数据转义</strong></p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131341.png" alt="image-20210213102708037"></p> <p>将<code>0x7E</code>替换为<code>0x7D5E</code>，将<code>0x7D</code>替换为<code>0x7D5D</code></p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131350.png" alt="image-20210213103002215"></p> <p>网卡接受到一个帧，首先进行差错校验，如果校验通过则接收，否则丢弃</p> <p><code>Wireshark</code>抓到的帧没有<code>FCS</code>，因为它抓到的是差错校验通过的帧（<code>FCS</code>会被硬件去掉）</p> <h3 id="_4-3-网络层"><a href="#_4-3-网络层" class="header-anchor">#</a> 4.3 网络层</h3> <p>网络层数据包（<code>IP</code>数据包，<code>Packet</code>）由首部、数据2部分组成，数据一般由传输层传递下来的数据段<code>Segment</code></p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131400.png" alt="image-20210213105458044"></p> <p><code>wireshark</code>抓<code>ping www.qq.com</code>网络层数据</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131513.png" alt="image-20210213192323068"></p> <p>各部分取值</p> <ol><li><p>版本</p> <p>占4位，<code>OB0100</code>：<code>IPv4</code>，<code>OB0110</code>：<code>IPv6</code></p></li> <li><p>首部长度</p> <p>占4位，二进制值乘4才是最终长度</p> <p><code>0B0101</code>：20最小值</p> <p><code>0B1111</code>：60最大值</p></li> <li><p>区分服务</p> <p>8位，可以提高网络的服务质量</p></li> <li><p>总长度</p> <p>网络层的总长度16位，<code>0&lt;=数据包&lt;=65535</code>，由于数据链路层的每个数据帧（以太网数据帧）的最大长度为1500字节，所以比较大的<code>IP</code>数据包，需要分成片<code>fragments</code>传输给数据链路层，每一片都有自己的网络层首部（<code>IP</code>首部）</p></li> <li><p>标识<code>Identification</code></p> <p>占16位，表示为数据包的<code>ID</code>，当数据包过大进行分片时，同一个数据包的所有片的标识都是一样的</p> <p>有一个计数器专门管理数据包的<code>ID</code>，每发出一个数据包，<code>ID</code>就加1</p></li> <li><p>标志<code>flags</code></p> <p>占三位</p> <p>第一位<code>Reserved Bit</code>：保留</p> <p>第二位<code>Don't Fragment</code>：1代表不允许分片，0代表允许分片</p> <p>第三位<code>More Fragments</code>：1代表不是最后一片，0代表是最后一片</p></li> <li><p>片偏移<code>Fragment Offset</code></p> <p>占13位，片偏移乘以8：字节偏移</p> <p>每一片的长度一定是8的整数倍</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131524.png" alt="image-20210213172715591"></p></li> <li><p>生存时间</p> <p>生存时间<code>Time To Live, TTL</code>，占8位</p> <p>每个路由器在转发之前会将<code>TTL</code>减1，一旦发现<code>TTL</code>减为0，路由器就会返回错误报告</p> <table><thead><tr><th>操作系统</th> <th>版本</th> <th>默认TTL</th></tr></thead> <tbody><tr><td>Windows</td> <td>Server 2003，XP，7，10</td> <td>128</td></tr> <tr><td>Linux</td> <td>2.0.x Kernel，Red Hat 9</td> <td>64</td></tr> <tr><td>Linux</td> <td>2.2.14 Kernel，2.4 Kernel</td> <td>255</td></tr> <tr><td>Mac OS</td> <td></td> <td>60</td></tr> <tr><td>Mac OS X</td> <td></td> <td>64</td></tr></tbody></table></li> <li><p>协议</p> <p>占8位，表明所封装的数据是使用了什么协议</p> <table><thead><tr><th>协议</th> <th>ICMP</th> <th>IGMP</th> <th>IP</th> <th>TCP</th> <th>EGP</th> <th>IGP</th> <th>UDP</th> <th>IPv6</th> <th>ESP</th> <th>OSPF</th></tr></thead> <tbody><tr><td>十进制</td> <td>1</td> <td>2</td> <td>4</td> <td>6</td> <td>8</td> <td>9</td> <td>17</td> <td>41</td> <td>50</td> <td>89</td></tr></tbody></table></li> <li><p>首部检验和</p> <p>占16位，用于检测首部是否正确。</p></li> <li><p>源IP</p></li> <li><p>目标Ip</p></li></ol> <h3 id="_4-4-传输层"><a href="#_4-4-传输层" class="header-anchor">#</a> 4.4 传输层</h3> <p>传输层有两个协议</p> <ul><li><code>TCP(Transmission Control Protocol)</code>：传输控制协议</li> <li><code>UDP(User Datagram Protocol)</code>：用户数据报协议</li></ul> <table><thead><tr><th>特性</th> <th>TCP</th> <th>UDP</th></tr></thead> <tbody><tr><td>连接性</td> <td>面向连接</td> <td>无连接</td></tr> <tr><td>可靠性</td> <td>可靠传输、不丢包</td> <td>不可靠传输，尽最大努力交付，可能丢包</td></tr> <tr><td>首部占用空间</td> <td>大</td> <td>小</td></tr> <tr><td>传输速率</td> <td>慢</td> <td>快</td></tr> <tr><td>资源消耗</td> <td>大</td> <td>小</td></tr> <tr><td>应用场景</td> <td>浏览器、文件传输、邮件发送</td> <td>音视频通话、直播</td></tr> <tr><td>应用层协议</td> <td>HTTP、HTTPS、FTP、SMTP、DNS</td> <td>DNS</td></tr></tbody></table> <h4 id="_4-4-1-udp"><a href="#_4-4-1-udp" class="header-anchor">#</a> 4.4.1 UDP</h4> <p><code>UDP</code>是无连接的，减少了建立和释放连接的开销，<code>UDP</code>尽最大能力交付，不保证可靠交付。因此不需要维护一些复杂的参数，首部只有8个字节</p> <p>数据格式</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131537.png" alt="image-20210213200417043"></p> <ol><li><p><code>UDP</code>长度</p> <p>长度是指这一个<code>UDP</code>数据包的总长度，这个字段的设计是为了保证首部是32bit对齐，因为数据包的长度可以由网络层<code>IP</code>数据包的首部推测出来</p></li> <li><p><code>UDP</code>检验和</p> <p>检验和的计算内容：伪首部 + 首部 + 数据</p></li></ol> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131546.png" alt="image-20210213200749930"></p> <p>伪首部只在计算校验和时生效，并不会传送给网络层</p> <h4 id="_4-4-2-tcp数据格式"><a href="#_4-4-2-tcp数据格式" class="header-anchor">#</a> 4.4.2 TCP数据格式</h4> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131555.png" alt="image-20210214103809588"></p> <ol><li><p>序号</p> <p><code>Sequence Number</code>：占4字节，首先，在传输过程的每一个字节都会有一个编号，在建立连接后，序号代表：这一次传给对方的<code>TCP</code>数据部分的第一个字节的编号</p></li> <li><p>确认号</p> <p><code>Acknowledgment Number</code>：占4字节，在建立连接后，确认号代表：期望对方下一次传过来的<code>TCP</code>数据部分的第一个字节的编号</p></li> <li><p>数据偏移</p> <p>占4位，首部长度，需要乘以4，取值范围20~60</p></li> <li><p>保留位</p> <p>占6位，目前全为0</p></li> <li><p>标志位</p> <p>占6位，取值代表不同的意思</p> <p><code>URG</code>(Urgent)：当<code>URG=1</code>时，紧急指针字段才有效。表明当前报文字段中有紧急数据，应优先尽快传送</p> <p><code>ACK</code>(Acknowledgement)：当<code>ACK=1</code>时，确认号字段才有效</p> <p><code>PSH</code>(Push)</p> <p><code>RST</code>(Reset)：当<code>RST=1</code>时，表明连接中出现严重差错，必须释放连接，然后再重新建立连接</p> <p><code>SYN</code>(Synchromization)：当<code>SYN=1</code>、<code>ACK=0</code>时，表明这是一个建立连接的请求；若对方同意建立连接，则回复<code>SYN=1</code>、<code>ACK=1</code></p> <p><code>FIN</code>(Finsh)：当<code>FIN=1</code>时，表明数据已经发送完毕，要求释放连接</p></li> <li><p>窗口</p> <p>占2字节</p> <p>具有流量控制功能，告诉对方预留的缓冲区大小</p></li> <li><p>检验和</p> <p>跟<code>UDP</code>一样，<code>TCP</code>检验和的计算内容：伪首部+首部+数据</p> <p>伪首部占12字节，只在计算检验和时有效</p></li> <li><p>紧急指针</p> <p>数字表示<code>TCP</code>数据部分的前几位是紧急数据，需要优先传送</p></li></ol> <h4 id="_4-4-3-tcp可靠传输"><a href="#_4-4-3-tcp可靠传输" class="header-anchor">#</a> 4.4.3 TCP可靠传输</h4> <p><strong>停止等待ARQ协议</strong></p> <p><code>ARQ</code>(Automatic Repeat-request)，自动重传请求</p> <ul><li>超时重传</li></ul> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131609.png" alt="image-20210214210649285"></p> <ul><li>确认丢失</li></ul> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131626.png" alt="image-20210214211016272"></p> <p><strong>连续ARQ协议+滑动窗口协议</strong></p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131655.png" alt="image-20210215133613005"></p> <p><strong>选择性确认</strong></p> <p>在<code>TCP</code>通信过程中，如果发送序列中间某个数据包丢失（比如1、2、3、4、5中的3丢失了），如果正常情况下会重传(3、4、5)。4和5就属于重复发送，为了解决上述问题，发展出了<code>SACK</code>(Selective Acknowledgment，选择性确认)技术，可以告诉发送放哪些数据已经发送成功，哪些发送失败需要重新发送。</p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403131710.png" style="zoom:50%;"> <p><code>SACK</code>信息放在<code>TCP</code>首部的选项部分</p> <ul><li><code>Kind</code>：占1字节。值为5代表这是<code>SACK</code>选项</li> <li><code>Length</code>：占1字节。表明<code>SACK</code>选项一共占用多少字节</li> <li><code>Left Edge</code>：占4字节。左边界</li> <li><code>Right Edge</code>：占4字节。右边界</li></ul> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131902.png" alt="image-20210215150858248"></p> <p>一对边界信息需要占8字节，由于<code>TCP</code>首部的选项部分最多40字节，所以<code>SACK</code>选项最多携带4组边界信息</p> <p>对于重传的数据包如果超过一定的重传次数，仍然传输失败（未收到对方的确认报文），则会断开连接，重新建立</p> <h4 id="_4-4-4-tcp流量控制"><a href="#_4-4-4-tcp流量控制" class="header-anchor">#</a> 4.4.4 TCP流量控制</h4> <p>让发送方的发送速率不要太快，让接受方能够及时处理，主要原理是通过确认报文中窗口字段来控制发送方的发送速率，如果接受窗口的大小为0，则发送方会停止发送</p> <p><strong>特殊情况</strong></p> <p>第一次接受方发送0窗口的报文字段，但在后面接受方有了一些存储空间，给发送方发送的非0窗口的报文段丢失了，双方会陷入僵局。解决方案：当发送发接收到0窗口通知时，这时发送方停止发送报文，并且同时开启一个定时器，隔一段时间之后就发个测试报文去询问接受方最新的窗口大小，如果还是0则会再次启动定时器</p> <h4 id="_4-4-5-tcp拥塞控制"><a href="#_4-4-5-tcp拥塞控制" class="header-anchor">#</a> 4.4.5 TCP拥塞控制</h4> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403131914.png" alt="image-20210218084340217"></p> <p><strong>拥塞控制</strong></p> <p>防止过多的数据注入到网络中，避免网络中的路由器或链路过载。拥塞控制是一个全局性的过程，涉及到所有的主机、路由器以及与降低网络传输性能有关的所有因素</p> <p><strong>几个缩写</strong></p> <p><code>MSS</code>（Maximum Segment Size）：每个段最大的数据部分大小，连接时由双方协商确定</p> <p><code>cwnd</code>（congestion window）：拥塞窗口</p> <p><code>rwnd</code>（receive window）：接受窗口</p> <p><code>swnd</code>（send window）：发送窗口</p> <div class="language-java extra-class"><pre class="language-java"><code>swnd <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>cwnd<span class="token punctuation">,</span> rwnd<span class="token punctuation">)</span>
</code></pre></div><p><strong>拥塞控制的方法</strong></p> <ol><li><p>慢开始（slow start）</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403132002.png" alt="image-20210218151606670"></p> <p>发送时，刚开始慢，后面越来越快。<code>cwnd</code>的初始值比较小，然后随着数据包被接受方确认（收到一个ACK）之后成指数级增长</p></li> <li><p>拥塞避免（congestion avoidance）</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403132014.png" alt="image-20210218152151150"></p> <p><code>ssthresh</code>（slow start threshold）：慢开始阈值，<code>cwnd</code>达到阈值后，以线性方式增加。拥塞窗口缓慢增大，以防止网络过早出现拥塞</p> <p>乘法减小：只要网络出现拥塞，把<code>ssthresh</code>减半，与此同时，执行慢开始算法（<code>cwnd</code>又恢复到初始值）</p></li> <li><p>快速重传（fast retransmit）</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403132024.png" alt="image-20210218154923271"></p> <p>接受方：每收到一个失序的分组后就立即发出重复确认，使发送方及时知道有分组没有到达，而不要等待自己发送数据时才进行确认</p> <p>发送方：只要连续收到三个重复确认（总共4个相同的确认），就应当立即重传对方尚未收到的报文段，而不必继续等待重传计时器到期后再重传</p></li> <li><p>快速恢复（fast recovery）</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403132033.png" alt="image-20210218155714515"></p></li></ol> <p>当发送方连续收到三个重复确认，就执行&quot;乘法减小&quot;算法，把<code>ssthresh</code>减半，与蛮开始不同之处是现在不执行慢开始算法，即<code>cwnd</code>现在不恢复到初始值，而是把<code>cwnd</code>值设置为<code>ssthresh</code>减半后的数值，人后开始执行拥塞避免算法（&quot;线性增大&quot;），使拥塞窗口缓慢地线性增大</p> <h4 id="_4-4-6-tcp建立连接"><a href="#_4-4-6-tcp建立连接" class="header-anchor">#</a> 4.4.6 TCP建立连接</h4> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403132044.png" style="zoom:50%;"> <p><strong>客户端申请建立连接</strong></p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403132126.png" alt="image-20210218193808063"></p> <p><strong>服务器发送数据</strong></p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403132134.png" alt="image-20210218202859094"></p> <p><strong>客户端确认</strong></p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403132142.png" alt="image-20210218204210161"></p> <p><strong>三次握手</strong></p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403132208.png" style="zoom:50%;"> <p><code>CLOSED</code>：<code>client</code>处于关闭状态</p> <p><code>LISTEN</code>：<code>server</code>处于监听状态，等待<code>client</code>连接</p> <p><code>SYN-RCVD</code>：表明<code>server</code>接收到了<code>SYN</code>报文，当收到<code>client</code>的<code>ACK</code>的报文后，它会进入到<code>ESTABLISHED</code>状态</p> <p><code>SYN-SEND</code>：表明<code>client</code>已发送<code>SYN</code>报文，等待<code>server</code>的第2次握手</p> <p><code>ESTABLISHED</code>：连接已经建立</p> <p>前两次的握手中头部占32字节，固定20字节+选项12字节</p> <p><strong>三次握手的目的</strong></p> <p>3次握手的主要目的是防止<code>server</code>端一直等待，浪费资源。假设有如下情况</p> <p>一个<code>client</code>发出的第一个连接请求报文段，因为网络延迟，在第二次连接已经释放后的某个时间才到达<code>server</code>，这是一个已经失效的连接请求，但<code>server</code>收到后，误以为是<code>client</code>再次发出的一个新的连接请求，于是<code>server</code>就想<code>client</code>发出确认报文段，同意建立连接，但是因为是两次握手，只要<code>server</code>发出确认，新的连接就建立了。由于现在的<code>client</code>并没有真正想连接服务器的意愿，因此不会理睬<code>server</code>的确认报文段，但是<code>server</code>却以为新的连接已经建立，并一直等待<code>client</code>发来的数据，这样，<code>server</code>的很多资源就浪费了</p> <p>第三次握手失败情况</p> <p>此时<code>server</code>的状态为<code>SYN-RCVD</code>，若等不到<code>client</code>的<code>ACK</code>，<code>server</code>会重新发送<code>SYN</code>+<code>ACK</code>包，如果<code>server</code>多次重发<code>SYN</code>+<code>ACK</code>都等不到<code>client</code>的<code>ACK</code>，就会发送<code>RST</code>包，强制关闭连接</p> <h4 id="_4-4-7-tcp断开连接"><a href="#_4-4-7-tcp断开连接" class="header-anchor">#</a> 4.4.7 TCP断开连接</h4> <p><strong>四次挥手</strong></p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403132243.png" style="zoom:50%;"> <p><strong>状态解读</strong></p> <ol><li><p><code>FIN-WAIT-1</code>：表示想主动关闭连接</p> <p>向对方发送<code>FIN</code>报文，此时进入到<code>FIN-WAIT-1</code>状态</p></li> <li><p><code>CLOSE-WAIT</code>：表示在等待关闭</p> <p>当对方发送<code>FIN</code>给自己，自己会回应一个<code>ACK</code>报文给对方，此时则进入到<code>CLOSE-WAIT</code>状态，在此状态下，需要考虑自己是否还有数据要发送给对方，如果没有，发送<code>FIN</code>报文给对方</p></li> <li><p><code>FIN-WAIT-2</code>：只要对方发送<code>ACK</code>确认后，主动方就会处于<code>FIN-WAIT-2</code>状态，然后等待对方发送<code>FIN</code>报文</p></li> <li><p><code>CLOSING</code>：一种比较罕见的例外状态，标识双方都正在关闭连接</p> <p>表示你发送<code>FIN</code>报文后，并没有收到对方的<code>ACK</code>报文，反而却收到了对方的<code>FIN</code>报文</p> <p>如果双方几乎在同时准备关闭连接的话，那么就出现了同时发送<code>FIN</code>报文的情况，也会出现<code>CLOSING</code>状态</p></li> <li><p><code>LAST-ACK</code>：被动关闭一方在发送<code>FIN</code>报文后，最后等待对方的<code>ACK</code>报文</p> <p>当收到<code>ACK</code>报文后，即可进入<code>CLOSED</code>状态</p></li> <li><p><code>TIME-WAIT</code>：表示收到了对方的<code>FIN</code>报文，并发送出了<code>ACK</code>报文，就等<code>2MSL</code>后即可进入<code>CLOSED</code>状态了</p> <p>如果在<code>FIN-WAIT-1</code>状态下，收到了对方同时带<code>FIN</code>标志和<code>ACK</code>标志的报文时，可直接进入到<code>TIME-WAIT</code>状态，而无需经过<code>FIN-WAIT-2</code>状态</p></li> <li><p><code>CLOSED</code>：关闭状态</p> <p>由于有些状态的时间比较短暂，所以很难用<code>netstat</code>命令看到</p></li></ol> <p><strong>为什么需要四次挥手</strong></p> <ol><li><p>当主机1(client)发出<code>FIN</code>报文段时</p> <p>表示主机1告诉主机2(server)，主机1已经没有数据要发送了，但是，此时主机1还是可以接受来自主机2的数据</p></li> <li><p>当主机2返回<code>ACK</code>报文段时</p> <p>表示主机2已经知道主机1没有数据发送了，但是主机2还是可以发送数据到主机1的</p></li> <li><p>当主机2也发送了<code>FIN</code>报文段时</p> <p>表示主机2告诉主机1，主机2已经没有数据要发送了</p></li> <li><p>当主机1返回<code>ACK</code>报文段时</p> <p>表示主机1已经知道主机2没有数据发送了，随后正式断开整个<code>TCP</code>连接</p></li></ol> <p><strong>释放连接的细节</strong></p> <ol><li><p><code>TCP/IP</code>协议栈在设计上，允许任何一方先发起断开请求。</p></li> <li><p><code>client</code>发送<code>ACK</code>后，需要有个<code>TIME-WAIT</code>阶段，等待一段时间后，再真正关闭连接</p> <p>一般等待2倍的<code>MSL</code>（<code>Maximum Segment Lifetime</code>，最大分段生存期）</p> <p><code>MSL</code>是<code>TCP</code>报文在<code>Internet</code>上的最长生存时间，每个具体的<code>TCP</code>实现都必须选择一个确定的<code>MSL</code>值，<code>RFC 1122</code>建议是2分钟</p></li> <li><p>如果<code>client</code>发送<code>ACK</code>后马上释放了，然后又因为网络原因，<code>server</code>没有收到<code>client</code>的<code>ACK</code>，<code>server</code>就会重发<code>FIN</code></p> <p>可能出现的情况</p> <ul><li><code>client</code>没有任何回应，服务器一直等待，甚至多次重发<code>FIN</code>，浪费资源</li> <li><code>client</code>有个新的应用程序刚好分配了同一个端口，新的应用程序收到<code>FIN</code>后马上开始执行断开连接的操作</li></ul></li> <li><p>有的时候使用抓包工具时，可能只会看到3次挥手</p> <p>这其实是将第2、3次挥手合并了</p> <p>当<code>server</code>接受到<code>client</code>的<code>FIN</code>时，如果<code>server</code>后面也没有数据要发送给<code>client</code>了，这时<code>server</code>就可以将第2、3次合并，回复结果中包括告诉<code>client</code>已经收到它的断开请求，告诉<code>client</code>已经没有数据要发了</p></li></ol> <h3 id="_4-5-应用层"><a href="#_4-5-应用层" class="header-anchor">#</a> 4.5 应用层</h3> <p>常见的协议</p> <ul><li>超文本传输：<code>HTTP</code>、<code>HTTPS</code></li> <li>文件传输：<code>FTP</code></li> <li>电子邮件：<code>SMTP</code>、<code>POP3</code>、<code>IMAP</code></li> <li>动态主机配置：<code>DHCP</code></li> <li>域名系统：<code>DNS</code></li></ul> <h4 id="_4-5-1-域名"><a href="#_4-5-1-域名" class="header-anchor">#</a> 4.5.1 域名</h4> <p>由于<code>IP</code>地址不方便记忆，并且不能表达组织的名称和性质，人们设计出了域名<code>Domain Name</code>，实际上为了能够访问具体的主机，最终还是得知道目标主机的<code>IP</code>地址</p> <p>根据级别的不同，域名可以分为</p> <ul><li><p>顶级域名</p> <p>通用顶级域名（General Top-level Domain，简称gTLD）</p> <p><code>.com</code>公司、<code>.net</code>网络机构、<code>.org</code>组织机构、<code>.edu</code>教育、<code>.gov</code>政府部门、<code>.int</code>国际组织...</p> <p>国家及地区顶级域名（Country code Top-level Domain，简称ccTLD）</p> <p><code>.cn</code>中国、<code>.jp</code>日本、<code>.uk</code>英国...</p> <p>新通用顶级域名（New Generic Top-level Domain，简称New gTLD）</p> <p><code>.vip</code>、<code>.xyz</code>、<code>.top</code>、<code>.club</code>、<code>.shop</code>...</p></li> <li><p>二级域名，顶级域名之下的域名</p> <p>在通用顶级域名之下的域名，它一般指域名注册人的名称，例如<code>google</code>、<code>baidu</code>、<code>microsoft</code>...</p> <p>在国家及地区域名下，它一般指注册类别的，例如<code>com</code>、<code>edu</code>、<code>gov</code>、<code>net</code>等</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403132323.png" alt="image-20210219164803428"></p></li> <li><p>三级域名</p></li> <li><p>...</p></li></ul> <h4 id="_4-5-2-dns"><a href="#_4-5-2-dns" class="header-anchor">#</a> 4.5.2 DNS</h4> <p><code>DNS</code>的全称是：<code>Domain Name System</code>，译为：域名系统。利用<code>DNS</code>协议，可以将域名（比如<code>baidu.com</code>）解析成对应的<code>IP</code>地址<code>220.181.38.148</code></p> <p><code>DNS</code>可以基于<code>UDP</code>协议，也可以基于<code>TCP</code>协议，服务器占用53端口</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403132334.png" alt="image-20210219171311319"></p> <p><strong>DNS服务器</strong></p> <ol><li>客户端首先会访问最近的一台<code>DNS</code>服务器（或者是客户端自己配置的<code>DNS</code>服务器）</li> <li>所有的<code>DNS</code>服务器都记录了<code>DNS</code>根服务器的<code>IP</code>地址</li> <li>上级<code>DNS</code>服务器记录了下一级<code>DNS</code>服务器的<code>IP</code>地址</li> <li>全球一共13台<code>IPv4</code>的<code>DNS</code>根域名服务器、25台<code>IPv6</code>的<code>DNS</code>根域名服务器</li></ol> <h4 id="_4-5-3-dhcp"><a href="#_4-5-3-dhcp" class="header-anchor">#</a> 4.5.3 DHCP</h4> <p><code>IP</code>地址按照分配方式，可以分为：静态<code>IP</code>地址、动态<code>IP</code>地址</p> <ul><li><p>静态<code>ip</code>地址</p> <p>手动设置</p> <p>使用场景：不怎么挪动的台式机（比如学校机房中的台式机）、服务器等</p></li> <li><p>动态<code>IP</code>地址</p> <p>从<code>DHCP</code>服务器自动获取<code>IP</code>地址</p> <p>使用场景：移动设备、无线设备等</p></li></ul> <p><code>DHCP</code>（Dynamic Host Configuraiton Protocol）：动态主机配置协议，<code>DHCP</code>协议是基于<code>UDP</code>协议，客户端是68端口，服务器是67端口</p> <p><code>DHCP</code>服务器会从<code>IP</code>地址池中，挑选一个<code>IP</code>地址“出租”给客户端一段时间，时间到期就回收它们，平时家里上网的路由器可以充当<code>DHCP</code>服务器</p> <p><strong>DHCP分配流程</strong></p> <ol><li><p><code>DISCOVER</code>：发现服务器</p> <p>发广播包(源<code>IP</code>是<code>0.0.0.0</code>，目标是<code>255.255.255.255</code>，目标<code>MAC</code>是<code>FF:FF:FF:FF:FF:FF</code>)</p></li> <li><p><code>OFFER</code>：提供租约</p> <p>服务器返回可以租用的<code>IP</code>地址，以及租用期限、子网掩码、网管、<code>DNS</code>等信息，可能会有多个服务器提供租约</p></li> <li><p><code>REQUEST</code>：选择<code>IP</code>地址</p> <p>客户端选择一个<code>OFFER</code>，发送广播包进行回应</p></li> <li><p><code>ACKNOWLEDGE</code>：确认</p> <p>被选中的服务器发送<code>ACK</code>数据包给客户端，<code>IP</code>地址分配完毕</p></li></ol> <p><strong>细节</strong></p> <ol><li><code>DHCP</code>服务器可以借助<code>DHCP</code>中继代理（<code>DHCP Relay Agent</code>）实现跨网段分配<code>IP</code>地址（假设<code>DHCP</code>服务器、客户端不在同一个网段）</li> <li>自动续约：客户端会在租期不足的时候，自动向<code>DHCP</code>服务器发送<code>REQUEST</code>信息申请续约</li></ol> <h4 id="_4-5-4-http"><a href="#_4-5-4-http" class="header-anchor">#</a> 4.5.4 HTTP</h4> <p><code>HTTP</code>（Hyper Text Transfer Protocol）：超文本传输协议，是互联网中应用最广泛的应用层协议之一。设计<code>HTTP</code>最初的目的是：提供一种发布和接受<code>HTML</code>页面的方法，由<code>URI</code>来标识具体的资源；后面用<code>HTTP</code>传递的数据格式不仅仅是<code>HTML</code>，应用非常广泛</p> <p><code>HTTP</code>的标准是由万维网协会<code>W3C</code>、互联网工程任务组<code>IETF</code>协调指定，最终发布的一系列的<code>RFC</code>（Request For Comments，可以译为：请求意见稿）</p> <p><strong>版本</strong></p> <ol><li>1991年<code>HTTP/0.9</code>，只支持<code>GET</code>请求方法获取文本数据（比如<code>HTML</code>文档），且不支持请求头、响应头等，无法向服务器传递太多信息</li> <li>1996年<code>HTTP/1.0</code>，支持<code>POST</code>、<code>HEAD</code>等请求方法，支持请求头、响应头等，支持更多种数据类型（不再局限于文本数据），浏览器每次请求都需要与服务器建立一个<code>TCP</code>连接，请求处理完成后立即断开<code>TCP</code>连接</li> <li>1997年<code>HTTP/1.1</code>，最经典、使用最广泛的版本。支持<code>PUT</code>、<code>DELETE</code>等请求方法，采用持久连接<code>Connection: keep-alive</code>，多个请求可以共用一个<code>TCP</code>连接</li> <li>2015年<code>HTTP/2.0</code></li> <li>2018年<code>HTTP/3.0</code></li></ol> <p><strong>报文格式</strong></p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403132347.png" alt="image-20210219204320592"></p> <ol><li><p>请求报文</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code>POST /s1/login HTTP/1.1
<span class="token key atrule">Host</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8080</span>
<span class="token key atrule">Connection</span><span class="token punctuation">:</span> keep<span class="token punctuation">-</span>alive
<span class="token key atrule">Content-Length</span><span class="token punctuation">:</span> <span class="token number">25</span>
<span class="token key atrule">Cache-Control</span><span class="token punctuation">:</span> max<span class="token punctuation">-</span>age=0
<span class="token key atrule">Upgrade-Insecure-Requests</span><span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token key atrule">Origin</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">8080</span>
<span class="token key atrule">Content-Type</span><span class="token punctuation">:</span> application/x<span class="token punctuation">-</span>www<span class="token punctuation">-</span>form<span class="token punctuation">-</span>urlencoded
<span class="token key atrule">User-Agent</span><span class="token punctuation">:</span> Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML<span class="token punctuation">,</span> like Gecko) Chrome/88.0.4324.182 Safari/537.36 Edg/88.0.705.74
<span class="token key atrule">Accept</span><span class="token punctuation">:</span> text/html<span class="token punctuation">,</span>application/xhtml+xml<span class="token punctuation">,</span>application/xml;q=0.9<span class="token punctuation">,</span>image/webp<span class="token punctuation">,</span>image/apng<span class="token punctuation">,</span><span class="token important">*/*;q=0.8</span><span class="token punctuation">,</span>application/signed<span class="token punctuation">-</span>exchange;v=b3;q=0.9
<span class="token key atrule">Sec-Fetch-Site</span><span class="token punctuation">:</span> same<span class="token punctuation">-</span>origin
<span class="token key atrule">Sec-Fetch-Mode</span><span class="token punctuation">:</span> navigate
<span class="token key atrule">Sec-Fetch-User</span><span class="token punctuation">:</span> <span class="token punctuation">?</span>1
<span class="token key atrule">Sec-Fetch-Dest</span><span class="token punctuation">:</span> document
<span class="token key atrule">Referer</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8080/s1/html/login.html
<span class="token key atrule">Accept-Encoding</span><span class="token punctuation">:</span> gzip<span class="token punctuation">,</span> deflate<span class="token punctuation">,</span> br
<span class="token key atrule">Accept-Language</span><span class="token punctuation">:</span> zh<span class="token punctuation">-</span>CN<span class="token punctuation">,</span>zh;q=0.9<span class="token punctuation">,</span>en;q=0.8<span class="token punctuation">,</span>en<span class="token punctuation">-</span>GB;q=0.7<span class="token punctuation">,</span>en<span class="token punctuation">-</span>US;q=0.6<span class="token punctuation">,</span>zh<span class="token punctuation">-</span>TW;q=0.5
<span class="token key atrule">Cookie</span><span class="token punctuation">:</span> JSESSIONID=FE9FD8715D870123295BBC401B6DB7E6; Idea<span class="token punctuation">-</span>9729ea=64ab6b25<span class="token punctuation">-</span>3255<span class="token punctuation">-</span>43ab<span class="token punctuation">-</span>9637<span class="token punctuation">-</span>7c28d339adb8

username=123<span class="token important">&amp;password=456</span>
</code></pre></div></li> <li><p>响应报文</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code>HTTP/1.1 200 
<span class="token key atrule">Content-Length</span><span class="token punctuation">:</span> <span class="token number">16</span>
<span class="token key atrule">Date</span><span class="token punctuation">:</span> Fri<span class="token punctuation">,</span> 19 Feb 2021 12<span class="token punctuation">:</span>37<span class="token punctuation">:</span>46 GMT
<span class="token key atrule">Keep-Alive</span><span class="token punctuation">:</span> timeout=20
<span class="token key atrule">Connection</span><span class="token punctuation">:</span> keep<span class="token punctuation">-</span>alive

Login Success<span class="token tag">!</span><span class="token tag">!</span><span class="token tag">!</span>
</code></pre></div></li></ol> <p><strong>ABNF</strong></p> <p><code>ABNF</code>（Augmented BNF）是<code>BNF</code>（Backus-Naur Form，巴科斯-瑙尔范式）的修改、增强版，<code>ABNF</code>用作<code>internet</code>中通信协议的定义语言</p> <p>整体格式</p> <div class="language-ABNF extra-class"><pre class="language-abnf"><code><span class="token rule">HTTP-message</span> <span class="token operator">=</span> <span class="token rule">start-line</span> <span class="token repetition operator">*</span> <span class="token punctuation">(</span><span class="token rule">header-field</span> <span class="token core-rule rule constant">CRLF</span><span class="token punctuation">)</span> <span class="token core-rule rule constant">CRLF</span> <span class="token punctuation">[</span><span class="token rule">message-body</span><span class="token punctuation">]</span>
</code></pre></div><ul><li><code>start-line</code>：请求行<code>request-line</code>或者响应行<code>status-line</code></li> <li><code>*</code>：0个或者多个。2*表示至少2个，3*6表示3到6个</li> <li><code>()</code>：组成一个整体</li> <li><code>[]</code>：可选</li></ul> <p><strong>URL编码</strong></p> <p><code>URL</code>中一旦出现了一些特殊字符（比如中文、空格），需要进行编码，在浏览器地址栏输入<code>URL</code>时，是采用<code>UTF-8</code>进行编码</p> <p><strong>请求方法</strong></p> <ol><li><code>GET</code>：常用于读取的操作，请求参数直接拼接在<code>URL</code>的后面（浏览器对<code>URL</code>是有长度限制的）</li> <li><code>POST</code>：常用于添加、修改、删除的操作，请求参数可以放到请求体中（没有大小限制）</li> <li><code>HEAD</code>：请求得到与<code>GET</code>请求相同的响应，但没有响应体（即只获取响应头）</li> <li><code>OPTIONS</code>：用于获取目的资源所支持的通信选项，比如服务器支持的请求方法</li> <li><code>PUT</code>：用于对已存在的资源进行整体覆盖</li> <li><code>PATCH</code>：用于对资源进行部分修改（资源不存在，会创建新的资源）</li> <li><code>DELETE</code>：用于删除指定的资源</li> <li><code>TRACE</code>：请求服务器回显其收到的请求信息，主要用于<code>HTTP</code>请求的测试或诊断</li> <li><code>CONNECT</code>：可以开启一个客户端与所请求资源之间的双向沟通的通道，它可以用来创建隧道<code>tunnel</code>，可以用来访问采用了<code>SSL(HTTPS)</code>协议的站点</li></ol> <p><strong>头部字段</strong></p> <p>类型</p> <ul><li>请求头字段<code>Request Header Fields</code>，有关要获取的资源或客户端本身信息的消息头</li> <li>响应头字段<code>Response Header Fields</code>，有关响应的补充信息，比如服务器本身（名称和版本等）的消息头</li> <li>实体头字段<code>Entity Header Fields</code>，有关实体主体的更多信息，比如主体长度<code>Content-Length</code>或者<code>MIME</code>类型</li> <li>通用头字段<code>General Header Fields</code>，同时适用于请求和响应消息，但与消息主体无关的消息头</li></ul> <p>请求头字段</p> <table><thead><tr><th>头部字段</th> <th>说明</th> <th>示例</th></tr></thead> <tbody><tr><td>User-Agent</td> <td>浏览器的身份标识字符串</td> <td>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.182 Safari/537.36 Edg/88.0.705.74</td></tr> <tr><td>Host</td> <td>服务器的域名、端口号</td> <td>Host: localhost:8080</td></tr> <tr><td>Date</td> <td>发送消息的日期和时间</td> <td>Date: Fri, 19 Feb 2021 12:37:46 GMT</td></tr> <tr><td>Referer</td> <td>表示浏览器所访问的前一个页面，正是那个页面上的某个链接将浏览器带到了当前所请求的这个页面</td> <td>Referer: https://www.baidu.com</td></tr> <tr><td>Content-Type</td> <td>请求体的类型</td> <td>Content-Type: application/x-www-form-urlencoded</td></tr> <tr><td>Content-Length</td> <td>请求体的长度（字节）</td> <td>Content-Length: 16</td></tr> <tr><td>Accept</td> <td>能够接受的响应内容类型（Content-Types）</td> <td>Accept: text/plain</td></tr> <tr><td>Accept-Charset</td> <td>能够接受的字符集</td> <td>Accept-Charset: utf-8</td></tr> <tr><td>Accept-Encoding</td> <td>能够接受的编码方式列表</td> <td>Accept-Encoding: gzip, deflate</td></tr> <tr><td>Accept-Language</td> <td>能够接受的响应内容的自然语言列表</td> <td>Accept-Language: en-US</td></tr> <tr><td>Range</td> <td>仅请求某个实体的一部分。字节偏移以0开始</td> <td>Range: bytes=500-999</td></tr> <tr><td>Origin</td> <td>发起一个针对跨域资源共享的请求</td> <td>Origin: https://www.baidu.com</td></tr> <tr><td>Cookie</td> <td>之前由服务器通过Set-Cookie发送的Cookie</td> <td>Cookie: $Version=1; Skin=new;</td></tr> <tr><td>Connection</td> <td>该浏览器想要优先使用的连接类型</td> <td>Connection: keep-alive</td></tr> <tr><td>Cache-Control</td> <td>用来指定在这次的请求/响应链中的所有缓存机制都必须遵守的指令</td> <td>Cache-Control: no-cache</td></tr></tbody></table> <p>响应头字段</p> <table><thead><tr><th>字段名</th> <th>说明</th> <th>示例</th></tr></thead> <tbody><tr><td>Date</td> <td>发送消息的日期和时间</td> <td>Date: Fri, 19 Feb 2021 12:37:46 GMT</td></tr> <tr><td>Last-Modified</td> <td>所请求的对象的最后修改日期</td> <td>Last-Modified: Tue, Fri, 19 Feb 2021 12:37:46 GMT</td></tr> <tr><td>Server</td> <td>服务器的名字</td> <td>Server: Apache/2.4.1 (Unix)</td></tr> <tr><td>Expires</td> <td>指定一个时间，超过改时间认为此响应已经过期</td> <td>Expires: Tue, Fri, 19 Feb 2021 12:37:46 GMT</td></tr> <tr><td>Content-Type</td> <td>响应体的类型</td> <td>Content-Type: text/html; charset=utf-8</td></tr> <tr><td>Content-Encoding</td> <td>内容所使用的编码类型</td> <td>Content-Encoding: gzip</td></tr> <tr><td>Content-Length</td> <td>响应体的长度（字节为单位）</td> <td>Content-Length: 348</td></tr> <tr><td>Content-Disposition</td> <td>一个可以让客户端下载文件并建议文件名的头部</td> <td>Content-Disposition: attachment; filename=&quot;fname.ext&quot;</td></tr> <tr><td>Accept-Ranges</td> <td>服务器支持哪些种类的部分内容范围</td> <td>Accept-Ranges: bytes</td></tr> <tr><td>Content-Range</td> <td>这条消息是属于完整消息的哪部分</td> <td>Content-Range: bytes 21010-47021/47022</td></tr> <tr><td>Access-Control-Allow-Origin</td> <td>指定哪些网站可参与到跨域资源共享文件过程中</td> <td>Access-Control-Allow-Origin: *</td></tr> <tr><td>Location</td> <td>用来进行重定向，或者在创建了某个新资源时使用</td> <td>Location: http://www.baidu.com</td></tr> <tr><td>Set-Cookie</td> <td>返回一个Cookie让客户端去保存</td> <td>Set-Cookie: UserID=xxxxxxxxx</td></tr> <tr><td>Connection</td> <td>针对该连接所预期的选项</td> <td>Connection: close</td></tr> <tr><td>Cache-Control</td> <td>向从服务器直到客户端在内的所有缓存机制告知，他们是否可以缓存这个对象。单位秒</td> <td>Cache-Control: max-age=1000</td></tr></tbody></table> <p><strong>状态码</strong></p> <p>分类</p> <ol><li>信息响应：<code>100~199</code></li> <li>成功响应：<code>200~299</code></li> <li>重定向：<code>300~399</code></li> <li>客户端错误：<code>400~499</code></li> <li>服务器错误：<code>500~599</code></li></ol> <p>常见的状态码</p> <ul><li>100<code>continue</code>，请求的初始部分已经被服务器收到，并且没有被服务器拒绝。客户端应该继续发送剩余的请求，如果请求已经完成，就忽略这个响应。允许客户端发送带请求体的请求前，判断服务器是否愿意接受请求（服务器通过请求头判断）。在某些情况下，如果服务器在不看请求体就拒绝请求时，客户端就发送请求体是不恰当的或低效的</li> <li>200<code>ok</code>，请求成功</li> <li>302<code>found</code>，请求的资源被暂时的移动到了由<code>location</code>头部指定的<code>URL</code>上</li> <li>304<code>not modified</code>，说明无需再次传输请求的内容，也就是说可以使用缓存的内容</li> <li>400<code>bad request</code>，由于语法无效，服务器无法理解该请求</li> <li>401<code>unauthorized</code>，由于缺乏目标资源要求的身份验证凭证</li> <li>404<code>not found</code>，服务器端无法找到所请求的资源</li> <li>405<code>method not allowed</code>，服务器禁止了使用当前<code>HTTP</code>方法的请求</li> <li>406<code>not acceptable</code>，服务器端无法提供与<code>Accept-Charset</code>以及<code>Accept-Language</code>指定的值相匹配的响应</li> <li>408<code>request timeout</code>，服务器想要将没有在使用的连接关闭，一些服务器会在空闲连接上发送此信息，即便是在客户端没有发送任何请求的情况下</li> <li>500<code>internal server error</code>，所请求的服务器遇到意外的情况并阻止其执行请求</li> <li>501<code>not implemented</code>，请求的方法不被服务器支持，因此无法被处理，服务器必须支持的方法只有<code>GET</code>和<code>HEAD</code></li> <li>502<code>bad gateway</code>，作为网关或代理角色的服务器，从上游服务器（如<code>tomcat</code>）中接受到的响应式无效的</li> <li>503<code>service unavailable</code>，服务器尚处于可以接受请求的状态，可能是服务器停机维护或过载</li></ul> <p><strong>跨域</strong></p> <ul><li><p>解决<code>AJAX</code>跨域请求的常用方法</p> <p><code>CORS(Cross-Origin Resource Sharing)</code>，跨域资源共享</p></li> <li><p><code>CROS</code>的实现需要客户端和服务器同时支持</p> <p>客户端：所有浏览器都支持</p> <p>服务器：需要返回相应的响应头（比如<code>Access-Control-Allow-Origin</code>），告诉浏览器这是一个允许跨域访问的请求</p></li></ul> <h4 id="_4-5-5-https"><a href="#_4-5-5-https" class="header-anchor">#</a> 4.5.5 HTTPS</h4> <p><code>HTTPS(HyperText Transfer Protocol Secure)</code>，超文本传输安全协议。也被称为<code>HTTP over TLS</code>、<code>HTTP over SSL</code>、<code>HTTP Secure</code>，<code>HTTPS</code>的默认端口号是<code>443</code></p> <p><code>HTTPS</code>是在<code>HTTP</code>的基础上使用<code>SSL/TLS</code>来加密报文，对窃听和中间人攻击提供合理的防护。<code>SSL/TLS</code>也可以用在其他协议上，比如<code>FTP</code>--&gt;<code>FTPS</code>、<code>SMTP</code>--&gt;<code>SMTPS</code></p> <p><code>TLS(Transport Layer Security)</code>：传输层安全协议前身是<code>SSL(Secure Sockets Layer)</code>安全套接层，<code>SSL/TLS</code>工作在应用层和传输层之间</p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403132437.png" style="zoom:50%;"> <p><code>HTTPS</code>的通讯过程</p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403132501.png" style="zoom:50%;"> <ol><li><code>TCP</code>的3次握手</li> <li><code>TLS</code>的连接</li> <li><code>HTTP</code>请求和响应</li></ol> <p><strong>TLS连接的关键步骤</strong></p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403132525.png" style="zoom:50%;"> <ol><li><p><code>Client Hello</code></p> <p><code>TLS</code>的版本号，支持的加密组件<code>Clipher Suite</code>列表（加密组件是指所使用的加密算法及密钥长度等），一个随机数<code>Client Random</code></p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403132554.png" alt="image-20210222100354425"></p></li> <li><p><code>Server Hello</code></p> <p><code>TLS</code>的版本号，选择的加密组件（是从接收到的客户端加密组件列表中挑选出来的），一个随机数</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403132620.png" alt="image-20210222100434999"></p></li> <li><p><code>Certificate</code></p> <p>服务器的公钥证书（被CA签名过）</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403132633.png" alt="image-20210222100520486"></p></li> <li><p><code>Server Key Exchange</code></p> <p>用以实现<code>ECDHE</code>算法的其中一个参数<code>Server Params</code>(<code>ECDHE</code>是一种密钥交换算法，为了防止伪造，<code>Server Params</code>经过了服务器私钥签名）</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403132643.png" alt="image-20210222100836077"></p></li> <li><p><code>Server Hello Done</code></p> <p>告知客户端，协商结束</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403132651.png" alt="image-20210222101103662"></p></li> <li><p><code>Client Key Exchange</code></p> <p>发送用以实现<code>ECDHE</code>算法的另一个参数<code>Client Params</code></p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403132701.png" alt="image-20210222101555895"></p> <p>目前，客户端和服务器都拥有了<code>ECDHE</code>算法需要的2个参数：<code>Server Params</code>、<code>Client Params</code>。客户端、服务器都可以使用<code>ECDHE</code>算法根据<code>Server Params</code>、<code>Client Params</code>计算出一个新的随机字符串<code>Pre-master secret</code>。然后结合<code>Client Random</code>、<code>Server Random</code>、<code>Pre-master secret</code>生成一个主密钥，使用主密钥衍生出客户端发送的会话密钥、服务器发送的会话密钥等</p></li> <li><p><code>Change Cipher Spec</code></p> <p>告知服务器，之后的通信采用计算出来的会话密钥进行加密</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403132709.png" alt="image-20210222102408322"></p></li> <li><p><code>Finished</code></p> <p>包含连接至今全部报文的整体校验值（摘要），加密之后发送给服务器</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403132720.png" alt="image-20210222102551886"></p></li> <li><ol start="10"><li>服务器发送的<code>Change Cipher Spec</code>、<code>Finished</code></li></ol> <p>到此为止，客户端服务器都验证加密解密没有问题，握手正式结束，后面开始传输加密的<code>HTTP</code>请求和响应</p> <p><img src="%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE.assets/image-20210222102408322.png" alt="image-20210222102408322"></p> <p><img src="%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE.assets/image-20210222102551886.png" alt="image-20210222102551886"></p></li></ol> <h4 id="_4-5-6-spdy"><a href="#_4-5-6-spdy" class="header-anchor">#</a> 4.5.6 SPDY</h4> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403132731.png" style="zoom:50%;"> <p><code>SPDY(speedy)</code>，是基于<code>TCP</code>的应用层协议，它强制要求使用<code>SSL/TLS</code>。<code>SPDY</code>并不用于取代<code>HTTP</code>，它只是修改了<code>HTTP</code>请求于响应的传输方式。只需要增加一个<code>SPDY</code>层，现有的所有服务端应用均不用做任何修改。</p> <p><code>SPDY</code>是<code>HTTP/2</code>的前身</p> <h4 id="_4-5-7-http-2"><a href="#_4-5-7-http-2" class="header-anchor">#</a> 4.5.7 HTTP/2</h4> <p><code>HTTP/2</code>在底层传输做了很多的改进和优化，但在语意上完全与<code>HTTP/1.1</code>兼容（比如请求头、响应码等没有改变）</p> <p><strong>HTTP/2的特性</strong></p> <ol><li><p>二进制格式</p> <p>采用二进制格式传输数据，而非<code>HTTP/1.1</code>的文本格式</p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403132759.png" style="zoom:50%;"> <p>数据流：已建立的连接内的双向字节流，可以承载一条或多条消息。所有的通信都在一个<code>TCP</code>连接上完成，此连接可以承载任意数量的双向数据流</p> <p>消息：与逻辑<code>HTTP</code>请求或响应消息对应，由一系列帧组成</p> <p>帧：<code>HTTP/2</code>通信的最小单位，每个帧都包含帧头（会标识出当前帧所属的数据流），来自不同数据流的帧可以交错发送，然后再根据每个帧头的数据标识符重新组装</p></li> <li><p>多路复用<code>Multiplexing</code></p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403132829.png" alt="image-20210222120606370" style="zoom:50%;"> <p>客户端和服务器可以将<code>HTTP</code>消息分解为互不以来的帧，然后交错发送，最后再在另一端把他们重新组装起来</p> <p>并行交错地发送多个请求，请求之间互不影响</p> <p>并行交错地发送多个响应，响应之间互不影响</p> <p>使用一个连接并行发送多个请求和响应</p></li> <li><p>优先级</p> <p><code>HTTP/2</code>标准允许每个数据流都有一个关联的权重和依赖关系，可以向每个数据流分配一个1至256之间的整数，每个数据流与其他数据流之间可以存在显示依赖关系</p> <p>客户端可以构建和传递&quot;优先级树&quot;，表明它倾向于如何接受响应</p> <p>服务器可以使用此信息通过控制CPU、内存和其他资源的分配设定数据流处理的优先级，在资源数据可用之后，确保将高优先级响应以最优的方式传输至客户端</p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403132852.png" alt="image-20210222123410978" style="zoom:50%;"> <ul><li><p>应尽可能先给父数据流分配资源</p></li> <li><p>同级数据流（共享相同父项）应按其权重比例分配资源</p></li></ul></li> <li><p>头部压缩</p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403132908.png" alt="image-20210222123945994" style="zoom:50%;"> <p><code>HTTP/2</code>使用<code>HPACK</code>压缩请求头和响应头，可以极大减少头部开销，进而提高性能</p></li> <li><p>服务器推送</p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403132923.png" alt="image-20210222124915234" style="zoom:50%;"> <p>服务器可以对一个客户端请求发送多个响应，除了最初的响应外，服务器还可以向客户端推送额外资源，而无需客户端额外明确地请求</p></li></ol> <p><strong>HTTP/2的问题</strong></p> <ol><li><p>队头阻塞</p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403132938.png" alt="image-20210222125422820" style="zoom:50%;"> <p>假设在传输过程中，红色的数据包丢失，剩下的数据不能够传输到应用层，而是等待红色的数据包重传</p></li> <li><p>握手延迟</p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403132955.png" alt="image-20210222125759032" style="zoom:50%;"></li></ol> <h4 id="_4-5-8-http-3"><a href="#_4-5-8-http-3" class="header-anchor">#</a> 4.5.8 HTTP/3</h4> <p><code>Google</code>开发的基于<code>UDP</code>协议的<code>QUIC</code>协议，后改名<code>HTTP/3</code></p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403133015.png" alt="image-20210222130037226" style="zoom:50%;"> <p>数据的可靠传输由<code>QUIC</code>协议来保证</p> <p><strong>HTTP/3的特性——连接迁移</strong></p> <p><code>TCP</code>基于4要素（源IP、源端口、目标IP、目标端口），切换网络时至少有一个要素发生变化，导致连接发生变化。当连接发生变化时，就会连接失败重新建立连接</p> <p><code>QUIC</code>的连接不受4要素的影响，当4要素发生变化时，原连接依然维持。<code>QUIC</code>连接不以4要素作为标识，而是使用一组<code>Connection ID(连接ID)</code>来标识一个连接，即使<code>IP</code>或者端口发生变化，只要<code>Connection ID</code>没有变化，那么连接依然可以维持</p> <p><strong>HTTP/3的问题——操作系统内核、CPU负载</strong></p> <p>与传统的<code>TLS</code>的<code>HTTP/2</code>相比，大规模部署的<code>QUIC</code>需要近2倍的<code>CPU</code>使用量，原因是因为<code>Linux</code>内核的<code>UDP</code>部分没有像<code>TCP</code>那样的优化，因为传统上没有使用<code>UDP</code>进行如此高速的信息传输，并且<code>TCP</code>和<code>TLS</code>有硬件加速。</p> <h2 id="_5-网络基础知识"><a href="#_5-网络基础知识" class="header-anchor">#</a> 5. 网络基础知识</h2> <h3 id="_5-1-代理服务器"><a href="#_5-1-代理服务器" class="header-anchor">#</a> 5.1 代理服务器</h3> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403133035.png" style="zoom:50%;"> <p>代理服务器<code>Proxy Server</code>特点：本身不生产内容，处于中间位置转发上下游的请求和响应</p> <h4 id="_5-1-1-正向代理"><a href="#_5-1-1-正向代理" class="header-anchor">#</a> 5.1.1 正向代理</h4> <p><strong>正向代理</strong>：代理的对象是客户端</p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403133047.png" style="zoom:50%;"> <p><strong>作用</strong></p> <ol><li><p>隐藏客户端身份</p></li> <li><p>绕过防火墙（突破访问限制）</p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403133116.png" alt="image-20210221112437199" style="zoom:50%;"></li> <li><p><code>Internet</code>访问控制</p></li> <li><p>数据过滤</p></li></ol> <p>某些抓包工具（比如<code>Fiddler</code>、<code>Charles</code>）正是运用了代理服务器的原理。注意：<code>Wireshark</code>的原理是通过底层驱动，拦截网卡上流过的数据</p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403133143.png" style="zoom:50%;"> <h4 id="_5-1-2-反向代理"><a href="#_5-1-2-反向代理" class="header-anchor">#</a> 5.1.2 反向代理</h4> <p>反向代理：代理的对象是服务器</p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403133058.png" style="zoom:50%;"> <p><strong>作用</strong></p> <ol><li><p>隐藏服务器身份</p></li> <li><p>安全防护</p></li> <li><p>负载均衡</p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403133128.png" alt="image-20210221113908920" style="zoom:50%;"></li></ol> <h4 id="_5-1-3-相关头部字段"><a href="#_5-1-3-相关头部字段" class="header-anchor">#</a> 5.1.3 相关头部字段</h4> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403133200.png" alt="image-20210221115323441"></p> <ul><li><code>Via</code>：追加经过的每一台代理服务器的主机名（或域名）</li> <li><code>X-Forwarded-For</code>：追加请求方的<code>IP</code>地址</li> <li><code>X-Real-IP</code>：客户端的真实<code>IP</code>地址</li></ul> <p>第一次请求</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">Via</span><span class="token punctuation">:</span> proxy1
<span class="token key atrule">X-Forwarded-For</span><span class="token punctuation">:</span> 14.14.14.14
<span class="token key atrule">X-Real-IP</span><span class="token punctuation">:</span> 14.14.14.14
</code></pre></div><p>第二次请求</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">Via</span><span class="token punctuation">:</span> proxy1<span class="token punctuation">,</span> proxy2
<span class="token key atrule">X-Forwarded-For</span><span class="token punctuation">:</span> 14.14.14.14<span class="token punctuation">,</span> 220.11.11.11
<span class="token key atrule">X-Real-IP</span><span class="token punctuation">:</span> 14.14.14.14
</code></pre></div><p>第三次请求</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">Via</span><span class="token punctuation">:</span> proxy2
</code></pre></div><p>第四次请求</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">Via</span><span class="token punctuation">:</span> proxy2<span class="token punctuation">,</span> proxy1
</code></pre></div><h3 id="_5-2-cdn"><a href="#_5-2-cdn" class="header-anchor">#</a> 5.2 CDN</h3> <p><code>CDN(Content Delivery Network或Content Distribution Network)</code>，内容分发网络。利用最靠近每位用户的服务器，更快更可靠地将音乐、图片、视频等资源文件（一般是静态资源）传递给用户</p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403133223.png" alt="image-20210221122145172"></p> <p><code>CDN</code>运营商在全国、乃至全球的各个大枢纽城市都建立了机房，部署了大量拥有提高存储带宽的节点，构建了一个跨运营商、跨地域的专用网络。内容所有者（服务的拥有者）向<code>CDN</code>运营商支付费用，<code>CDN</code>将其内容交付给最终用户</p> <p>请求拥有<code>CDN</code>的服务器的流程</p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403133231.png" style="zoom:50%;"> <h3 id="_5-3-webservice"><a href="#_5-3-webservice" class="header-anchor">#</a> 5.3 WebService</h3> <p><code>WebService</code>，<code>Web</code>服务，是一种跨编程语言和跨操作系统平台的远程调用技术标准</p> <p>使用场景：天气预报，手机归属地查询、航班信息查询、物流信息查询等，比如天气预报，是气象局把自己的服务以<code>WebService</code>形式暴露出来，让第三方程序可以调用这些服务功能。</p> <p>事实上，<code>WebService</code>完全可以用普通的<code>Web API</code>取代（比如<code>HTTP</code>+<code>JSON</code>）</p> <p><code>SOAP(Simple Object Access Protocol)</code>，简单对象访问协议，很多时候<code>SOAP</code>=<code>HTTP</code>+<code>XML</code>，<code>WebService</code>使用<code>SOAP</code>协议来封装传输数据</p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403133535.png" style="zoom:50%;"> <p><code>WSDL(Web Service Description Language)</code>，<code>Web</code>服务描述语言，一个<code>XML</code>文档，用以描述<code>WebService</code>接口的细节（比如参数，返回值等），一般在<code>WebService</code>的<code>URL</code>后面跟上<code>?wsdl</code>获取<code>WSDL</code>信息</p> <h3 id="_5-4-httpdns"><a href="#_5-4-httpdns" class="header-anchor">#</a> 5.4 HTTPDNS</h3> <p><code>HTTPDNS</code>是基于<code>HTTP</code>协议向<code>DNS</code>服务器发送域名解析请求</p> <p>替代了基于<code>DNS</code>协议向运营商<code>Local DNS</code>发起解析请求的传统方式，可以避免<code>Local DNS</code>造成的域名劫持和跨网访问问题，常用在移动互联网中（比如在<code>Android</code>、<code>IOS</code>开发中）</p> <table><thead><tr><th>优势点</th> <th>xx云HTTPDNS</th> <th>运营商Local DNS</th></tr></thead> <tbody><tr><td>高速</td> <td>高速访问</td> <td>访问缓慢</td></tr> <tr><td>安全</td> <td>防劫持</td> <td>广告劫持</td></tr> <tr><td>智能</td> <td>精准调度</td> <td>解析转发</td></tr> <tr><td>可靠</td> <td>负载均衡</td> <td>异常故障</td></tr></tbody></table> <h3 id="_5-5-vpn"><a href="#_5-5-vpn" class="header-anchor">#</a> 5.5 VPN</h3> <p><code>VPN(Virtual Private Network)</code>，虚拟私人网络。它可以在公共网络上建立专用网络，进行加密通讯</p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403133601.png" style="zoom:50%;"> <p><strong>VPN的作用</strong></p> <ul><li><p>提高上网的安全性</p></li> <li><p>保护公司内部资料</p></li> <li><p>隐藏上网者的身份</p></li> <li><p>突破网站的地域限制</p> <p>有些网站针对不同地区的用户展示不同的内容</p></li> <li><p>突破网络封锁</p> <p>因为有<code>GFW(Great Firewall of China)</code>的限制，有些网站在国内访问不了</p></li></ul> <p><strong>VPN与代理的区别</strong></p> <ul><li><p>软件</p> <p><code>VPN</code>一般需要安装<code>VPN</code>客户端软件</p> <p>代理不需要安装额外的软件</p></li> <li><p>安全性</p> <p><code>VPN</code>默认会对数据进行加密</p> <p>代理默认不会对数据进行加密（数据最终是否加密取决于使用的协议本身）</p></li> <li><p>费用</p> <p>一般情况下，<code>VPN</code>比代理贵</p></li></ul> <p><strong>实现原理</strong></p> <p>隧道协议<code>Tunneling Protocol</code></p> <p>常见的隧道协议</p> <ul><li><code>PPTP(Point to Point Tunneling Protocol)</code>：点对点隧道协议</li> <li><code>L2TP(Layer Two Tunneling Protocol)</code>：第二层隧道协议</li> <li><code>IPsec(Internet Protocol Security)</code>：互联网安全协议</li> <li><code>SSL VPN</code>如<code>OpenVPN</code></li></ul> <h3 id="_5-6-网络爬虫"><a href="#_5-6-网络爬虫" class="header-anchor">#</a> 5.6 网络爬虫</h3> <p>网络爬虫<code>Web Crawler</code>，也叫网络蜘蛛<code>Web Spider</code>。模拟人类使用浏览器操作页面的行为</p> <p><code>robots.txt</code>是存放于网站根目录下的文本文件，比如<code>https://www.bilibili.com/robots.txt</code>。</p> <ul><li>用来告诉爬虫：哪些内容是不应被爬取的，哪些是可以被爬取的</li> <li>因为一些系统中的<code>URL</code>是大小写敏感的，所以<code>robots.txt</code>的文件名应统一为小写</li> <li>它不是一个规范，而只是约定俗成的，所以并不能保证网站的隐私</li></ul> <h3 id="_5-7-http缓存"><a href="#_5-7-http缓存" class="header-anchor">#</a> 5.7 HTTP缓存</h3> <p>通常会缓存的情况是：<code>GET</code>请求+静态资源（比如<code>HTML</code>、<code>CSS</code>、<code>JS</code>、图片等）</p> <h4 id="_5-7-1-响应头"><a href="#_5-7-1-响应头" class="header-anchor">#</a> 5.7.1 响应头</h4> <p><code>Pragma</code>：作用类似于<code>Cache-Control</code>，<code>HTTP/1.0</code>的产物</p> <p><code>Expires</code>：缓存的过期时间（<code>GMT</code>格式时间），<code>HTTP/1.0</code>的产物</p> <p><code>Cache-Control</code>：设置缓存策略</p> <p><strong>响应头</strong></p> <ul><li><code>no-storage</code>：不缓存数据到本地</li> <li><code>public</code>：允许用户、代理服务器缓存数据到本地</li> <li><code>private</code>：只允许用户缓存数据到本地</li> <li><code>max-age</code>：缓存的有效时间，单位秒</li> <li><code>Last-Modified</code>：资源的最后一次修改时间</li> <li><code>ETag</code>：资源的唯一标识（根据文件内容计算出来的摘要值）</li></ul> <p>优先级：<code>pragma</code> &gt; <code>Cache-Control</code> &gt; <code>Expires</code></p> <p><strong>请求头</strong></p> <ul><li><p><code>If-None-Match</code></p> <p>如果上一次的响应头中有<code>ETag</code>，就会将<code>ETag</code>的值作为请求头的值</p> <p>如果服务器发现资源的最新摘要值跟<code>If-None-Match</code>不匹配，就会返回新的资源<code>200 OK</code></p> <p>否则，就不会返回资源的具体数据<code>304 Not Modified</code></p></li> <li><p><code>If-Modified-Since</code></p> <p>如果上一次的响应头中没有<code>ETag</code>，有<code>Last-Modified</code>，就会将<code>Last-Modified</code>的值作为请求头的值</p> <p>如果服务器发现资源的最后一次修改时间晚于<code>If-Modified-Since</code>，就会返回新的资源<code>200 OK</code></p> <p>否则，就不会返回资源的具体数据<code>304 Not Modified</code></p></li></ul> <p><code>Last-Modified</code>的缺陷</p> <ul><li>只能精确到秒级别，如果资源在1秒内被修改了，客户端将无法获取最新的资源数据</li> <li>如果某些资源被修改了（最后一次修改时间发生了变化），但是内容并没有任何变化，相同数据重复传输</li></ul> <p><code>ETag</code></p> <ul><li>只要资源的内容没变化，就不会重复传输资源数据‘</li> <li>紫瑶资源的内容发生了变化，就会返回最新的资源给客户端</li></ul> <h4 id="_5-7-2-缓存使用流程"><a href="#_5-7-2-缓存使用流程" class="header-anchor">#</a> 5.7.2 缓存使用流程</h4> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403133618.png" style="zoom:50%;"> <h2 id="_6-网络安全"><a href="#_6-网络安全" class="header-anchor">#</a> 6. 网络安全</h2> <p>网络通信中面临的4中安全威胁</p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403133628.png" style="zoom:50%;"> <ul><li>截获：窃听通信内容</li> <li>中断：中断网络通信</li> <li>篡改：篡改通信内容</li> <li>伪造：伪造通信内容</li></ul> <h3 id="_6-1-arp欺骗"><a href="#_6-1-arp欺骗" class="header-anchor">#</a> 6.1 ARP欺骗</h3> <p><code>ARP</code>欺骗<code>ARP spoofing</code>，又称<code>ARP</code>毒化<code>ARP poisoning</code>、<code>ARP</code>病毒、<code>ARP</code>攻击。</p> <p><strong>ARP欺骗的效果</strong></p> <ol><li>可以让攻击者获取局域网上的数据包甚至可以篡改数据包</li> <li>可以让网络上特定的主机之间无法正常通信</li> <li>让送至特定<code>IP</code>地址的流量被错误送到攻击者所取代的地方</li></ol> <p><strong>攻击的核心步骤</strong></p> <p>假设主机<code>C</code>是攻击者，主机<code>A</code>、<code>B</code>是被攻击者。<code>C</code>只要收到过<code>A</code>、<code>B</code>发送的<code>ARP</code>请求，就会拥有<code>A</code>、<code>B</code>的<code>IP</code>、<code>MAC</code>地址，就可以进行欺骗活动</p> <ol><li><code>C</code>发送一个<code>ARP</code>响应给<code>B</code>，把响应包里的源<code>IP</code>设为<code>A</code>的<code>IP</code>地址，源<code>MAC</code>设为<code>C</code>的<code>MAC</code>地址</li> <li><code>B</code>收到<code>ARP</code>响应后，更新它的<code>ARP</code>表，把<code>A</code>的<code>MAC</code>地址<code>IP_A, MAC_A</code>改为<code>IP_A, MAC_C</code></li> <li>当<code>B</code>要发送数据包给<code>A</code>时，它根据<code>ARP</code>表来封装数据包的头部，把目标<code>MAC</code>地址改为<code>MAC_C</code>，而非<code>MAC_A</code></li> <li>当交换机收到<code>B</code>发送给<code>A</code>的数据包时，根据此包的目标<code>MAC</code>地址<code>MAC_C</code>而把数据包转发给<code>C</code></li> <li><code>C</code>收到数据包后，可以把它存起来以后再发送给<code>A</code>，达到窃听效果。<code>C</code>也可以篡改数据后才发送数据包给<code>A</code></li></ol> <p><strong>防护</strong></p> <ol><li><p>静态<code>ARP</code></p></li> <li><p><code>DHCP Snooping</code>，网络设备可借由<code>DHCP</code>保留网络上各电脑的<code>MAC</code>地址，在伪造的<code>ARP</code>数据包发出时即可侦测到</p></li> <li><p>利用一些软件监听<code>ARP</code>的不正常变动</p> <p>...</p></li></ol> <h3 id="_6-2-dos、ddos"><a href="#_6-2-dos、ddos" class="header-anchor">#</a> 6.2 DoS、DDoS</h3> <p><code>DoS</code>攻击（拒绝服务攻击，<code>Denial-of-Service attack</code>），使目标电脑的网络或系统资源耗尽，使服务暂时中断或停止，导致其正常用户无法访问</p> <p><code>DDoS</code>攻击（分布式拒绝服务攻击，<code>Distributed Denial-of-Service attack</code>），黑客使用网络上两个或以上被攻陷的电脑作为&quot;僵尸&quot;向特定的目标发动<code>DoS</code>攻击</p> <p><code>DoS</code>攻击可以分为两大类</p> <ol><li>带宽消耗型：<code>UDP</code>洪水攻击、<code>ICMP</code>洪水攻击</li> <li>资源消耗型：<code>SYN</code>洪水攻击、<code>LAND</code>攻击</li></ol> <p><strong>SYN洪水攻击</strong></p> <p>攻击者发送一系列的<code>SYN</code>请求到目标，然后让目标因收不到<code>ACK</code>（第三次握手）而进行等待、消耗资源</p> <p>攻击方法：跳过发送最后的<code>ACK</code>信息，修改源<code>IP</code>地址，让目标送<code>SYN-ACK</code>到伪造的<code>IP</code>地址，因此目标永不可能收到<code>ACK</code></p> <p><strong>LAND攻击</strong></p> <p><code>LAND</code>攻击（局域网拒绝服务攻击，<code>Local Area Network Denial attack</code>），通过持续发送相同相同源地址和目标地址的欺骗数据包，使目标试图与自己建立连接，消耗系统资源直至崩溃</p> <p><strong>防御</strong></p> <p>防御方式通常为：入侵检测、流量过滤和多重验证，堵塞网络带宽的流量将被过滤，而正常的流量可正常通过</p> <p>防火墙</p> <ul><li>防火墙可以设置规则，例如允许或拒绝特定通讯协议，端口或<code>IP</code>地址</li> <li>当工具从少数不正常的<code>IP</code>地址发出时，可以简单的使用拒绝规则阻止一切从攻击源<code>IP</code>发出的通讯</li> <li>复杂攻击难以用简单规则来组织，例如80端口遭受攻击时不可能拒绝端口所有通信，因为同时会组织合法流量</li> <li>防火墙可能处于网络架构中过后的位置，路由器可能在恶意流量达到防火墙前即被攻击影响</li></ul> <p>交换机：大多数交换机有一定的速度限制和访问控制能力</p> <p>路由器：和交换机类似，路由器也有一定的速度限制和访问控制能力</p> <p>黑洞引导：将所有受攻击计算机的通信全部发送至一个&quot;黑洞&quot;(空接口或不存在的计算机地址)或者有足够能力处理洪流的网络设备商，以免网络受到较大影响</p> <p>流量清洗：当流量被送到<code>DDoS</code>防护清洗中心时，通过采用抗<code>DDoS</code>软件处理，将正常流量和恶意流量区分开来</p> <h3 id="_6-3-dns劫持"><a href="#_6-3-dns劫持" class="header-anchor">#</a> 6.3 DNS劫持</h3> <p><code>DNS</code>劫持，又称为域名劫持。攻击者篡改了某个域名的解析结果，使得指向该域名的<code>IP</code>变成了另一个<code>IP</code>，导致对相应网址的访问被劫持到里一个不可到达的或者假冒的网址，从而实现非法窃取用户信息或者破坏正常网络服务的目的</p> <p>为了防止出现<code>DNS</code>劫持的现象，可以考虑使用更靠谱的<code>DNS</code>服务器，比如：<code>114.114.114.114</code></p> <ul><li>谷歌：<code>8.8.8.8</code>、<code>8.8.4.4</code></li> <li>微软：<code>4.2.2.1</code>、<code>4.2.2.2</code></li> <li>百度：<code>180.76.76.76</code></li> <li>阿里：<code>223.5.5.5</code>、<code>223.6.6.6</code></li></ul> <p><code>HTTP</code>劫持：对<code>HTTP</code>数据包进行拦截处理，比如插入<code>JS</code>代码</p> <h3 id="_6-4-加密和解密"><a href="#_6-4-加密和解密" class="header-anchor">#</a> 6.4 加密和解密</h3> <p><code>HTTP</code>协议默认是采用明文传输的，因此会有很大的安全隐患，常见的提高安全性的方法是：对通信内容进行加密后，再进行传输</p> <p>常见的加密方式：</p> <ul><li><p>不可逆：单向散列函数：<code>MD5</code>、<code>SHA</code>等</p></li> <li><p>可逆</p> <p>对称加密：<code>DES</code>、<code>3DES</code>、<code>AES</code>等</p> <p>非对称加密：<code>RSA</code>等</p></li> <li><p>其它</p> <p>混合密码系统</p> <p>数据签名</p> <p>证书</p></li></ul> <h4 id="_6-4-1-单向散列函数"><a href="#_6-4-1-单向散列函数" class="header-anchor">#</a> 6.4.1 单向散列函数</h4> <p>单向散列函数，可以根据消息内容计算出散列值。散列值的长度和消息的长度无关，无论消息是<code>1bit</code>、<code>10M</code>、<code>100G</code>，单向散列函数都会计算出固定长度的散列值。根据散列值无法推算出原数据。</p> <p>单向散列函数，也称为消息摘要函数<code>message digest function</code>、哈希函数<code>hash function</code>。输出的散列值，也称为消息摘要<code>message digest</code>、指纹<code>fingerprint</code></p> <p><strong>常见的散列函数</strong></p> <p><code>MD4</code>、<code>MD5</code>：产生128bit的散列值，<code>MD</code>就是<code>message Digest</code>的缩写，目前已不安全（被枚举破解）</p> <p><code>SHA-1</code>：产生160bit的散列值，目前已经不安全</p> <p><code>SHA-2</code>：<code>SHA-256</code>、<code>SHA-384</code>、<code>SHA-512</code>，散列值的长度分别是256bit、384bit、512bit</p> <p><code>SHA-3</code>：全新的标准</p> <h4 id="_6-4-2-对称加密"><a href="#_6-4-2-对称加密" class="header-anchor">#</a> 6.4.2 对称加密</h4> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403133646.png" alt="image-20210221165558662"></p> <p>对称加密<code>Symmetric Cryptography</code>，加密用的密钥和解密用的密钥是相同的</p> <p><strong>常见的对称加密的算法</strong></p> <ol><li><p><code>DES(Data Encryption Standard)</code></p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403133810.png" alt="image-20210221170053778"></p> <p><code>DES</code>是一种将<code>64bit</code>明文加密成<code>64bit</code>密文的对称加密算法，密钥长度<code>56bit</code></p> <p>规格上来说，密钥长度是<code>64bit</code>，但每隔<code>7bit</code>会设置一个用错误检查的<code>bit</code>，因此密钥长度实质上是<code>56bit</code></p> <p>由于<code>DES</code>每次只能加密<code>64bit</code>的数据，遇到比较大的数据，需要对<code>DES</code>加密进行迭代</p> <p>目前已经可以在短时间内被破解，不建议使用</p></li> <li><p><code>3DES(Triple Data Encryption Algorithm)</code></p> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403133823.png" alt="image-20210221171054789"></p> <p><code>3DES</code>，将<code>DES</code>重复3次所得到的一种密码算法，也叫做3重<code>DES</code>。<code>3DES</code>并不是进行三次<code>DES</code>加密，而是加密<code>Encryption</code>-&gt;解密<code>Decryption</code>-&gt;加密<code>Encryption</code>的过程</p> <p>目前还被一些银行等机构使用，但处理速度不高，安全性逐渐暴露出问题</p></li> <li><p><code>AES(Advanced Encryption Standard)</code></p> <p>取代<code>DES</code>成为新标准的一种对称加密算法，又称<code>Rijndael</code>加密算法</p> <p><code>AES</code>的密钥长度有128、192、256bit三种</p> <p>目前<code>AES</code>，已经逐步取代<code>DES</code>、<code>3DES</code>，成为首选的对称加密算法</p></li></ol> <p><strong>密钥配送</strong></p> <p>在使用对称加密时，首先要进行双方的密钥交换</p> <p>密钥配送方法</p> <ul><li>事先共享密钥</li> <li>密钥分配中心<code>Key Distribution Center</code>，简称<code>KDC</code></li> <li><code>Diffie-Hellman</code>密钥交换</li> <li>非对称加密</li></ul> <h4 id="_6-4-3-非对称加密"><a href="#_6-4-3-非对称加密" class="header-anchor">#</a> 6.4.3 非对称加密</h4> <p><img src="https://gitee.com/dingwanli/picture/raw/master/20210403134134.png" alt="image-20210221165719710"></p> <p>非对称加密<code>Asymmetric Cryptography</code>，加密用的密钥和解密用的密钥是不同的，分为加密密钥和解密密钥2种</p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403133854.png" style="zoom:50%;"> <ul><li>加密密钥：一般是公开的，因此该密钥称为公钥<code>public key</code>。非对称加密也被称为公钥密码<code>Public-key Cryptography</code></li> <li>解密密钥：由消息接受者自己保管，不能公开，因此也称为私钥<code>private key</code></li> <li>公钥和私钥是一一对应的</li> <li>由公钥加密的密文，必须使用该公钥对应的私钥才能解密</li> <li>由私钥加密的密文，必须使用该私钥对应的公钥才能解密</li></ul> <h4 id="_6-4-4-混合密码系统"><a href="#_6-4-4-混合密码系统" class="header-anchor">#</a> 6.4.4 混合密码系统</h4> <p>对称加密的缺点：不能很好的解决密钥配送的问题</p> <p>非对称加密的缺点：加密解密速度比较慢</p> <p>混合密码系统：可以解决上述问题</p> <p>网络上的密码通信所用的<code>SSL/TLS</code>都运用了混合密码系统</p> <p><strong>加密</strong></p> <p>回话密钥<code>session key</code></p> <ul><li>为本次通信随机生成的临时密钥</li> <li>作为对称加密的密钥，用于加密消息，提高速度</li></ul> <p><strong>加密步骤</strong></p> <ol><li>首先，消息发送者要拥有消息接受者的公钥</li> <li>生成回话密钥，作为对称加密的密钥，加密消息</li> <li>用消息接受者的公钥，加密回话密钥</li> <li>将前两步生成的加密结果，一并发给消息接受者</li></ol> <p><strong>解密过程</strong></p> <ol><li>消息接受者用自己的私钥解密出会话密钥</li> <li>再用第一步解密出来的会话密钥，解密消息</li></ol> <h4 id="_6-4-5-数字签名"><a href="#_6-4-5-数字签名" class="header-anchor">#</a> 6.4.5 数字签名</h4> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><p><code>A</code>发送的内容可能是被篡改的，或者有人伪装成<code>A</code>发消息，或者就是<code>A</code>发的，但它可以否认。<code>B</code>如何确定这段消息的真实性？</p> <p>数字签名</p> <ul><li>生成签名，由消息的发送者完成，通过“签名密钥”生成。一般是通过消息发送者的私钥进行签名</li> <li>验证签名，由消息的接受者完成，通过“验证密钥”验证</li></ul> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403134211.png" style="zoom:50%;"> <h4 id="_6-4-6-证书"><a href="#_6-4-6-证书" class="header-anchor">#</a> 6.4.6 证书</h4> <p>密码学中的证书，全称叫公钥证书<code>Public-key Certificate, PKC</code>，并由认证机构<code>Certificate Authority, CA</code>施加数字签名</p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403134223.png" style="zoom:50%;"> <p>各大<code>CA</code>的公钥，默认已经内置在浏览器和操作系统中</p> <p>证书的注册和下载</p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403134236.png" style="zoom:50%;"> <h2 id="_7-其他协议"><a href="#_7-其他协议" class="header-anchor">#</a> 7. 其他协议</h2> <h3 id="_7-1-ftp、websocket"><a href="#_7-1-ftp、websocket" class="header-anchor">#</a> 7.1 FTP、WebSocket</h3> <h4 id="_7-1-1-websocket"><a href="#_7-1-1-websocket" class="header-anchor">#</a> 7.1.1 WebSocket</h4> <p>HTTP请求的特点，通信只能由客户端发起。所以，早期很多网站为了实现推送技术，所用的技术都是轮询。即浏览器每隔一段时间去请求服务器，为了能更好的节省服务器资源和带宽，并且能够实时地进行通讯，<code>HTML5</code>规范中出现了<code>WebSocket</code>协议</p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403134249.png" style="zoom:50%;"> <p><code>WebSocket</code>是基于<code>TCP</code>的支持全双工通信的应用层协议，客户端，服务器都可以主动发消息给对方</p> <p><code>WebSocket</code>使用<code>80(ws://)</code>、<code>443(wss://)</code>端口，可以饶过大多数防火墙的限制</p> <p>通信之前，<code>WebSocket</code>需要先建立连接</p> <p><code>WebSocket</code>需要借助<code>HTTP</code>协议来建立连接（也叫做握手，<code>Handshake</code>），需要由客户端主动发出握手请求</p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403134303.png" style="zoom:50%;"> <ul><li><p><code>Connection</code>必须设置<code>Upgrade</code>，表示客户端希望连接升级</p></li> <li><p><code>Upgrade</code>必须设置<code>websocket</code>，表示希望升级到<code>WebSocket</code>协议</p></li> <li><p><code>Sec-WebSocket-Version</code>表示支持的表示支持的<code>WebSocket</code>的版本</p></li> <li><p><code>Sec-WebSocket-key</code>是客户端生成的随机字符串，服务器收到后会进行如下操作</p> <p>在<code>Sec-WebSocket-key</code>的后面加上一个固定的<code>GUID</code>值<code>258EAFA5-E914-47DA-95CA-C5AB0DC85B11</code></p> <p>将上述结果进行<code>SHA-1</code>摘要计算，得到的结果进行<code>HexBase64</code>编码，这次的结果作为<code>Sec-WebSocket-Accept</code>响应头的值，返回给客户端</p></li></ul> <h4 id="_7-1-2-ftp"><a href="#_7-1-2-ftp" class="header-anchor">#</a> 7.1.2 FTP</h4> <p><code>FTP(File Transport Protocol)</code>，文件传输协议，是基于<code>TCP</code>的应用层协议</p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403133453.png" style="zoom:50%;"> <p><code>FTP</code>的<code>URL</code>格式</p> <div class="language- extra-class"><pre class="language-text"><code>ftp://[user[:password]]@host[:port]/url-path
</code></pre></div><p><code>FTP</code>有2种连接模式：主动<code>Active</code>和被动<code>Passive</code>，不管是哪种模式，都需要客户端和服务器建立2个连接</p> <p>不管是哪种模式，都需要客户端和服务器建立2个连接</p> <ul><li>控制连接：用于传输状态信息（命令，<code>cmd</code>）</li> <li>数据连接：用于传输文件和目录信息（<code>data</code>）</li></ul> <p><strong>主动连接</strong></p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403133504.png" style="zoom:50%;"> <ol><li><p>客户端打开一个随机的命令端口，端口号大于<code>1024</code>假设为<code>N</code>，同时连接到服务器的命令端口21</p></li> <li><p>客户端开始监听<code>N+1</code>数据端口，同时向服务器发送一个<code>Port</code>命令给服务器的命令端口21</p> <p>此命令告诉服务器，客户端正在监听的数据端口是<code>N+1</code>，并且已准备好从端口接收数据</p></li> <li><p>服务器打开20号数据端口，并且创建和客户端数据端口<code>N+1</code>的连接</p></li></ol> <p><strong>被动模式</strong></p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403133517.png" style="zoom:50%;"> <ol><li><p>客户端通过两个随机端口与服务器建立连接</p> <p>命令端口<code>N</code>、数据端口<code>N+1</code></p></li> <li><p>客户端的命令端口<code>N</code>用于连接服务器的命令端口21</p></li> <li><p>客户端通过命令端口<code>N</code>发送<code>PASV</code>命令给服务器的命令端口21</p></li> <li><p>服务器打开一个随机的数据端口<code>P</code>，并告知客户端该端口号P</p></li> <li><p>客户端数据端口<code>N+1</code>发起与服务器数据端口<code>P</code>的连接</p></li></ol> <h3 id="_7-2-邮件"><a href="#_7-2-邮件" class="header-anchor">#</a> 7.2 邮件</h3> <p><strong>发邮件使用的协议</strong></p> <p><code>SMTP(Simple Mail Transfer Protocol)</code>，简单邮件传输协议，基于<code>TCP</code>，服务器默认使用25端口，<code>SSL/TLS</code>使用465端口</p> <p><strong>收邮件的协议</strong></p> <p><code>POP(Post Office Protocol)</code>，邮局协议，基于<code>TCP</code>，服务器默认使用110端口，<code>SSL/TLS</code>使用995端口</p> <p><code>IMAP(Internet Message Access Protocol)</code>，因特网信息访问协议，基于<code>TCP</code>，服务器默认使用143端口，<code>SSL/TLS</code>使用993端口</p> <p><strong>收发邮件的过程</strong></p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403133426.png" style="zoom:50%;"> <p><strong>POP和IMAP</strong></p> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403134326.png" style="zoom:50%;"> <img src="https://gitee.com/dingwanli/picture/raw/master/20210403134428.png" style="zoom:50%;"> <p><code>POP</code>的特点</p> <ul><li>客户端连接服务器时，将会从服务器下载所有邮件，可以设置下载完成之后，立即或一段时间后删除服务器邮件</li> <li>客户端的操作（比如删除邮件，移动到文件夹）不会跟服务器同步</li> <li>每个客户端都是独立的，都可以获得其自己的邮件副本</li></ul> <p><code>IMAP</code>的特点</p> <ul><li>客户端连接服务器时，获取的是服务器上邮件的基本信息，并不会下载邮件，等打开邮件时，才会下载邮件</li> <li>客户端的操作（比如删除邮件、移动到文件夹）会跟服务器同步</li> <li>所有客户端始终会看到相同的文件夹</li></ul> <h3 id="_7-3-即时通信"><a href="#_7-3-即时通信" class="header-anchor">#</a> 7.3 即时通信</h3> <p>即时通信<code>Instant Messaging</code>，简称<code>IM</code>，平时使用的<code>QQ</code>、微信，都属于典型的<code>IM</code>应用</p> <p>常用的协议</p> <p><strong>XMPP</strong></p> <p><code>XMPP(Extensible Messaging and Presence Protocol)</code>，可扩展消息与存在协议，前身是<code>Jabber</code>，基于<code>TCP</code>，默认端口是<code>5222</code>、<code>5269</code></p> <p>使用<code>XML</code>格式进行传输，体积较大</p> <p><strong>MQTT</strong></p> <p><code>MQTT(Message Queuing Telemetry Transport)</code>，消息队列遥测传输，基于<code>TCP</code>，默认端口<code>1883</code>、<code>8883</code>(带SSL/TLS)</p> <p>开销很小，以降低网络流量，信息冗余远小于<code>XMPP</code>，不是专门为<code>IM</code>设计的协议，很多功能需要自己实现</p> <h3 id="_7-4-流媒体"><a href="#_7-4-流媒体" class="header-anchor">#</a> 7.4 流媒体</h3> <p>流媒体<code>Streaming Media</code>，又叫流式媒体。是指将一连串的多媒体数据压缩后，经过互联网分段发送数据，在互联网上即时传输影音以供观赏的一种技术。此技术使得数据包得以像流水一样发送，不使用此技术，就必须使用提前现在整个媒体文件</p> <p><strong>常见协议</strong></p> <p><code>RTP(Real-Time Transport Protocol)</code>，实时传输协议，基于<code>UDP</code></p> <p><code>RTCP(Real-Time Transport Control Protocol)</code>，实时传输控制协议，基于<code>UDP</code>，使用<code>RTP</code>的下一个端口</p> <p><code>RTSP(Real-Time Streaming Protocol)</code>，实时流协议，基于<code>TCP</code>、<code>UDP</code>的554端口</p> <p><code>RTMP(Real-Time Messaging Protocol)</code>，实时消息传输协议，基于<code>TCP</code>，默认端口<code>1935</code></p> <p><code>HLS(HTTP Live Streaming)</code>，基于<code>HTTP</code>的流媒体网络传输协议</p></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">4/3/2021, 7:23:03 AM</span></div></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-70334359><li class="level-2" data-v-70334359><a href="/network/#_1-基本概念" class="sidebar-link reco-side-_1-基本概念" data-v-70334359>1. 基本概念</a></li><li class="level-3" data-v-70334359><a href="/network/#_1-1-网络互联模型" class="sidebar-link reco-side-_1-1-网络互联模型" data-v-70334359>1.1 网络互联模型</a></li><li class="level-3" data-v-70334359><a href="/network/#_1-2-通信基础" class="sidebar-link reco-side-_1-2-通信基础" data-v-70334359>1.2 通信基础</a></li><li class="level-2" data-v-70334359><a href="/network/#_2-mac和ip" class="sidebar-link reco-side-_2-mac和ip" data-v-70334359>2. MAC和IP</a></li><li class="level-3" data-v-70334359><a href="/network/#_2-1-mac地址" class="sidebar-link reco-side-_2-1-mac地址" data-v-70334359>2.1 MAC地址</a></li><li class="level-3" data-v-70334359><a href="/network/#_2-2-ip地址" class="sidebar-link reco-side-_2-2-ip地址" data-v-70334359>2.2 IP地址</a></li><li class="level-3" data-v-70334359><a href="/network/#_2-3-子网掩码" class="sidebar-link reco-side-_2-3-子网掩码" data-v-70334359>2.3 子网掩码</a></li><li class="level-3" data-v-70334359><a href="/network/#_2-4-ipv6" class="sidebar-link reco-side-_2-4-ipv6" data-v-70334359>2.4 IPv6</a></li><li class="level-2" data-v-70334359><a href="/network/#_3-路由" class="sidebar-link reco-side-_3-路由" data-v-70334359>3. 路由</a></li><li class="level-3" data-v-70334359><a href="/network/#_3-1-路由寻址" class="sidebar-link reco-side-_3-1-路由寻址" data-v-70334359>3.1 路由寻址</a></li><li class="level-3" data-v-70334359><a href="/network/#_3-2-数据包的传输过程" class="sidebar-link reco-side-_3-2-数据包的传输过程" data-v-70334359>3.2 数据包的传输过程</a></li><li class="level-3" data-v-70334359><a href="/network/#_3-3-网络、互联网、因特网" class="sidebar-link reco-side-_3-3-网络、互联网、因特网" data-v-70334359>3.3 网络、互联网、因特网</a></li><li class="level-3" data-v-70334359><a href="/network/#_3-4-网络分类" class="sidebar-link reco-side-_3-4-网络分类" data-v-70334359>3.4 网络分类</a></li><li class="level-3" data-v-70334359><a href="/network/#_3-5-常见的几种接口" class="sidebar-link reco-side-_3-5-常见的几种接口" data-v-70334359>3.5 常见的几种接口</a></li><li class="level-3" data-v-70334359><a href="/network/#_3-6-上网方式" class="sidebar-link reco-side-_3-6-上网方式" data-v-70334359>3.6 上网方式</a></li><li class="level-3" data-v-70334359><a href="/network/#_3-7-nat" class="sidebar-link reco-side-_3-7-nat" data-v-70334359>3.7 NAT</a></li><li class="level-2" data-v-70334359><a href="/network/#_4-网络分层" class="sidebar-link reco-side-_4-网络分层" data-v-70334359>4. 网络分层</a></li><li class="level-3" data-v-70334359><a href="/network/#_4-1-物理层" class="sidebar-link reco-side-_4-1-物理层" data-v-70334359>4.1 物理层</a></li><li class="level-3" data-v-70334359><a href="/network/#_4-2-数据链路层" class="sidebar-link reco-side-_4-2-数据链路层" data-v-70334359>4.2 数据链路层</a></li><li class="level-3" data-v-70334359><a href="/network/#_4-3-网络层" class="sidebar-link reco-side-_4-3-网络层" data-v-70334359>4.3 网络层</a></li><li class="level-3" data-v-70334359><a href="/network/#_4-4-传输层" class="sidebar-link reco-side-_4-4-传输层" data-v-70334359>4.4 传输层</a></li><li class="level-3" data-v-70334359><a href="/network/#_4-5-应用层" class="sidebar-link reco-side-_4-5-应用层" data-v-70334359>4.5 应用层</a></li><li class="level-2" data-v-70334359><a href="/network/#_5-网络基础知识" class="sidebar-link reco-side-_5-网络基础知识" data-v-70334359>5. 网络基础知识</a></li><li class="level-3" data-v-70334359><a href="/network/#_5-1-代理服务器" class="sidebar-link reco-side-_5-1-代理服务器" data-v-70334359>5.1 代理服务器</a></li><li class="level-3" data-v-70334359><a href="/network/#_5-2-cdn" class="sidebar-link reco-side-_5-2-cdn" data-v-70334359>5.2 CDN</a></li><li class="level-3" data-v-70334359><a href="/network/#_5-3-webservice" class="sidebar-link reco-side-_5-3-webservice" data-v-70334359>5.3 WebService</a></li><li class="level-3" data-v-70334359><a href="/network/#_5-4-httpdns" class="sidebar-link reco-side-_5-4-httpdns" data-v-70334359>5.4 HTTPDNS</a></li><li class="level-3" data-v-70334359><a href="/network/#_5-5-vpn" class="sidebar-link reco-side-_5-5-vpn" data-v-70334359>5.5 VPN</a></li><li class="level-3" data-v-70334359><a href="/network/#_5-6-网络爬虫" class="sidebar-link reco-side-_5-6-网络爬虫" data-v-70334359>5.6 网络爬虫</a></li><li class="level-3" data-v-70334359><a href="/network/#_5-7-http缓存" class="sidebar-link reco-side-_5-7-http缓存" data-v-70334359>5.7 HTTP缓存</a></li><li class="level-2" data-v-70334359><a href="/network/#_6-网络安全" class="sidebar-link reco-side-_6-网络安全" data-v-70334359>6. 网络安全</a></li><li class="level-3" data-v-70334359><a href="/network/#_6-1-arp欺骗" class="sidebar-link reco-side-_6-1-arp欺骗" data-v-70334359>6.1 ARP欺骗</a></li><li class="level-3" data-v-70334359><a href="/network/#_6-2-dos、ddos" class="sidebar-link reco-side-_6-2-dos、ddos" data-v-70334359>6.2 DoS、DDoS</a></li><li class="level-3" data-v-70334359><a href="/network/#_6-3-dns劫持" class="sidebar-link reco-side-_6-3-dns劫持" data-v-70334359>6.3 DNS劫持</a></li><li class="level-3" data-v-70334359><a href="/network/#_6-4-加密和解密" class="sidebar-link reco-side-_6-4-加密和解密" data-v-70334359>6.4 加密和解密</a></li><li class="level-2" data-v-70334359><a href="/network/#_7-其他协议" class="sidebar-link reco-side-_7-其他协议" data-v-70334359>7. 其他协议</a></li><li class="level-3" data-v-70334359><a href="/network/#_7-1-ftp、websocket" class="sidebar-link reco-side-_7-1-ftp、websocket" data-v-70334359>7.1 FTP、WebSocket</a></li><li class="level-3" data-v-70334359><a href="/network/#_7-2-邮件" class="sidebar-link reco-side-_7-2-邮件" data-v-70334359>7.2 邮件</a></li><li class="level-3" data-v-70334359><a href="/network/#_7-3-即时通信" class="sidebar-link reco-side-_7-3-即时通信" data-v-70334359>7.3 即时通信</a></li><li class="level-3" data-v-70334359><a href="/network/#_7-4-流媒体" class="sidebar-link reco-side-_7-4-流媒体" data-v-70334359>7.4 流媒体</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.7bcd2792.js" defer></script><script src="/assets/js/3.9c7a5d8e.js" defer></script><script src="/assets/js/1.db4280a4.js" defer></script><script src="/assets/js/12.0c24c9c3.js" defer></script>
  </body>
</html>
